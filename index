
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Pengawasan Ekonomi Sirkular Sektor Industri (SiPESSI)</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* GREEN COLOR SCHEME OVERRIDE */
        :root {
            /* Primary Green Colors */
            --color-primary-green: #10b981;
            --color-dark-green: #065f46;
            --color-light-green: #ecfdf5;
            --color-accent-green: #34d399;
            --color-soft-green: #a7f3d0;
            --color-teal: #0d9488;
            --color-lime: #84cc16;
            --color-forest: #15803d;
            
            /* Override design system colors */
            --color-primary: #10b981;
            --color-primary-hover: #059669;
            --color-primary-active: #047857;
            --color-success: #10b981;
            --color-success-rgb: 16, 185, 129;
        }
        
        @media (prefers-color-scheme: dark) {
            :root {
                --color-primary: #34d399;
                --color-primary-hover: #10b981;
                --color-primary-active: #059669;
                --color-success: #34d399;
                --color-success-rgb: 52, 211, 153;
            }
        }
        :root {
  /* Primitive Color Tokens */
  --color-white: rgba(255, 255, 255, 1);
  --color-black: rgba(0, 0, 0, 1);
  --color-cream-50: rgba(252, 252, 249, 1);
  --color-cream-100: rgba(255, 255, 253, 1);
  --color-gray-200: rgba(245, 245, 245, 1);
  --color-gray-300: rgba(167, 169, 169, 1);
  --color-gray-400: rgba(119, 124, 124, 1);
  --color-slate-500: rgba(98, 108, 113, 1);
  --color-brown-600: rgba(94, 82, 64, 1);
  --color-charcoal-700: rgba(31, 33, 33, 1);
  --color-charcoal-800: rgba(38, 40, 40, 1);
  --color-slate-900: rgba(19, 52, 59, 1);
  --color-teal-300: rgba(50, 184, 198, 1);
  --color-teal-400: rgba(45, 166, 178, 1);
  --color-teal-500: rgba(33, 128, 141, 1);
  --color-teal-600: rgba(29, 116, 128, 1);
  --color-teal-700: rgba(26, 104, 115, 1);
  --color-teal-800: rgba(41, 150, 161, 1);
  --color-red-400: rgba(255, 84, 89, 1);
  --color-red-500: rgba(192, 21, 47, 1);
  --color-orange-400: rgba(230, 129, 97, 1);
  --color-orange-500: rgba(168, 75, 47, 1);

  /* RGB versions for opacity control */
  --color-brown-600-rgb: 94, 82, 64;
  --color-teal-500-rgb: 33, 128, 141;
  --color-slate-900-rgb: 19, 52, 59;
  --color-slate-500-rgb: 98, 108, 113;
  --color-red-500-rgb: 192, 21, 47;
  --color-red-400-rgb: 255, 84, 89;
  --color-orange-500-rgb: 168, 75, 47;
  --color-orange-400-rgb: 230, 129, 97;

  /* Background color tokens (Light Mode) */
  --color-bg-1: rgba(59, 130, 246, 0.08);
  --color-bg-2: rgba(245, 158, 11, 0.08);
  --color-bg-3: rgba(34, 197, 94, 0.08);
  --color-bg-4: rgba(239, 68, 68, 0.08);
  --color-bg-5: rgba(147, 51, 234, 0.08);
  --color-bg-6: rgba(249, 115, 22, 0.08);
  --color-bg-7: rgba(236, 72, 153, 0.08);
  --color-bg-8: rgba(6, 182, 212, 0.08);

  /* Semantic Color Tokens (Light Mode) */
  --color-background: var(--color-cream-50);
  --color-surface: var(--color-cream-100);
  --color-text: var(--color-slate-900);
  --color-text-secondary: var(--color-slate-500);
  --color-primary: var(--color-teal-500);
  --color-primary-hover: var(--color-teal-600);
  --color-primary-active: var(--color-teal-700);
  --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
  --color-secondary-hover: rgba(var(--color-brown-600-rgb), 0.2);
  --color-secondary-active: rgba(var(--color-brown-600-rgb), 0.25);
  --color-border: rgba(var(--color-brown-600-rgb), 0.2);
  --color-btn-primary-text: var(--color-cream-50);
  --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
  --color-card-border-inner: rgba(var(--color-brown-600-rgb), 0.12);
  --color-error: var(--color-red-500);
  --color-success: var(--color-teal-500);
  --color-warning: var(--color-orange-500);
  --color-info: var(--color-slate-500);
  --color-focus-ring: rgba(var(--color-teal-500-rgb), 0.4);
  --color-select-caret: rgba(var(--color-slate-900-rgb), 0.8);

  /* Common style patterns */
  --focus-ring: 0 0 0 3px var(--color-focus-ring);
  --focus-outline: 2px solid var(--color-primary);
  --status-bg-opacity: 0.15;
  --status-border-opacity: 0.25;
  --select-caret-light: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23134252' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
  --select-caret-dark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23f5f5f5' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");

  /* RGB versions for opacity control */
  --color-success-rgb: 33, 128, 141;
  --color-error-rgb: 192, 21, 47;
  --color-warning-rgb: 168, 75, 47;
  --color-info-rgb: 98, 108, 113;

  /* Typography */
  --font-family-base: "FKGroteskNeue", "Geist", "Inter", -apple-system,
    BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  --font-family-mono: "Berkeley Mono", ui-monospace, SFMono-Regular, Menlo,
    Monaco, Consolas, monospace;
  --font-size-xs: 11px;
  --font-size-sm: 12px;
  --font-size-base: 14px;
  --font-size-md: 14px;
  --font-size-lg: 16px;
  --font-size-xl: 18px;
  --font-size-2xl: 20px;
  --font-size-3xl: 24px;
  --font-size-4xl: 30px;
  --font-weight-normal: 400;
  --font-weight-medium: 500;
  --font-weight-semibold: 550;
  --font-weight-bold: 600;
  --line-height-tight: 1.2;
  --line-height-normal: 1.5;
  --letter-spacing-tight: -0.01em;

  /* Spacing */
  --space-0: 0;
  --space-1: 1px;
  --space-2: 2px;
  --space-4: 4px;
  --space-6: 6px;
  --space-8: 8px;
  --space-10: 10px;
  --space-12: 12px;
  --space-16: 16px;
  --space-20: 20px;
  --space-24: 24px;
  --space-32: 32px;

  /* Border Radius */
  --radius-sm: 6px;
  --radius-base: 8px;
  --radius-md: 10px;
  --radius-lg: 12px;
  --radius-full: 9999px;

  /* Shadows */
  --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.02);
  --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02);
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04),
    0 2px 4px -1px rgba(0, 0, 0, 0.02);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.04),
    0 4px 6px -2px rgba(0, 0, 0, 0.02);
  --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.15),
    inset 0 -1px 0 rgba(0, 0, 0, 0.03);

  /* Animation */
  --duration-fast: 150ms;
  --duration-normal: 250ms;
  --ease-standard: cubic-bezier(0.16, 1, 0.3, 1);

  /* Layout */
  --container-sm: 640px;
  --container-md: 768px;
  --container-lg: 1024px;
  --container-xl: 1280px;
}

@media (prefers-color-scheme: dark) {
  :root {
    --color-gray-400-rgb: 119, 124, 124;
    --color-teal-300-rgb: 50, 184, 198;
    --color-gray-300-rgb: 167, 169, 169;
    --color-gray-200-rgb: 245, 245, 245;
    --color-bg-1: rgba(29, 78, 216, 0.15);
    --color-bg-2: rgba(180, 83, 9, 0.15);
    --color-bg-3: rgba(21, 128, 61, 0.15);
    --color-bg-4: rgba(185, 28, 28, 0.15);
    --color-bg-5: rgba(107, 33, 168, 0.15);
    --color-bg-6: rgba(194, 65, 12, 0.15);
    --color-bg-7: rgba(190, 24, 93, 0.15);
    --color-bg-8: rgba(8, 145, 178, 0.15);
    --color-background: var(--color-charcoal-700);
    --color-surface: var(--color-charcoal-800);
    --color-text: var(--color-gray-200);
    --color-text-secondary: rgba(var(--color-gray-300-rgb), 0.7);
    --color-primary: var(--color-teal-300);
    --color-primary-hover: var(--color-teal-400);
    --color-primary-active: var(--color-teal-800);
    --color-secondary: rgba(var(--color-gray-400-rgb), 0.15);
    --color-secondary-hover: rgba(var(--color-gray-400-rgb), 0.25);
    --color-secondary-active: rgba(var(--color-gray-400-rgb), 0.3);
    --color-border: rgba(var(--color-gray-400-rgb), 0.3);
    --color-error: var(--color-red-400);
    --color-success: var(--color-teal-300);
    --color-warning: var(--color-orange-400);
    --color-info: var(--color-gray-300);
    --color-focus-ring: rgba(var(--color-teal-300-rgb), 0.4);
    --color-btn-primary-text: var(--color-slate-900);
    --color-card-border: rgba(var(--color-gray-400-rgb), 0.2);
    --color-card-border-inner: rgba(var(--color-gray-400-rgb), 0.15);
    --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.1),
      inset 0 -1px 0 rgba(0, 0, 0, 0.15);
    --color-border-secondary: rgba(var(--color-gray-400-rgb), 0.2);
    --color-select-caret: rgba(var(--color-gray-200-rgb), 0.8);
    --color-success-rgb: var(--color-teal-300-rgb);
    --color-error-rgb: var(--color-red-400-rgb);
    --color-warning-rgb: var(--color-orange-400-rgb);
    --color-info-rgb: var(--color-gray-300-rgb);
  }
}

@font-face {
  font-family: 'FKGroteskNeue';
  src: url('https://r2cdn.perplexity.ai/fonts/FKGroteskNeue.woff2')
    format('woff2');
}

html {
  font-size: var(--font-size-base);
  font-family: var(--font-family-base);
  line-height: var(--line-height-normal);
  color: var(--color-text);
  background-color: var(--color-background);
  -webkit-font-smoothing: antialiased;
  box-sizing: border-box;
}

body {
  margin: 0;
  padding: 0;
}

*,
*::before,
*::after {
  box-sizing: inherit;
}

h1, h2, h3, h4, h5, h6 {
  margin: 0;
  font-weight: var(--font-weight-semibold);
  line-height: var(--line-height-tight);
  color: var(--color-text);
  letter-spacing: var(--letter-spacing-tight);
}

h1 { font-size: var(--font-size-4xl); }
h2 { font-size: var(--font-size-3xl); }
h3 { font-size: var(--font-size-2xl); }
h4 { font-size: var(--font-size-xl); }
h5 { font-size: var(--font-size-lg); }
h6 { font-size: var(--font-size-md); }

p {
  margin: 0 0 var(--space-16) 0;
}

.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: var(--space-8) var(--space-16);
  border-radius: var(--radius-base);
  font-size: var(--font-size-base);
  font-weight: 500;
  line-height: 1.5;
  cursor: pointer;
  transition: all var(--duration-normal) var(--ease-standard);
  border: none;
  text-decoration: none;
}

.btn:focus-visible {
  outline: none;
  box-shadow: var(--focus-ring);
}

.btn--primary {
  background: var(--color-primary);
  color: var(--color-btn-primary-text);
}

.btn--primary:hover {
  background: var(--color-primary-hover);
}

.btn--secondary {
  background: var(--color-secondary);
  color: var(--color-text);
}

.btn--secondary:hover {
  background: var(--color-secondary-hover);
}

.btn--sm {
  padding: var(--space-6) var(--space-12);
  font-size: var(--font-size-sm);
}

.form-control {
  display: block;
  width: 100%;
  padding: var(--space-8) var(--space-12);
  font-size: var(--font-size-md);
  line-height: 1.5;
  color: var(--color-text);
  background-color: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-base);
  transition: border-color var(--duration-fast) var(--ease-standard);
}

.form-control:focus {
  border-color: var(--color-primary);
  outline: var(--focus-outline);
}

select.form-control {
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  background-image: var(--select-caret-light);
  background-repeat: no-repeat;
  background-position: right var(--space-12) center;
  background-size: 16px;
  padding-right: var(--space-32);
}

.form-label {
  display: block;
  margin-bottom: var(--space-8);
  font-weight: var(--font-weight-medium);
  font-size: var(--font-size-sm);
}

.form-group {
  margin-bottom: var(--space-16);
}

.card {
  background-color: var(--color-surface);
  border-radius: var(--radius-lg);
  border: 1px solid var(--color-card-border);
  box-shadow: var(--shadow-sm);
  overflow: hidden;
}

.card__body {
  padding: var(--space-16);
}

.status {
  display: inline-flex;
  align-items: center;
  padding: var(--space-6) var(--space-12);
  border-radius: var(--radius-full);
  font-weight: var(--font-weight-medium);
  font-size: var(--font-size-sm);
}

.status--success {
  background-color: rgba(var(--color-success-rgb, 33, 128, 141), var(--status-bg-opacity));
  color: var(--color-success);
  border: 1px solid rgba(var(--color-success-rgb, 33, 128, 141), var(--status-border-opacity));
}

.status--warning {
  background-color: rgba(var(--color-warning-rgb, 168, 75, 47), var(--status-bg-opacity));
  color: var(--color-warning);
  border: 1px solid rgba(var(--color-warning-rgb, 168, 75, 47), var(--status-border-opacity));
}

.status--error {
  background-color: rgba(var(--color-error-rgb, 192, 21, 47), var(--status-bg-opacity));
  color: var(--color-error);
  border: 1px solid rgba(var(--color-error-rgb, 192, 21, 47), var(--status-border-opacity));
}

/* Custom Styles */
.app-container {
    display: flex;
    min-height: 100vh;
}

/* Header Styles */
.app-header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: linear-gradient(to right, #065f46, #0d9488);
    padding: 20px 40px;
    box-shadow: 0 4px 12px rgba(6, 95, 70, 0.2);
    height: auto;
}

.header-center-branding {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: flex-start;
    text-align: left;
}

.app-info-full {
    width: 100%;
}

.app-info-full h1 {
    margin: 0;
    font-size: 24px;
    font-weight: 700;
    color: white;
    line-height: 1.3;
    letter-spacing: -0.5px;
}

.app-info-full p {
    margin: 6px 0 0 0;
    font-size: 12px;
    color: #a7f3d0;
    font-weight: 500;
}

.header-right-menu {
    display: flex;
    gap: 16px;
    align-items: center;
}

.sidebar {
    width: 250px;
    background: linear-gradient(180deg, var(--color-dark-green) 0%, var(--color-teal) 100%);
    border-right: none;
    padding: var(--space-24);
    position: fixed;
    height: calc(100vh - 76px);
    top: 76px;
    overflow-y: auto;
    box-shadow: 4px 0 12px rgba(6, 95, 70, 0.1);
}

.sidebar-logo {
    font-size: var(--font-size-xl);
    font-weight: var(--font-weight-bold);
    color: white;
    margin-bottom: var(--space-32);
    text-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.nav-menu {
    list-style: none;
    padding: 0;
    margin: 0;
}

.nav-item {
    margin-bottom: var(--space-8);
}

.nav-link {
    display: flex;
    align-items: center;
    padding: var(--space-12) var(--space-16);
    color: rgba(255, 255, 255, 0.9);
    text-decoration: none;
    border-radius: var(--radius-base);
    transition: all var(--duration-fast) var(--ease-standard);
    cursor: pointer;
}

.nav-link:hover {
    background-color: rgba(255, 255, 255, 0.15);
    transform: translateX(4px);
}

.nav-link.active {
    background-color: var(--color-primary-green);
    color: white;
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    border-left: 4px solid var(--color-accent-green);
}

.main-content {
    flex: 1;
    margin-left: 250px;
    margin-top: 76px;
    padding: var(--space-32);
}

.page-header {
    margin-bottom: var(--space-32);
    background: linear-gradient(135deg, var(--color-dark-green) 0%, var(--color-teal) 100%);
    padding: var(--space-32);
    border-radius: var(--radius-lg);
    color: white;
    box-shadow: 0 8px 24px rgba(6, 95, 70, 0.2);
}

.page-title {
    font-size: var(--font-size-3xl);
    margin-bottom: var(--space-8);
    color: white;
    text-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.page-subtitle {
    color: rgba(255, 255, 255, 0.9);
    font-size: var(--font-size-base);
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--space-16);
    margin-bottom: var(--space-32);
}

.stat-card {
    background-color: var(--color-surface);
    border: 2px solid var(--color-soft-green);
    border-top: 4px solid var(--color-primary-green);
    border-radius: var(--radius-lg);
    padding: var(--space-20);
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.1);
    transition: all var(--duration-normal) var(--ease-standard);
}

.stat-card:hover {
    transform: scale(1.02);
    box-shadow: 0 8px 24px rgba(16, 185, 129, 0.2);
    border-color: var(--color-primary-green);
}

.stat-label {
    font-size: var(--font-size-sm);
    color: var(--color-text-secondary);
    margin-bottom: var(--space-8);
}

.stat-value {
    font-size: var(--font-size-3xl);
    font-weight: var(--font-weight-bold);
    color: var(--color-primary-green);
}

.stat-change {
    font-size: var(--font-size-sm);
    margin-top: var(--space-8);
}

.stat-change.positive {
    color: var(--color-success);
}

.stat-change.negative {
    color: var(--color-error);
}

.charts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: var(--space-24);
    margin-bottom: var(--space-32);
}

.chart-container {
    background-color: var(--color-surface);
    border: 2px solid var(--color-soft-green);
    border-top: 4px solid var(--color-primary-green);
    border-radius: var(--radius-lg);
    padding: var(--space-20);
    min-height: 350px;
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.1);
}

.chart-container canvas {
    max-height: 300px;
}

.chart-title {
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-semibold);
    margin-bottom: var(--space-16);
    color: var(--color-dark-green);
    border-bottom: 2px solid var(--color-primary-green);
    padding-bottom: var(--space-8);
}

.data-table {
    width: 100%;
    border-collapse: collapse;
    background-color: var(--color-surface);
    border-radius: var(--radius-lg);
    overflow: hidden;
}

.data-table thead {
    background-color: var(--color-primary-green);
    color: white;
}

.data-table th,
.data-table td {
    padding: var(--space-12) var(--space-16);
    text-align: left;
    border-bottom: 1px solid var(--color-border);
}

.data-table th {
    font-weight: var(--font-weight-semibold);
    font-size: var(--font-size-sm);
    color: white;
}

.data-table tbody tr:hover {
    background-color: var(--color-light-green);
}

.table-actions {
    display: flex;
    gap: var(--space-8);
}

.action-btn {
    padding: var(--space-4) var(--space-8);
    background: transparent;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-sm);
    cursor: pointer;
    color: var(--color-text);
    font-size: var(--font-size-sm);
    transition: all var(--duration-fast) var(--ease-standard);
}

.action-btn:hover {
    background-color: var(--color-light-green);
    border-color: var(--color-primary-green);
    color: var(--color-dark-green);
}

.toolbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-24);
    flex-wrap: wrap;
    gap: var(--space-16);
}

.search-box {
    display: flex;
    gap: var(--space-8);
    flex: 1;
    max-width: 500px;
}

.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    align-items: center;
    justify-content: center;
}

.modal.active {
    display: flex;
}

.modal-content {
    background-color: var(--color-surface);
    border-radius: var(--radius-lg);
    padding: var(--space-32);
    max-width: 800px;
    max-height: 90vh;
    overflow-y: auto;
    width: 90%;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-24);
}

.modal-title {
    font-size: var(--font-size-2xl);
    font-weight: var(--font-weight-bold);
}

.close-btn {
    background: transparent;
    border: none;
    font-size: var(--font-size-2xl);
    cursor: pointer;
    color: var(--color-text-secondary);
    padding: 0;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.close-btn:hover {
    color: var(--color-text);
}

.form-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--space-16);
}

.dimension-section {
    background-color: var(--color-light-green);
    padding: var(--space-20);
    border-radius: var(--radius-lg);
    margin-bottom: var(--space-24);
    border: 2px solid var(--color-soft-green);
    border-left: 4px solid var(--color-primary-green);
}

.dimension-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-16);
}

.dimension-title {
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-semibold);
}

.dimension-weight {
    font-size: var(--font-size-sm);
    color: var(--color-text-secondary);
}

.dimension-score {
    font-size: var(--font-size-xl);
    font-weight: var(--font-weight-bold);
    color: var(--color-primary-green);
}

.indicator-item {
    margin-bottom: var(--space-16);
}

.indicator-label {
    display: block;
    margin-bottom: var(--space-8);
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-medium);
}

.rating-scale {
    display: flex;
    gap: var(--space-8);
}

.rating-option {
    flex: 1;
    padding: var(--space-8);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-base);
    text-align: center;
    cursor: pointer;
    transition: all var(--duration-fast) var(--ease-standard);
    background-color: var(--color-surface);
}

.rating-option:hover {
    border-color: var(--color-primary-green);
    background-color: var(--color-light-green);
}

.rating-option input[type="radio"] {
    display: none;
}

.rating-option input[type="radio"]:checked + label {
    background-color: var(--color-primary);
    color: var(--color-btn-primary-text);
}

.rating-option label {
    cursor: pointer;
    display: block;
    margin: 0;
    font-weight: var(--font-weight-medium);
}

.total-score-display {
    background: linear-gradient(135deg, var(--color-dark-green), var(--color-teal));
    color: white;
    padding: var(--space-32);
    border-radius: var(--radius-lg);
    text-align: center;
    margin: var(--space-24) 0;
    box-shadow: 0 8px 24px rgba(6, 95, 70, 0.3);
}

.total-score-label {
    font-size: var(--font-size-lg);
    margin-bottom: var(--space-8);
}

.total-score-value {
    font-size: 48px;
    font-weight: var(--font-weight-bold);
    margin-bottom: var(--space-8);
}

.total-score-category {
    font-size: var(--font-size-xl);
    font-weight: var(--font-weight-semibold);
}

.score-badge {
    display: inline-block;
    padding: var(--space-6) var(--space-12);
    border-radius: var(--radius-base);
    font-weight: var(--font-weight-bold);
    font-size: var(--font-size-sm);
}

.score-badge.excellent {
    background-color: var(--color-dark-green);
    color: white;
}

.score-badge.good {
    background-color: var(--color-primary-green);
    color: white;
}

.score-badge.fair {
    background-color: var(--color-soft-green);
    color: var(--color-dark-green);
    font-weight: bold;
}

.score-badge.poor {
    background-color: #ff5459;
    color: white;
}

.score-badge.very-poor {
    background-color: #c01b2f;
    color: white;
}

.alert {
    padding: var(--space-16);
    border-radius: var(--radius-base);
    margin-bottom: var(--space-16);
}

.alert-success {
    background-color: var(--color-light-green);
    border: 2px solid var(--color-primary-green);
    color: var(--color-dark-green);
    border-left: 4px solid var(--color-primary-green);
}

.alert-error {
    background-color: rgba(var(--color-error-rgb), 0.1);
    border: 1px solid rgba(var(--color-error-rgb), 0.3);
    color: var(--color-error);
}

.hidden {
    display: none !important;
}

.text-center {
    text-align: center;
}

.mt-24 {
    margin-top: var(--space-24);
}

.mb-16 {
    margin-bottom: var(--space-16);
}

@media (max-width: 1024px) {
    .app-header {
        padding: 16px 20px;
    }
    
    .app-info-full h1 {
        font-size: 20px;
    }
    
    .app-info-full p {
        font-size: 11px;
    }
}

@media (max-width: 768px) {
    .app-header {
        padding: 12px 16px;
        flex-direction: column;
        gap: 12px;
    }
    
    .header-center-branding {
        width: 100%;
        justify-content: center;
    }
    
    .app-info-full {
        text-align: center;
    }
    
    .app-info-full h1 {
        font-size: 18px;
    }
    
    .app-info-full p {
        font-size: 10px;
    }
    
    .header-right-menu {
        width: 100%;
        justify-content: center;
    }
    
    .sidebar {
        width: 100%;
        height: auto;
        position: static;
        margin-top: 0;
        top: auto;
        border-right: none;
        border-bottom: 1px solid var(--color-border);
    }
    
    .main-content {
        margin-left: 0;
        margin-top: 0;
        padding: var(--space-16);
    }
    
    .app-container {
        flex-direction: column;
    }
    
    .charts-grid {
        grid-template-columns: 1fr;
    }
    
    .toolbar {
        flex-direction: column;
        align-items: stretch;
    }
    
    .search-box {
        max-width: 100%;
    }
}
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header with Logos -->
        <header class="app-header" style="position: fixed; top: 0; left: 0; right: 0; z-index: 1000; display: flex; align-items: center; justify-content: space-between; background: linear-gradient(to right, #065f46, #0d9488); padding: 12px 20px; box-shadow: 0 4px 12px rgba(6, 95, 70, 0.2);">
            <!-- Center Section - App Branding -->
            <div class="header-center-branding" style="flex: 1; display: flex; align-items: center; justify-content: flex-start; text-align: left;">
                <div class="app-info-full" style="width: 100%;">
                    <h1 style="margin: 0; font-size: 24px; font-weight: 700; color: white; line-height: 1.3; letter-spacing: -0.5px;">Sistem Pengawasan Ekonomi Sirkular Sektor Industri</h1>
                    <p style="margin: 6px 0 0 0; font-size: 12px; color: #a7f3d0; font-weight: 500;">(SiPESSI)</p>
                </div>
            </div>
            
            <!-- Right Section - Navigation (placeholder) -->
            <div class="header-right-menu" style="display: flex; gap: 16px; align-items: center;">
                <!-- Can add navigation items here if needed -->
            </div>
        </header>
        
        <!-- Sidebar Navigation -->
        <aside class="sidebar" style="margin-top: 76px;">
            <div class="sidebar-logo">üåø SiPESSI</div>
            <div style="font-size: var(--font-size-xs); color: rgba(255, 255, 255, 0.8); margin-top: var(--space-8); line-height: 1.4;">Eco-Circular Monitoring</div>
            <nav>
                <ul class="nav-menu">
    <li class="nav-item">
        <a class="nav-link active" data-page="dashboard">üìä Dashboard</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" data-page="industries">üè≠ Daftar Perusahaan</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" data-page="inspection">üïµÔ∏è Pengawasan &amp; Pengendalian</a>
    </li>

    <li class="nav-item">
        <a class="nav-link" data-page="circular-economy">‚ôªÔ∏è Penilaian Ekonomi Sirkular</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" data-page="settings">‚öôÔ∏è Settings</a>
    </li>
</ul>
            </nav>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Dashboard Page -->
            <!-- DASHBOARD -->
            <div id="page-dashboard" class="page-content">
                <div class="page-header">
                    <div style="display: flex; align-items: center; gap: var(--space-16); margin-bottom: var(--space-12);">
                        <span style="font-size: 48px;">üåø</span>
                        <div>
                            <h1 class="page-title" style="margin-bottom: 0;">SiPESSI - Dashboard Monitoring</h1>
                            <p class="page-subtitle" style="margin: 0;">Penilaian Ekonomi Sirkular - 6 Dimensi - Sektor Industri</p>
                        </div>
                    </div>
                    <div style="display: flex; gap: var(--space-16); align-items: center; margin-top: var(--space-16); flex-wrap: wrap;">
                        <div style="color: rgba(255, 255, 255, 0.9); font-size: var(--font-size-sm); background: rgba(255, 255, 255, 0.1); padding: var(--space-8) var(--space-12); border-radius: var(--radius-base);">üìÖ Update Terakhir: <strong id="dashboard-last-update">28 November 2025</strong></div>
                        <select class="form-control" id="dashboard-filter-sector" style="max-width: 200px;">
                            <option value="">Semua Sektor</option>
                        </select>
                        <select class="form-control" id="dashboard-filter-period" style="max-width: 200px;">
                            <option value="2025-11">November 2025</option>
                            <option value="2025-10">Oktober 2025</option>
                            <option value="2025-09">September 2025</option>
                        </select>
                        <button class="btn btn--sm btn--secondary" onclick="app.refreshDashboard()">üîÑ Refresh Data</button>
                    </div>
                </div>

                <!-- Selamat datang SiPESSI -->
                <div class="alert alert-success" style="font-size:var(--font-size-lg); text-align:center; margin-bottom: var(--space-24); background: #ecfdf5; border-color:#10b981; color:#065f46;">
                    <strong>Selamat Datang di SiPESSI</strong><br>Sistem Pengawasan Ekonomi Sirkular Sektor Industri
                </div>
                <!-- Top Statistics Cards -->
                <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); margin-bottom: var(--space-32);">
                    <div class="stat-card" style="background: linear-gradient(135deg, #dbeafe, white); border-top: 4px solid #2563eb;">
                        <div class="stat-label" style="color: #1e40af;">üî¢ Total Penilaian</div>
                        <div class="stat-value" id="dash-total-assessments" style="color: #2563eb">34</div>
                        <div class="stat-change positive" style="color: #2563eb">üìà +5% dari bulan lalu</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #dcfce7, white); border-top: 4px solid #16a34a;">
                        <div class="stat-label" style="color: #15803d; font-weight: 600;">üìä Rata-rata Skor Total</div>
                        <div class="stat-value" id="dash-avg-score" style="color: #16a34a">3.3</div>
                        <div class="stat-change"><span class="status status--success" style="background: #16a34a; color: #fff;">BAIK</span></div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #fed7aa, white); border-top: 4px solid #d97706;">
                        <div class="stat-label" style="color: #92400e; font-weight: 600;">üèÜ Dimensi Terbaik</div>
                        <div class="stat-value" style="font-size: var(--font-size-xl); color: #d97706;" id="dash-best-dim">D1</div>
                        <div class="stat-change positive" id="dash-best-score" style="color: #d97706">Skor: 3.8</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #fee2e2, white); border-top: 4px solid #dc2626;">
                        <div class="stat-label" style="color: #991b1b; font-weight: 600;">‚ö†Ô∏è Dimensi Terlemah</div>
                        <div class="stat-value" style="font-size: var(--font-size-xl); color: #dc2626;" id="dash-weak-dim">D6</div>
                        <div class="stat-change negative" id="dash-weak-score" style="color: #dc2626">Skor: 2.8</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #ede9fe, white); border-top: 4px solid #7c3aed;">
                        <div class="stat-label" style="color: #5b21b6; font-weight: 600;">‚≠ê Perusahaan Terbaik</div>
                        <div class="stat-value" style="font-size: var(--font-size-base); color: #7c3aed;" id="dash-best-company">-</div>
                        <div class="stat-change positive" id="dash-best-company-score" style="color: #7c3aed;">-</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #cffafe, white); border-top: 4px solid #0891b2;">
                        <div class="stat-label" style="color: #155e75; font-weight: 600;">üìç Sektor Terbaik</div>
                        <div class="stat-value" style="font-size: var(--font-size-xl); color: #0891b2;" id="dash-best-sector">Minuman</div>
                        <div class="stat-change positive" id="dash-best-sector-score" style="color: #0891b2;">3.6</div>
                    </div>
                </div>



                <!-- Main Visualizations -->
                <div class="charts-grid" style="grid-template-columns: 3fr 2fr;">
                    <div class="chart-container">
                        <h3 class="chart-title">üìä Radar Chart - 6 Dimensi Ekonomi Sirkular</h3>
                        <canvas id="radarChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3 class="chart-title">üìä Perbandingan Skor per Sektor</h3>
                        <canvas id="sectorBarChart"></canvas>
                    </div>
                </div>

                <!-- Sector Breakdown Tabs -->
                <div class="card mt-24">
                    <div class="card__body">
                        <h3 class="mb-16">üè≠ Detail per Sektor Industri</h3>
                        <div style="display: flex; gap: var(--space-8); flex-wrap: wrap; margin-bottom: var(--space-24); border-bottom: 2px solid var(--color-border); padding-bottom: var(--space-8);" id="sector-tabs"></div>
                        <div id="sector-detail-container"></div>
                    </div>
                </div>

                <!-- Trend Line Chart -->
                <div class="chart-container mt-24">
                    <h3 class="chart-title">üìà Trend Skor Total per Sektor (6 Bulan Terakhir)</h3>
                    <canvas id="trendLineChart"></canvas>
                </div>

                <!-- Heatmap -->
                <div class="card mt-24">
                    <div class="card__body">
                        <h3 class="mb-16">üî• Heatmap - Performa 6 Dimensi √ó 8 Sektor</h3>
                        <div id="heatmap-container"></div>
                    </div>
                </div>

                <!-- Key Insights -->
                <div class="card mt-24">
                    <div class="card__body">
                        <h3 class="mb-16">üí° Key Insights &amp; Alerts</h3>
                        <div id="insights-container"></div>
                    </div>
                </div>


            </div>

            <!-- Workflow Page -->
            <div id="page-workflow" class="page-content hidden">
                <div class="page-header">
                    <h1 class="page-title">SiPESSI - Workflow Pengawasan</h1>
                    <p class="page-subtitle">Sesuai Permenperin 25 Tahun 2021</p>
                </div>

                <div class="card mb-16">
                    <div class="card__body">
                        <h3 class="mb-16">Skema Alur Pengawasan Industri</h3>
                        <div style="text-align: center; padding: var(--space-24);">
                            <img src="https://ppl-ai-code-interpreter-files.s3.amazonaws.com/web/direct-files/c9b3855fa8a447802e7114e1f9c06bef/25ca35ed-b0e9-4aba-b4fc-27cb70295ffe/5c82d9ed.png" 
                                 alt="Workflow Pengawasan Industri" 
                                 style="max-width: 100%; height: auto; border-radius: var(--radius-lg); box-shadow: var(--shadow-lg);">
                        </div>
                    </div>
                </div>

                <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));">
                    <div class="stat-card" style="background-color: var(--color-bg-1);">
                        <h4 style="margin-bottom: var(--space-12); color: var(--color-primary);">1. Persiapan</h4>
                        <ul style="font-size: var(--font-size-sm); padding-left: var(--space-20); margin: 0;">
                            <li>Pembentukan Tim Pengawas</li>
                            <li>Penetapan Jadwal</li>
                            <li>Persiapan Dokumen</li>
                            <li>Koordinasi dengan Industri</li>
                        </ul>
                    </div>
                    <div class="stat-card" style="background-color: var(--color-bg-2);">
                        <h4 style="margin-bottom: var(--space-12); color: var(--color-primary);">2. Pemeriksaan Dokumen</h4>
                        <ul style="font-size: var(--font-size-sm); padding-left: var(--space-20); margin: 0;">
                            <li>Verifikasi Izin Usaha</li>
                            <li>Review Dokumen Lingkungan</li>
                            <li>Cek Sertifikasi</li>
                            <li>Validasi Laporan</li>
                        </ul>
                    </div>
                    <div class="stat-card" style="background-color: var(--color-bg-3);">
                        <h4 style="margin-bottom: var(--space-12); color: var(--color-primary);">3. Inspeksi Lapangan</h4>
                        <ul style="font-size: var(--font-size-sm); padding-left: var(--space-20); margin: 0;">
                            <li>Site Visit</li>
                            <li>Observasi Proses Produksi</li>
                            <li>Cek Fasilitas dan Peralatan</li>
                            <li>Wawancara Karyawan</li>
                        </ul>
                    </div>
                    <div class="stat-card" style="background-color: var(--color-bg-4);">
                        <h4 style="margin-bottom: var(--space-12); color: var(--color-primary);">4. Pengujian dan Sampling</h4>
                        <ul style="font-size: var(--font-size-sm); padding-left: var(--space-20); margin: 0;">
                            <li>Sampling Air Limbah</li>
                            <li>Uji Emisi Udara</li>
                            <li>Test Produk</li>
                            <li>Analisis Lab</li>
                        </ul>
                    </div>
                    <div class="stat-card" style="background-color: var(--color-bg-5);">
                        <h4 style="margin-bottom: var(--space-12); color: var(--color-primary);">5. Analisis dan Penilaian</h4>
                        <ul style="font-size: var(--font-size-sm); padding-left: var(--space-20); margin: 0;">
                            <li>Evaluasi Data</li>
                            <li>Scoring per Aspek</li>
                            <li>Identifikasi Gap</li>
                            <li>Penyusunan Temuan</li>
                        </ul>
                    </div>
                    <div class="stat-card" style="background-color: var(--color-bg-6);">
                        <h4 style="margin-bottom: var(--space-12); color: var(--color-primary);">6. Pelaporan</h4>
                        <ul style="font-size: var(--font-size-sm); padding-left: var(--space-20); margin: 0;">
                            <li>Penyusunan Laporan</li>
                            <li>Review Internal</li>
                            <li>Finalisasi Dokumen</li>
                            <li>Distribusi Hasil</li>
                        </ul>
                    </div>
                    <div class="stat-card" style="background-color: var(--color-bg-7);">
                        <h4 style="margin-bottom: var(--space-12); color: var(--color-primary);">7. Rekomendasi</h4>
                        <ul style="font-size: var(--font-size-sm); padding-left: var(--space-20); margin: 0;">
                            <li>Penyusunan Action Plan</li>
                            <li>Penetapan Timeline</li>
                            <li>Penugasan PIC</li>
                            <li>Prioritas Perbaikan</li>
                        </ul>
                    </div>
                    <div class="stat-card" style="background-color: var(--color-bg-8);">
                        <h4 style="margin-bottom: var(--space-12); color: var(--color-primary);">8. Follow-up dan Monitoring</h4>
                        <ul style="font-size: var(--font-size-sm); padding-left: var(--space-20); margin: 0;">
                            <li>Monitoring Tindak Lanjut</li>
                            <li>Verifikasi Perbaikan</li>
                            <li>Update Progress</li>
                            <li>Penutupan Temuan</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- INSPECTION & PENGENDALIAN -->
            <div id="page-inspection" class="page-content hidden">
                <div class="page-header">
                    <h1 class="page-title">Pengawasan &amp; Pengendalian</h1>
                    <p class="page-subtitle">Monitor, kendali &amp; dokumentasi satu pintu inspeksi industri</p>
                </div>
                <!-- SUB-MENU / TABS -->
                <nav class="toolbar" style="margin-bottom:var(--space-24);">
                    <button class="btn btn--secondary" id="tab-inspection-status">Status Pengawasan</button>
                    <button class="btn btn--secondary" id="tab-inspection-workflow">Workflow Pengawasan</button>
                    <button class="btn btn--secondary" id="tab-inspection-docs">Dokumen Pengawasan</button>
                </nav>
                <!-- SUB-CONTENT -->
                <div id="inspection-status-content" class="inspection-tab-content"></div>
                <div id="inspection-workflow-content" class="inspection-tab-content hidden"></div>
                <div id="inspection-docs-content" class="inspection-tab-content hidden"></div>
            </div>

            <!-- Matrix Page -->
            <div id="page-matrix" class="page-content hidden">
                <div class="page-header">
                    <h1 class="page-title">SiPESSI - Matriks Indikator Penilaian</h1>
                    <p class="page-subtitle">Komprehensif 6 Aspek Pengawasan Industri</p>
                </div>

                <!-- Filter Toolbar -->
                <div class="toolbar">
                    <div class="search-box">
                        <input type="text" class="form-control" id="matrix-search" placeholder="Cari indikator...">
                        <select class="form-control" id="matrix-filter-aspect">
                            <option value="">Semua Aspek</option>
                            <option value="TEKNIS">Aspek Teknis</option>
                            <option value="EKONOMI">Aspek Ekonomi</option>
                            <option value="SOSIAL">Aspek Sosial</option>
                            <option value="LINGKUNGAN">Aspek Lingkungan</option>
                            <option value="SIRKULAR">Ekonomi Sirkular</option>
                            <option value="PERIZINAN">Perizinan &amp; Kepatuhan</option>
                        </select>
                    </div>
                    <button class="btn btn--primary" onclick="app.exportMatrix()">üìä Export Matrix</button>
                </div>

                <!-- Matrix Content -->
                <div id="matrix-content"></div>
            </div>

            <!-- Industries Page -->
            <div id="page-industries" class="page-content hidden">
                <div class="page-header">
                    <h1 class="page-title">SiPESSI - Daftar Perusahaan</h1>
                    <p class="page-subtitle">Kelola data industri yang diawasi</p>
                </div>

                <!-- Toolbar -->
                <div class="toolbar">
                    <div class="search-box">
                        <input type="text" class="form-control" id="search-industry" placeholder="Cari industri...">
                        <select class="form-control" id="filter-sector">
                            <option value="">Semua Sektor</option>
                            <option value="Tekstil">Tekstil</option>
                            <option value="Plastik">Plastik</option>
                            <option value="Kertas">Kertas</option>
                            <option value="Elektronik">Elektronik</option>
                            <option value="Kimia">Kimia</option>
                            <option value="Minuman">Minuman</option>
                            <option value="Logam">Logam</option>
                            <option value="Otomotif">Otomotif</option>
                            <option value="Lainnya">Lainnya</option>
                        </select>
                    </div>
                    <button class="btn btn--primary" onclick="app.showAddIndustryModal()">+ Tambah Industri</button>
                </div>

                <!-- Industries Table -->
                <div class="card">
                    <div class="card__body">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>Nama Industri</th>
                                    <th>Sektor</th>
                                    <th>Lokasi</th>
                                    <th>Status</th>
                                    <th>Skor Terakhir</th>
                                    <th>Tanggal Audit</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="industries-table-body">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Assessment Page -->
            <div id="page-assessment" class="page-content hidden">
                <div class="page-header">
                    <h1 class="page-title">SiPESSI - Penilaian Industri</h1>
                    <p class="page-subtitle">Evaluasi Komprehensif 6 Aspek: Teknis, Ekonomi, Sosial, Lingkungan, Ekonomi Sirkular, Perizinan</p>
                </div>

                <!-- Select Industry -->
                <div class="card mb-16">
                    <div class="card__body">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Pilih Industri</label>
                                <select class="form-control" id="assessment-industry">
                                    <option value="">-- Pilih Industri --</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Pilih Aspek Penilaian</label>
                                <select class="form-control" id="assessment-aspect">
                                    <option value="">-- Semua Aspek --</option>
                                    <option value="TEKNIS">Aspek Teknis (12 indikator)</option>
                                    <option value="EKONOMI">Aspek Ekonomi (8 indikator)</option>
                                    <option value="SOSIAL">Aspek Sosial (10 indikator)</option>
                                    <option value="LINGKUNGAN">Aspek Lingkungan (14 indikator)</option>
                                    <option value="SIRKULAR">Ekonomi Sirkular (24 indikator)</option>
                                    <option value="PERIZINAN">Perizinan &amp; Kepatuhan (10 indikator)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Assessment Form -->
                <div id="assessment-form-container" class="hidden">
                    <form id="assessment-form">
                        <div id="aspects-container"></div>

                        <!-- Scores per Aspek Summary -->
                        <div class="card mb-16" style="background: var(--color-bg-1);">
                            <div class="card__body">
                                <h3 class="mb-16">Ringkasan Skor per Aspek</h3>
                                <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));">
                                    <div class="stat-card" style="background: #2563eb; color:white;">
                                        <div style="font-size:var(--font-size-xs); margin-bottom:4px;">Teknis</div>
                                        <div style="font-size:var(--font-size-2xl); font-weight:bold;" id="score-teknis">0.0</div>
                                    </div>
                                    <div class="stat-card" style="background: #16a34a; color:white;">
                                        <div style="font-size:var(--font-size-xs); margin-bottom:4px;">Ekonomi</div>
                                        <div style="font-size:var(--font-size-2xl); font-weight:bold;" id="score-ekonomi">0.0</div>
                                    </div>
                                    <div class="stat-card" style="background: #d97706; color:white;">
                                        <div style="font-size:var(--font-size-xs); margin-bottom:4px;">Sosial</div>
                                        <div style="font-size:var(--font-size-2xl); font-weight:bold;" id="score-sosial">0.0</div>
                                    </div>
                                    <div class="stat-card" style="background: #dc2626; color:white;">
                                        <div style="font-size:var(--font-size-xs); margin-bottom:4px;">Lingkungan</div>
                                        <div style="font-size:var(--font-size-2xl); font-weight:bold;" id="score-lingkungan">0.0</div>
                                    </div>
                                    <div class="stat-card" style="background: #7c3aed; color:white;">
                                        <div style="font-size:var(--font-size-xs); margin-bottom:4px;">Sirkular</div>
                                        <div style="font-size:var(--font-size-2xl); font-weight:bold;" id="score-sirkular">0.0</div>
                                    </div>
                                    <div class="stat-card" style="background: #0891b2; color:white;">
                                        <div style="font-size:var(--font-size-xs); margin-bottom:4px;">Perizinan</div>
                                        <div style="font-size:var(--font-size-2xl); font-weight:bold;" id="score-perizinan">0.0</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Total Score Display -->
                        <div class="total-score-display">
                            <div class="total-score-label">Skor Total Akhir</div>
                            <div class="total-score-value" id="total-score-value">0.0</div>
                            <div class="total-score-category" id="total-score-category"></div>
                        </div>

                        <!-- Findings & Recommendations -->
                        <div class="card mb-16">
                            <div class="card__body">
                                <h3 class="mb-16">Catatan Temuan &amp; Rekomendasi</h3>
                                <div class="form-group">
                                    <label class="form-label">Temuan</label>
                                    <textarea class="form-control" id="assessment-findings" rows="4" placeholder="Catat temuan hasil pengawasan..."></textarea>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Rekomendasi</label>
                                    <textarea class="form-control" id="assessment-recommendations" rows="4" placeholder="Berikan rekomendasi perbaikan..."></textarea>
                                </div>
                            </div>
                        </div>

                        <button type="submit" class="btn btn--primary">üíæ Simpan Penilaian</button>
                    </form>
                </div>
            </div>

            <!-- Results Page -->
            <div id="page-results" class="page-content hidden">
                <div class="page-header">
                    <h1 class="page-title">SiPESSI - Status Pengawasan</h1>
                    <p class="page-subtitle">Daftar hasil penilaian komprehensif 6 aspek</p>
                </div>

                <!-- Toolbar -->
                <div class="toolbar">
                    <div class="search-box">
                        <input type="text" class="form-control" id="search-audit" placeholder="Cari hasil penilaian...">
                        <select class="form-control" id="filter-audit-sector">
                            <option value="">Semua Sektor</option>
                            <option value="Tekstil">Tekstil</option>
                            <option value="Plastik">Plastik</option>
                            <option value="Kertas">Kertas</option>
                            <option value="Elektronik">Elektronik</option>
                            <option value="Kimia">Kimia</option>
                        </select>
                        <select class="form-control" id="filter-audit-category">
                            <option value="">Semua Kategori</option>
                            <option value="Sangat Baik">Sangat Baik</option>
                            <option value="Baik">Baik</option>
                            <option value="Cukup">Cukup</option>
                            <option value="Kurang">Kurang</option>
                        </select>
                    </div>
                    <button class="btn btn--primary" onclick="app.navigateTo('assessment')">+ Audit Baru</button>
                </div>

                <!-- Audits Table -->
                <div class="card">
                    <div class="card__body">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>No Audit</th>
                                    <th>Kode Industri</th>
                                    <th>Nama Industri</th>
                                    <th>Tanggal</th>
                                    <th>Pengawas</th>
                                    <th>Teknis</th>
                                    <th>Ekonomi</th>
                                    <th>Sosial</th>
                                    <th>Lingkungan</th>
                                    <th>Sirkular</th>
                                    <th>Perizinan</th>
                                    <th>Skor Total</th>
                                    <th>Kategori</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="audits-table-body">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Template & Info Page -->
            <div id="page-template" class="page-content hidden">
                <div class="page-header">
                    <h1 class="page-title">Panduan Penilaian &amp; Template</h1>
                    <p class="page-subtitle">Referensi skala penilaian dan kriteria indikator</p>
                </div>

                <!-- Scoring Guide -->
                <div class="card mb-16">
                    <div class="card__body">
                        <h3 class="mb-16">Panduan Skala Penilaian 1-5</h3>
                        <div class="form-row" id="template-scales-container"></div>
                    </div>
                </div>

                <!-- Aspek Detail -->
                <div id="template-aspects-container"></div>

                <!-- Formula -->
                <div class="card">
                    <div class="card__body">
                        <h3 class="mb-16">Rumus Perhitungan Skor</h3>
                        <div style="background-color: var(--color-bg-1); padding: var(--space-20); border-radius: var(--radius-lg); font-family: var(--font-family-mono);">
                            <p style="margin: 0; font-size: var(--font-size-lg);"><strong>Skor Total Akhir = </strong></p>
                            <p style="margin: var(--space-8) 0;">Rata-rata dari 6 aspek: (Teknis + Ekonomi + Sosial + Lingkungan + Sirkular + Perizinan) / 6</p>
                            <hr style="border: 1px solid var(--color-border); margin: var(--space-16) 0;">
                            <p style="margin: var(--space-8) 0;"><strong>Kategori:</strong></p>
                            <p style="margin: var(--space-4) 0;">4.1 - 5.0 = Sangat Baik</p>
                            <p style="margin: var(--space-4) 0;">3.1 - 4.0 = Baik</p>
                            <p style="margin: var(--space-4) 0;">2.1 - 3.0 = Cukup</p>
                            <p style="margin: var(--space-4) 0;">1.1 - 2.0 = Kurang</p>
                            <p style="margin: var(--space-4) 0;">0.0 - 1.0 = Sangat Kurang</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Statistics Page (OLD, can be removed or repurposed) -->
            <div id="page-statistics" class="page-content hidden" style="display:none;">
                <div class="page-header">
                    <h1 class="page-title">Analisis Statistik</h1>
                    <p class="page-subtitle">Statistik deskriptif dan analisis per dimensi</p>
                </div>

                <!-- Descriptive Statistics -->
                <div class="card mb-16">
                    <div class="card__body">
                        <h3 class="mb-16">Statistik Deskriptif per Dimensi</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Dimensi</th>
                                    <th>Mean</th>
                                    <th>Median</th>
                                    <th>Std Dev</th>
                                    <th>Min</th>
                                    <th>Max</th>
                                </tr>
                            </thead>
                            <tbody id="stats-descriptive-body">
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Charts Grid -->
                <div class="charts-grid">
                    <div class="chart-container">
                        <h3 class="chart-title">Analisis per Sektor</h3>
                        <canvas id="statsSectorChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3 class="chart-title">Analisis per Pengawas</h3>
                        <canvas id="statsAuditorChart"></canvas>
                    </div>
                </div>

                <!-- Quarterly Trend -->
                <div class="card mt-24">
                    <div class="card__body">
                        <h3 class="mb-16">Trend Kuartal 2025</h3>
                        <div style="height: 350px;">
                            <canvas id="statsQuarterlyChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recommendations Page -->
            <div id="page-recommendations" class="page-content hidden">
                <div class="page-header">
                    <h1 class="page-title">Rekomendasi &amp; Follow-up</h1>
                    <p class="page-subtitle">Kelola rekomendasi perbaikan dan monitoring follow-up</p>
                </div>

                <!-- Toolbar -->
                <div class="toolbar">
                    <div class="search-box">
                        <select class="form-control" id="filter-recommendation-status">
                            <option value="">Semua Status</option>
                            <option value="Open">Open</option>
                            <option value="In Progress">In Progress</option>
                            <option value="Completed">Completed</option>
                            <option value="Overdue">Overdue</option>
                        </select>
                        <select class="form-control" id="filter-recommendation-priority">
                            <option value="">Semua Prioritas</option>
                            <option value="Segera (3 bulan)">Segera (3 bulan)</option>
                            <option value="Mendesak (6 bulan)">Mendesak (6 bulan)</option>
                            <option value="Jangka Panjang (1 tahun)">Jangka Panjang (1 tahun)</option>
                        </select>
                    </div>
                    <button class="btn btn--primary" onclick="app.showAddRecommendationModal()">+ Tambah Rekomendasi</button>
                </div>

                <!-- Recommendations Table -->
                <div class="card">
                    <div class="card__body">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>No Audit</th>
                                    <th>Industri</th>
                                    <th>Rekomendasi</th>
                                    <th>Prioritas</th>
                                    <th>Target</th>
                                    <th>Status</th>
                                    <th>Progress</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="recommendations-table-body">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- OLD Template Page (replaced above) -->
            <div id="page-template-old" class="page-content hidden" style="display:none;">
                <div class="page-header">
                    <h1 class="page-title">Template Penilaian</h1>
                    <p class="page-subtitle">Referensi kriteria penilaian ekonomi sirkular</p>
                </div>

                <!-- Scoring Guide -->
                <div class="card mb-16">
                    <div class="card__body">
                        <h3 class="mb-16">Panduan Skala Penilaian</h3>
                        <div class="form-row">
                            <div class="stat-card" style="background-color: var(--color-bg-1);">
                                <div class="stat-value" style="font-size: var(--font-size-3xl);">1</div>
                                <div class="stat-label">Tidak Ada Implementasi</div>
                                <p style="font-size: var(--font-size-sm); margin: 0;">Belum ada sistem atau praktik yang diterapkan</p>
                            </div>
                            <div class="stat-card" style="background-color: var(--color-bg-2);">
                                <div class="stat-value" style="font-size: var(--font-size-3xl);">2</div>
                                <div class="stat-label">Implementasi Minimal</div>
                                <p style="font-size: var(--font-size-sm); margin: 0;">Ada beberapa inisiatif namun belum terstruktur</p>
                            </div>
                            <div class="stat-card" style="background-color: var(--color-bg-3);">
                                <div class="stat-value" style="font-size: var(--font-size-3xl);">3</div>
                                <div class="stat-label">Implementasi Parsial</div>
                                <p style="font-size: var(--font-size-sm); margin: 0;">Sistem ada namun belum optimal</p>
                            </div>
                            <div class="stat-card" style="background-color: var(--color-bg-4);">
                                <div class="stat-value" style="font-size: var(--font-size-3xl);">4</div>
                                <div class="stat-label">Implementasi Baik</div>
                                <p style="font-size: var(--font-size-sm); margin: 0;">Sistem berjalan dengan baik dan terukur</p>
                            </div>
                            <div class="stat-card" style="background-color: var(--color-bg-5);">
                                <div class="stat-value" style="font-size: var(--font-size-3xl);">5</div>
                                <div class="stat-label">Implementasi Excellent</div>
                                <p style="font-size: var(--font-size-sm); margin: 0;">Best practice dengan inovasi berkelanjutan</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Dimensions Detail -->
                <div id="template-dimensions-container"></div>

                <!-- Scoring Formula -->
                <div class="card">
                    <div class="card__body">
                        <h3 class="mb-16">Rumus Perhitungan Skor</h3>
                        <div style="background-color: var(--color-bg-1); padding: var(--space-20); border-radius: var(--radius-lg); font-family: var(--font-family-mono);">
                            <p style="margin: 0; font-size: var(--font-size-lg);"><strong>Skor Akhir = </strong></p>
                            <p style="margin: var(--space-8) 0;">(D1 √ó 0.20) + (D2 √ó 0.20) + (D3 √ó 0.20) + (D4 √ó 0.20) + (D5 √ó 0.10) + (D6 √ó 0.10)</p>
                            <hr style="border: 1px solid var(--color-border); margin: var(--space-16) 0;">
                            <p style="margin: var(--space-8) 0;"><strong>Kategori:</strong></p>
                            <p style="margin: var(--space-4) 0;">4.1 - 5.0 = Sangat Baik</p>
                            <p style="margin: var(--space-4) 0;">3.1 - 4.0 = Baik</p>
                            <p style="margin: var(--space-4) 0;">2.1 - 3.0 = Cukup</p>
                            <p style="margin: var(--space-4) 0;">1.1 - 2.0 = Kurang</p>
                            <p style="margin: var(--space-4) 0;">0.0 - 1.0 = Sangat Kurang</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CIRCULAR ECONOMY ASSESSMENT PAGE -->
            <div id="page-circular-economy" class="page-content hidden">
                <div class="page-header">
                    <h1 class="page-title">SiPESSI - Penilaian Ekonomi Sirkular</h1>
                    <p class="page-subtitle">Sistem Penilaian Komprehensif 6 Dimensi Ekonomi Sirkular di Sektor Industri</p>
                </div>

                <!-- Navigation Tabs -->
                <div class="toolbar" style="margin-bottom:var(--space-24); border-bottom: 2px solid var(--color-border);">
                    <button class="btn btn--primary" id="tab-ce-list" style="border-radius: 0; border-bottom: 3px solid var(--color-primary);">üìã Daftar Penilaian</button>
                    <button class="btn btn--secondary" id="tab-ce-form" style="border-radius: 0;">üìù Form Pengisian</button>
                    <button class="btn btn--secondary" id="tab-ce-guide" style="border-radius: 0;">üìö Panduan &amp; Skoring</button>
                </div>

                <!-- TAB 1: LIST OF ASSESSMENTS -->
                <div id="ce-list-content" class="ce-tab-content">
                    <div class="toolbar">
                        <div class="search-box">
                            <input type="text" class="form-control" id="ce-search" placeholder="Cari penilaian...">
                            <select class="form-control" id="ce-filter-category">
                                <option value="">Semua Kategori</option>
                                <option value="Sangat Baik">Sangat Baik (4.1-5.0)</option>
                                <option value="Baik">Baik (3.1-4.0)</option>
                                <option value="Cukup">Cukup (2.1-3.0)</option>
                                <option value="Kurang">Kurang (1.1-2.0)</option>
                                <option value="Sangat Kurang">Sangat Kurang (0.0-1.0)</option>
                            </select>
                            <input type="date" class="form-control" id="ce-filter-date" placeholder="Filter tanggal">
                        </div>
                        <button class="btn btn--primary" onclick="app.showCreateCEAssessmentModal()">+ Buat Penilaian Baru</button>
                    </div>

                    <div class="card mt-24">
                        <div class="card__body">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>No</th>
                                        <th>Nama Perusahaan</th>
                                        <th>Tanggal Penilaian</th>
                                        <th>Skor Total</th>
                                        <th>Kategori</th>
                                        <th>Pengawas</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="ce-assessments-table"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- TAB 2: ASSESSMENT FORM -->
                <div id="ce-form-content" class="ce-tab-content hidden">
                    <div class="alert alert-error" id="ce-form-empty" style="text-align:center; padding:var(--space-32);">
                        üìã Belum ada penilaian aktif<br><br>
                        <span style="font-size:var(--font-size-sm);">Klik "Buat Penilaian Baru" di tab Daftar Penilaian untuk memulai</span>
                    </div>
                    <div id="ce-form-container" class="hidden">
                        <!-- Company Info Header -->
                        <div class="card mb-16" style="background: linear-gradient(135deg, var(--color-primary), var(--color-teal-400)); color: white;">
                            <div class="card__body">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <h3 id="ce-current-company" style="color: white; margin-bottom: var(--space-8);">-</h3>
                                        <div style="display: flex; gap: var(--space-24); font-size: var(--font-size-sm);">
                                            <span>üìÖ <span id="ce-current-date">-</span></span>
                                            <span>üë§ <span id="ce-current-auditor">-</span></span>
                                        </div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="font-size: var(--font-size-sm); opacity: 0.9;">Skor Sementara</div>
                                        <div style="font-size: var(--font-size-4xl); font-weight: bold;" id="ce-current-score">0.0</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Progress Tracker -->
                        <div class="card mb-16">
                            <div class="card__body">
                                <h4 style="margin-bottom: var(--space-16);">Progress Penilaian 6 Dimensi</h4>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: var(--space-12);">
                                    <div class="stat-card" style="background: var(--color-bg-1); cursor: pointer;" onclick="app.jumpToCEDimension('D1')">
                                        <div style="font-size: var(--font-size-xs); margin-bottom: 4px;">D1: Efisiensi Sumber Daya</div>
                                        <div style="font-size: var(--font-size-xl); font-weight: bold;" id="ce-progress-d1">0/4</div>
                                    </div>
                                    <div class="stat-card" style="background: var(--color-bg-2); cursor: pointer;" onclick="app.jumpToCEDimension('D2')">
                                        <div style="font-size: var(--font-size-xs); margin-bottom: 4px;">D2: Minimalisasi Limbah</div>
                                        <div style="font-size: var(--font-size-xl); font-weight: bold;" id="ce-progress-d2">0/4</div>
                                    </div>
                                    <div class="stat-card" style="background: var(--color-bg-3); cursor: pointer;" onclick="app.jumpToCEDimension('D3')">
                                        <div style="font-size: var(--font-size-xs); margin-bottom: 4px;">D3: Desain Berkelanjutan</div>
                                        <div style="font-size: var(--font-size-xl); font-weight: bold;" id="ce-progress-d3">0/4</div>
                                    </div>
                                    <div class="stat-card" style="background: var(--color-bg-4); cursor: pointer;" onclick="app.jumpToCEDimension('D4')">
                                        <div style="font-size: var(--font-size-xs); margin-bottom: 4px;">D4: Pemanfaatan Ulang</div>
                                        <div style="font-size: var(--font-size-xl); font-weight: bold;" id="ce-progress-d4">0/4</div>
                                    </div>
                                    <div class="stat-card" style="background: var(--color-bg-5); cursor: pointer;" onclick="app.jumpToCEDimension('D5')">
                                        <div style="font-size: var(--font-size-xs); margin-bottom: 4px;">D5: Rantai Pasok</div>
                                        <div style="font-size: var(--font-size-xl); font-weight: bold;" id="ce-progress-d5">0/3</div>
                                    </div>
                                    <div class="stat-card" style="background: var(--color-bg-6); cursor: pointer;" onclick="app.jumpToCEDimension('D6')">
                                        <div style="font-size: var(--font-size-xs); margin-bottom: 4px;">D6: Manajemen &amp; Inovasi</div>
                                        <div style="font-size: var(--font-size-xl); font-weight: bold;" id="ce-progress-d6">0/4</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Dimensions Form -->
                        <div id="ce-dimensions-container"></div>

                        <!-- Summary & Actions -->
                        <div class="card mb-16" style="background: var(--color-bg-1);">
                            <div class="card__body">
                                <h4 style="margin-bottom: var(--space-16);">Ringkasan Skor per Dimensi</h4>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--space-12);">
                                    <div>
                                        <div style="font-size: var(--font-size-xs); color: var(--color-text-secondary);">D1: Efisiensi Sumber Daya (20%)</div>
                                        <div style="font-size: var(--font-size-2xl); font-weight: bold; color: var(--color-primary);" id="ce-score-d1">0.0</div>
                                    </div>
                                    <div>
                                        <div style="font-size: var(--font-size-xs); color: var(--color-text-secondary);">D2: Minimalisasi Limbah (20%)</div>
                                        <div style="font-size: var(--font-size-2xl); font-weight: bold; color: var(--color-primary);" id="ce-score-d2">0.0</div>
                                    </div>
                                    <div>
                                        <div style="font-size: var(--font-size-xs); color: var(--color-text-secondary);">D3: Desain Berkelanjutan (20%)</div>
                                        <div style="font-size: var(--font-size-2xl); font-weight: bold; color: var(--color-primary);" id="ce-score-d3">0.0</div>
                                    </div>
                                    <div>
                                        <div style="font-size: var(--font-size-xs); color: var(--color-text-secondary);">D4: Pemanfaatan Ulang (20%)</div>
                                        <div style="font-size: var(--font-size-2xl); font-weight: bold; color: var(--color-primary);" id="ce-score-d4">0.0</div>
                                    </div>
                                    <div>
                                        <div style="font-size: var(--font-size-xs); color: var(--color-text-secondary);">D5: Rantai Pasok (10%)</div>
                                        <div style="font-size: var(--font-size-2xl); font-weight: bold; color: var(--color-primary);" id="ce-score-d5">0.0</div>
                                    </div>
                                    <div>
                                        <div style="font-size: var(--font-size-xs); color: var(--color-text-secondary);">D6: Manajemen &amp; Inovasi (10%)</div>
                                        <div style="font-size: var(--font-size-2xl); font-weight: bold; color: var(--color-primary);" id="ce-score-d6">0.0</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Total Score Display -->
                        <div class="total-score-display">
                            <div class="total-score-label">Skor Total Ekonomi Sirkular</div>
                            <div class="total-score-value" id="ce-total-score">0.0</div>
                            <div class="total-score-category" id="ce-total-category"></div>
                        </div>

                        <!-- Catatan Umum -->
                        <div class="card mb-16">
                            <div class="card__body">
                                <h4 style="margin-bottom: var(--space-16);">Catatan Umum &amp; Rekomendasi</h4>
                                <div class="form-group">
                                    <label class="form-label">Catatan Temuan</label>
                                    <textarea class="form-control" id="ce-notes" rows="3" placeholder="Catat temuan penting dari penilaian..."></textarea>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Rekomendasi Perbaikan</label>
                                    <textarea class="form-control" id="ce-recommendations" rows="3" placeholder="Berikan rekomendasi untuk improvement..."></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div style="display: flex; gap: var(--space-12); justify-content: center;">
                            <button class="btn btn--primary" onclick="app.saveCEAssessment()" style="min-width: 150px;">üíæ Simpan Penilaian</button>
                            <button class="btn btn--secondary" onclick="app.resetCEForm()" style="min-width: 150px;">üîÑ Reset Form</button>
                            <button class="btn btn--secondary" onclick="app.exportCEReport()" style="min-width: 150px;">üìÑ Export PDF</button>
                        </div>
                    </div>
                </div>

                <!-- TAB 3: GUIDE & SCORING -->
                <div id="ce-guide-content" class="ce-tab-content hidden">
                    <div class="card mb-16">
                        <div class="card__body">
                            <h3 style="margin-bottom: var(--space-16);">üìä Sistem Skoring Ekonomi Sirkular</h3>
                            <div style="background: var(--color-bg-1); padding: var(--space-20); border-radius: var(--radius-lg); font-family: var(--font-family-mono);">
                                <p style="margin: 0; font-size: var(--font-size-lg);"><strong>Rumus Perhitungan:</strong></p>
                                <p style="margin: var(--space-12) 0;">Skor Dimensi = Rata-rata skor indikator dalam dimensi √ó Bobot dimensi</p>
                                <p style="margin: var(--space-12) 0;"><strong>Skor Total = </strong>(D1 √ó 20%) + (D2 √ó 20%) + (D3 √ó 20%) + (D4 √ó 20%) + (D5 √ó 10%) + (D6 √ó 10%)</p>
                                <hr style="border: 1px solid var(--color-border); margin: var(--space-16) 0;">
                                <p style="margin: var(--space-8) 0;"><strong>Kategori Penilaian:</strong></p>
                                <div style="display: grid; gap: var(--space-8);">
                                    <div style="padding: var(--space-8); background: #208f81; color: white; border-radius: var(--radius-sm);">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê 4.1 - 5.0 = <strong>Sangat Baik</strong> - Implementasi sempurna, excellence</div>
                                    <div style="padding: var(--space-8); background: #32b8c6; color: white; border-radius: var(--radius-sm);">‚≠ê‚≠ê‚≠ê‚≠ê 3.1 - 4.0 = <strong>Baik</strong> - Implementasi bagus, ada area development</div>
                                    <div style="padding: var(--space-8); background: #e6a161; color: white; border-radius: var(--radius-sm);">‚≠ê‚≠ê‚≠ê 2.1 - 3.0 = <strong>Cukup</strong> - Implementasi dasar, perlu improvement</div>
                                    <div style="padding: var(--space-8); background: #ff5459; color: white; border-radius: var(--radius-sm);">‚≠ê‚≠ê 1.1 - 2.0 = <strong>Kurang</strong> - Implementasi minimal, perlu action urgent</div>
                                    <div style="padding: var(--space-8); background: #c01b2f; color: white; border-radius: var(--radius-sm);">‚≠ê 0.0 - 1.0 = <strong>Sangat Kurang</strong> - Hampir tidak ada, critical</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Panduan Skala 1-5 -->
                    <div class="card mb-16">
                        <div class="card__body">
                            <h3 style="margin-bottom: var(--space-16);">üìè Panduan Skala Penilaian 1-5</h3>
                            <div id="ce-scale-guide"></div>
                        </div>
                    </div>

                    <!-- Panduan per Dimensi -->
                    <div id="ce-dimension-guide"></div>
                </div>
            </div>

            <!-- Reports Page -->
            <div id="page-reports" class="page-content hidden">
                <div class="page-header">
                    <h1 class="page-title">Laporan &amp; Analisis</h1>
                    <p class="page-subtitle">Lihat hasil pengawasan dan analisis data</p>
                </div>

                <!-- Export Buttons -->
                <div class="toolbar">
                    <div></div>
                    <div style="display: flex; gap: var(--space-8);">
                        <button class="btn btn--secondary" onclick="app.exportToExcel()">üìä Export Excel</button>
                        <button class="btn btn--secondary" onclick="app.generatePDF()">üìÑ Generate PDF</button>
                    </div>
                </div>

                <!-- Reports Table -->
                <div class="card mb-16">
                    <div class="card__body">
                        <h3 class="mb-16">Daftar Laporan Pengawasan</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>Nama Industri</th>
                                    <th>Tanggal Audit</th>
                                    <th>Skor Total</th>
                                    <th>Kategori</th>
                                    <th>Auditor</th>
                                </tr>
                            </thead>
                            <tbody id="reports-table-body">
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Sector Comparison Chart -->
                <div class="card">
                    <div class="card__body">
                        <h3 class="mb-16">Analisis Perbandingan Antar Sektor</h3>
                        <div style="height: 400px;">
                            <canvas id="sectorComparisonChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal Templates -->
    <div id="modal-add-industry" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Tambah Industri Baru</h2>
                <button class="close-btn" onclick="app.closeModal('modal-add-industry')">&times;</button>
            </div>
            <form id="add-industry-form">
                <div class="form-group">
                    <label class="form-label">Nama Industri</label>
                    <input type="text" class="form-control" id="industry-name" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Sektor</label>
                        <select class="form-control" id="industry-sector" required>
                            <option value="">-- Pilih Sektor --</option>
                            <option value="Tekstil">Tekstil</option>
                            <option value="Plastik">Plastik</option>
                            <option value="Kertas">Kertas</option>
                            <option value="Elektronik">Elektronik</option>
                            <option value="Kimia">Kimia</option>
                            <option value="Minuman">Minuman</option>
                            <option value="Logam">Logam</option>
                            <option value="Otomotif">Otomotif</option>
                            <option value="Lainnya">Lainnya</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Lokasi</label>
                        <input type="text" class="form-control" id="industry-location" required>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Status</label>
                    <select class="form-control" id="industry-status" required>
                        <option value="Aktif">Aktif</option>
                        <option value="Audit Ulang">Audit Ulang</option>
                        <option value="Pending">Pending</option>
                    </select>
                </div>
                <div class="mt-24">
                    <button type="submit" class="btn btn--primary">Simpan</button>
                    <button type="button" class="btn btn--secondary" onclick="app.closeModal('modal-add-industry')">Batal</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // ----- APP DATA (ALL 6 ASPEK INDIKATOR) -----
        const aspekData = [
  // Aspek Teknis
  {id: "A1", code: "TEKNIS", name: "Aspek Teknis", color: "#2563eb", indicators: [
    {id:"T1", name: "Ketersediaan SOP Produksi Tertulis", description: "Ketersediaan Standar Operasional Prosedur (SOP) produksi yang tertulis, jelas, dan dapat diakses oleh semua operator", method: "Dokumentasi review, wawancara operator, observasi lapangan", evidence: ["SOP tertulis", "Bukti pelatihan", "Log implementasi"], weight: 8},
    {id:"T2", name: "Pelatihan Operator Berkala", description: "Program pelatihan berkala untuk operator produksi mencakup pengetahuan teknis, safety, dan best practices", method: "Dokumentasi training records, sertifikat, presensi", evidence: ["Training schedule", "Certificate", "Attendance records"], weight: 8},
    {id:"T3", name: "Pengendalian Mutu Produk", description: "Sistem pengendalian kualitas produk yang terstruktur di setiap tahap produksi", method: "Lab testing, dokumentasi QC records, inspeksi visual", evidence: ["QC SOP", "Test results", "Non-conformance records"], weight: 10},
    {id:"T4", name: "Kalibrasi & Maintenance Peralatan", description: "Program kalibrasi berkala dan maintenance terencana untuk semua peralatan kritis", method: "Maintenance log review, kalibrasi certificate, on-site inspection", evidence: ["Calibration certificates", "Maintenance log", "Equipment list"], weight: 8},
    {id:"T5", name: "Dokumentasi Produksi", description: "Pencatatan lengkap setiap batch produksi termasuk input, proses, output, dan anomali", method: "Dokumentasi review, database system check", evidence: ["Production records", "Batch logs", "Digital/manual documentation"], weight: 7},
    {id:"T6", name: "Riwayat Pengaduan Produk", description: "Sistem penanganan keluhan pelanggan dan analisis root cause", method: "Complaint log review, CAPA documentation", evidence: ["Complaint log", "CAPA reports", "Customer feedback records"], weight: 6},
    {id:"T7", name: "Peralatan Produksi Modern", description: "Peralatan produksi yang memenuhi standar industri terkini dan efisien", method: "Physical inspection, equipment specification review", evidence: ["Equipment list", "Technical specifications", "Maintenance records"], weight: 7},
    {id:"T8", name: "Uji Produk Eksternal", description: "Pengujian produk di laboratorium terakreditasi secara berkala", method: "Test certificate review, lab accreditation verification", evidence: ["Lab test certificates", "Accreditation numbers", "Test reports"], weight: 8},
    {id:"T9", name: "Traceability Produk", description: "Sistem pelacakan produk dari bahan baku hingga pengiriman ke pelanggan", method: "System demonstration, trace test, documentation review", evidence: ["Traceability system", "Trace test results", "Product codes"], weight: 7},
    {id:"T10", name: "Pengendalian Bahan Baku", description: "Penerimaan dan penyimpanan bahan baku yang memenuhi spesifikasi", method: "Incoming inspection review, storage area inspection", evidence: ["Receiving SOP", "Inspection records", "Storage conditions"], weight: 8},
    {id:"T11", name: "Keamanan Pangan (jika relevan)", description: "Penerapan sistem HACCP atau food safety management jika industri pangan", method: "HACCP documentation, hazard analysis, CCP monitoring", evidence: ["HACCP plan", "Hazard analysis", "CCP records"], weight: 8},
    {id:"T12", name: "Pengemasan & Labeling", description: "Pengemasan produk yang aman dan labeling yang sesuai regulasi", method: "Package inspection, label review, storage area check", evidence: ["Packaging specification", "Label samples", "Storage logs"], weight: 7}
  ]},
  // Aspek Ekonomi
  {id: "A2", code: "EKONOMI", name: "Aspek Ekonomi", color: "#16a34a", indicators: [
    {id:"E1", name: "Kinerja Penjualan", description: "Tren penjualan dan market share dalam 3 tahun terakhir", method: "Financial records review, market analysis", evidence: ["Sales reports", "Financial statements", "Market data"], weight: 10},
    {id:"E2", name: "Profitabilitas", description: "Margin keuntungan bersih dan return on investment (ROI)", method: "Financial analysis, P&L statement", evidence: ["Financial statements", "Income statement", "Balance sheet"], weight: 10},
    {id:"E3", name: "Efisiensi Biaya Produksi", description: "Cost per unit produk dan trend biaya dalam 3 tahun", method: "Cost accounting analysis, production efficiency data", evidence: ["Cost accounting records", "Production efficiency data"], weight: 9},
    {id:"E4", name: "Investasi Teknologi & Inovasi", description: "Budget dan implementasi investasi untuk modernisasi/inovasi", method: "Budget review, project documentation", evidence: ["Investment budget", "Project reports", "Equipment purchase records"], weight: 8},
    {id:"E5", name: "Hutang & Likuiditas", description: "Rasio hutang dan kemampuan likuiditas perusahaan", method: "Financial analysis, cash flow review", evidence: ["Balance sheet", "Cash flow statement", "Debt schedule"], weight: 8},
    {id:"E6", name: "Sumber Dana & Investasi", description: "Sumber pendanaan yang stabil dan investor involvement", method: "Funding source documentation, shareholder information", evidence: ["Share certificate", "Investor agreement", "Funding records"], weight: 7},
    {id:"E7", name: "Ekspor & Pasar Internasional", description: "Partisipasi dalam ekspor dan penetrasi pasar internasional", method: "Export documentation, international order records", evidence: ["Export licenses", "Invoice/PO", "Foreign customer list"], weight: 7},
    {id:"E8", name: "Kapasitas Produksi & Utilisasi", description: "Kapasitas terpasang dan tingkat utilisasi rata-rata", method: "Capacity assessment, production log analysis", evidence: ["Equipment capacity list", "Production reports", "Utilization data"], weight: 8}
  ]},
  // Aspek Sosial
  {id: "A3", code: "SOSIAL", name: "Aspek Sosial", color: "#d97706", indicators: [
    {id: "S1", name: "Jumlah & Pertumbuhan Karyawan", description:"Jumlah karyawan dan trend pertumbuhan ketenagakerjaan", method: "HR records, payroll data", evidence: ["Employee roster", "Payroll records", "HR database"], weight: 8},
    {id: "S2", name: "Kesetaraan Upah & Benefit", description:"Compliance dengan upah minimum dan benefit sesuai regulasi", method: "Payroll verification, salary structure review", evidence: ["Salary structure", "Payroll records", "Benefit documentation"], weight: 10},
    {id: "S3", name: "Kesejahteraan Karyawan", description:"Program kesehatan, asuransi, pensiun, dan welfare lainnya", method: "Program documentation, employee satisfaction survey", evidence: ["Welfare programs", "Insurance certificates", "Survey results"], weight: 9},
    {id: "S4", name: "Hubungan Industri & Komunikasi", description:"Sistem komunikasi dengan karyawan dan penanganan konflik", method: "IR policy review, grievance records, meeting documentation", evidence: ["IR policy", "Grievance log", "Meeting minutes"], weight: 8},
    {id: "S5", name: "Pelatihan & Pengembangan Karyawan", description:"Program pelatihan berkelanjutan dan career development", method: "Training records, career path documentation", evidence: ["Training schedule", "Certificate", "Career development plan"], weight: 8},
    {id: "S6", name: "Program Pemberdayaan Komunitas Lokal", description:"Program CSR dan pemberdayaan masyarakat sekitar pabrik", method: "CSR program documentation, community feedback", evidence: ["CSR programs", "Project reports", "Community letter"], weight: 7},
    {id: "S7", name: "Kepuasan Pelanggan", description:"Tingkat kepuasan pelanggan berdasarkan survey atau feedback", method: "Customer satisfaction survey, feedback analysis", evidence: ["Survey results", "Feedback records", "NPS score"], weight: 7},
    {id: "S8", name: "Transparansi & Akuntabilitas", description:"Transparansi informasi dan accountability terhadap stakeholder", method: "Disclosure review, stakeholder communication records", evidence: ["Annual report", "Disclosure documents", "Communication log"], weight: 8},
    {id: "S9", name: "Keberagaman & Inklusi", description:"Kebijakan dan implementasi keberagaman di tempat kerja", method: "Diversity policy review, demographic analysis", evidence: ["Diversity policy", "Employee demographics", "Inclusion programs"], weight: 6},
    {id: "S10", name: "Kepemilikan Lokal & BUMN", description:"Status kepemilikan: lokal, BUMN, atau multinational", method: "Corporate structure review, ownership documentation", evidence: ["Share certificate", "Corporate charter", "Ownership structure"], weight: 7}
  ]},
  // Aspek Lingkungan
  {id: "A4", code: "LINGKUNGAN", name: "Aspek Lingkungan", color: "#dc2626", indicators: [
    {id: "L1", name: "Kepatuhan Baku Mutu Air Limbah", description:"Kepatuhan terhadap baku mutu air limbah sesuai PP & regulasi daerah", method: "Water test by accredited lab, lab certificate", evidence: ["Lab test results", "Accreditation certificate", "Monthly reports"], weight: 10},
    {id: "L2", name: "Instalasi IPAL Berfungsi & Terawat", description:"Instalasi Pengolahan Air Limbah (IPAL) dalam kondisi operasional baik", method: "Physical inspection, operational record review", evidence: ["IPAL design", "Maintenance log", "Operation manual"], weight: 10},
    {id: "L3", name: "Pengelolaan Air Limbah Terukur", description:"Pengukuran dan pencatatan debit air limbah yang keluar", method: "Flow meter installation check, measurement log", evidence: ["Flow meter calibration", "Daily log", "Monthly summary"], weight: 8},
    {id: "L4", name: "Kepatuhan Baku Mutu Emisi Udara", description:"Kepatuhan baku mutu emisi udara dari cerobong/stack", method: "Stack test by accredited lab, annual monitoring", evidence: ["Stack test results", "Lab certificate", "Annual reports"], weight: 10},
    {id: "L5", name: "Sistem Pengendalian Polusi Udara", description:"Instalasi dust collector, scrubber, atau sistem pengendalian lainnya", method: "Physical inspection, maintenance record, efficiency test", evidence: ["System design", "Maintenance log", "Efficiency certificate"], weight: 9},
    {id: "L6", name: "Pengelolaan Limbah Padat Non-B3", description:"Pengelolaan limbah padat non-berbahaya sesuai regulasi", method: "Waste management plan review, site inspection", evidence: ["Waste management plan", "Disposal contract", "Waste log"], weight: 8},
    {id: "L7", name: "Pengelolaan Limbah B3 Sesuai PP 101/2014", description:"Kepatuhan pengelolaan limbah berbahaya & beracun (B3)", method: "B3 documentation, manifest review, storage inspection", evidence: ["B3 manifest", "TPST contract", "Waste log", "Storage cert"], weight: 10},
    {id: "L8", name: "Dokumentasi & Pelaporan Limbah", description:"Pencatatan lengkap dan pelaporan ke KLHK sesuai jadwal", method: "Report documentation, regulatory filing records", evidence: ["Monthly reports", "Annual reports", "Filing receipts"], weight: 8},
    {id: "L9", name: "Efisiensi Energi & Renewable", description:"Penerapan efisiensi energi dan penggunaan energi terbarukan", method: "Energy audit, renewable system verification", evidence: ["Energy audit report", "Solar panels records", "Energy bills"], weight: 7},
    {id: "L10", name: "Pengelolaan Kemasan & Plastik", description:"Pengurangan penggunaan plastik dan pengelolaan kemasan ramah lingkungan", method: "Packaging audit, supplier documentation", evidence: ["Packaging specification", "Supplier certificates", "Reduction plan"], weight: 6},
    {id: "L11", name: "Program Reboisasi & Konservasi", description:"Program penanaman pohon, penghijauan, atau konservasi alam", method: "Program documentation, site visit, photo evidence", evidence: ["Program plan", "Photo evidence", "Certificate"], weight: 6},
    {id: "L12", name: "Audit Lingkungan Internal", description:"Pelaksanaan audit lingkungan internal berkala", method: "Audit schedule, audit report review", evidence: ["Audit plan", "Audit reports", "Corrective action"], weight: 7},
    {id: "L13", name: "Compliance Environmental Permit", description:"Kepatuhan terhadap izin lingkungan (AMDAL/UKL-UPL) yang diterbitkan", method: "Permit document review, compliance verification", evidence: ["Izin lingkungan", "Compliance report", "Monitoring data"], weight: 9},
    {id: "L14", name: "Pelatihan Lingkungan Karyawan", description:"Program pelatihan kesadaran lingkungan untuk semua karyawan", method: "Training documentation, pre/post test results", evidence: ["Training materials", "Attendance list", "Test results"], weight: 6}
  ]},
  // Ekonomi Sirkular
  {id: "A5", code: "SIRKULAR", name: "Ekonomi Sirkular", color: "#7c3aed", indicators: [
    {id: "CE1", name: "Intensitas Material per Unit Produk (D1)", description: "Efisiensi penggunaan material mentah untuk setiap unit barang yang dihasilkan", method: "Material accounting review, production data analysis", weight: 5},
    {id: "CE2", name: "Konsumsi Energi per Unit Produksi (D1)", description: "Total konsumsi energi dibanding output produksi secara periodik", method: "Energy meter reading, production efficiency data", weight: 5},
    {id: "CE3", name: "Penggunaan Air per Unit Produksi (D1)", description: "Penggunaan air jika dibandingkan kuantitas produksi per satuan periode", method: "Water meter reading, usage log", weight: 4},
    {id: "CE4", name: "Material Terbarukan/Daur Ulang (D1)", description: "Persentase material ramah lingkungan dan recycled content", method: "Supplier certificate, material documentation", weight: 6},
    {id: "CE5", name: "Limbah Dihasilkan per Unit Produksi (D2)", description: "Jumlah limbah solid, cair, maupun gas per satuan produk yang dihasilkan", method: "Waste log analysis, weighing records", weight: 5},
    {id: "CE6", name: "Limbah Didaur Ulang/Dimanfaatkan (D2)", description: "Persentase limbah yang berhasil dimanfaatkan kembali atau didaur ulang", method: "Waste management documentation, recycling partner contract", weight: 6},
    {id: "CE7", name: "Pengurangan Limbah B3 (D2)", description: "Trend pengurangan limbah bahan berbahaya dan beracun", method: "B3 waste log trend analysis", weight: 5},
    {id: "CE8", name: "Program Zero Waste (D2)", description: "Adanya kebijakan zero waste dan implementasinya", method: "Program documentation, implementation records", weight: 5},
    {id: "CE9", name: "Design for Durability (D3)", description: "Desain produk mendukung usia pakai yang lebih lama", method: "Product design review, durability test result", weight: 5},
    {id: "CE10", name: "Design for Recycling (D3)", description: "Produk didesain agar mudah didaur ulang di akhir masa hidupnya", method: "Material composition review, recycling feasibility", weight: 5},
    {id: "CE11", name: "Minimalisasi Material Beracun (D3)", description: "Upaya menghilangkan atau mengganti bahan berbahaya pada produk", method: "Material MSDS review, substitution documentation", weight: 5},
    {id: "CE12", name: "Material Ramah Lingkungan (D3)", description: "Proporsi material tersertifikasi lingkungan / eco-label", method: "Supplier certification, eco-label verification", weight: 5},
    {id: "CE13", name: "Produk Dapat Didaur Ulang (D4)", description: "Persentase produk yang seluruh bagiannya dapat didaur ulang", method: "Product analysis, recycling assessment", weight: 6},
    {id: "CE14", name: "Recycled Content dalam Produk (D4)", description: "Produk mengandung bahan hasil daur ulang", method: "Material documentation, supplier certificate", weight: 6},
    {id: "CE15", name: "Program Take-back Produk (D4)", description: "Industri menerima kembali produk pasca konsumsi untuk recycle", method: "Program documentation, customer feedback", weight: 5},
    {id: "CE16", name: "Partnership Daur Ulang (D4)", description: "Kerjasama bermitra dengan pihak ketiga daur ulang", method: "Contract with recycling facilities, facility visit", weight: 5},
    {id: "CE17", name: "Kriteria Pemilihan Pemasok (D5)", description: "Vendor dipilih berdasar standar ramah lingkungan & praktek CE", method: "Supplier policy review, vendor list", weight: 4},
    {id: "CE18", name: "Kolaborasi Supplier untuk CE (D5)", description: "Supplier turut serta program pelatihan/kebijakan circular economy", method: "Supplier meeting documentation, training records", weight: 4},
    {id: "CE19", name: "Transparansi Jejak Material (D5)", description: "Adanya sistem pelacakan material dari hulu ke hilir", method: "Traceability system review, audit results", weight: 4},
    {id: "CE20", name: "Kebijakan Ekonomi Sirkular (D6)", description: "Terdokumentasi secara formal dalam kebijakan internal", method: "Policy document review, board approval", weight: 5},
    {id: "CE21", name: "Target & KPI Ekonomi Sirkular (D6)", description: "Ada target resmi dan KPI terkait kinerja circular economy", method: "Strategic plan review, KPI dashboard", weight: 5},
    {id: "CE22", name: "R&D & Inovasi Ekonomi Sirkular (D6)", description: "Belanja inovasi untuk implementasi circular economy", method: "R&D budget review, innovation project documentation", weight: 5},
    {id: "CE23", name: "Sertifikasi Ekonomi Sirkular (D6)", description: "Telah memiliki sertifikat atau telah diaudit external", method: "Certificate verification, audit results", weight: 4},
    {id: "CE24", name: "Komunikasi & Transparansi CE (D6)", description: "Ada pelaporan/sosialisasi progress circular economy internal/eksternal", method: "Sustainability report, stakeholder communication", weight: 4}
  ]},
  // Aspek Perizinan/Kepatuhan
  {id: "A6", code: "PERIZINAN", name: "Perizinan & Kepatuhan", color: "#0891b2", indicators: [
    {id: "P1", name: "Status Izin Usaha Industri", description: "Legalitas dan status izin usaha industri terbaru", method: "License verification at BKPM/OSS, document review", evidence: ["IUI/NIB", "OSS registration", "Validity date"], weight: 10},
    {id: "P2", name: "Izin Lingkungan (AMDAL/UKL-UPL)", description: "Kepatuhan terhadap dokumen perizinan lingkungan", method: "Permit verification with KLHK/Dinas Lingkungan", evidence: ["Izin Lingkungan", "AMDAL/UKL-UPL", "Validity date"], weight: 10},
    {id: "P3", name: "Izin Air Limbah", description: "Legalitas izin pembuangan air limbah", method: "License verification with DLH/DLHK", evidence: ["Izin limbah cair", "WWTP design", "Validity"], weight: 8},
    {id: "P4", name: "Izin Emisi Udara", description: "Legalitas izin emisi udara sumber tidak bergerak", method: "License verification, emission test certificate", evidence: ["Izin emisi", "Stack test results", "Validity"], weight: 8},
    {id: "P5", name: "Izin Penimbunan Sampah", description: "Legalitas izin penimbunan/disposal limbah padat", method: "License verification for waste disposal", evidence: ["Izin TPA", "Contract with TPA", "Disposal records"], weight: 6},
    {id: "P6", name: "Surat Keterangan Limbah B3", description: "Telah terdaftar sebagai penghasil limbah B3", method: "B3 registration at KLHK, manifest verification", evidence: ["Tanda daftar limbah B3", "Manifest", "Annual report"], weight: 8},
    {id: "P7", name: "Sertifikasi Industri Hijau", description: "Telah memperoleh sertifikasi industri hijau", method: "Green industry certification verification", evidence: ["Certificate", "Certification scope", "Validity"], weight: 7},
    {id: "P8", name: "Sertifikasi ISO (14001, 45001, etc)", description: "ISO Environment/Safety systems certification", method: "ISO certification verification, audit report", evidence: ["ISO certificates", "Audit reports", "Scope document"], weight: 7},
    {id: "P9", name: "Pengelolaan Dokumen & Arsip", description: "Pengelolaan dan penyimpanan dokumen legal", method: "Document management system review", evidence: ["Document index", "Filing system", "Storage"], weight: 6},
    {id: "P10", name: "Pelaporan Berkala ke Pemerintah", description: "Kepatuhan pelaporan SIINas, lingkungan, pajak", method: "Reporting schedule verification, filing receipts", evidence: ["SIINas reports", "Environmental reports", "Tax reports"], weight: 7}
  ]}
];

        // Skala penilaian 1-5 (static for matrix)
        const scaleData = [
  {value: 5, label: "Sangat Baik", description: "Implementasi sempurna, terukur, terdokumentasi, berkelanjutan", color: "#208f81"},
  {value: 4, label: "Baik", description: "Implementasi bagus, ada beberapa kekurangan minor", color: "#32b8c6"},
  {value: 3, label: "Cukup", description: "Implementasi dasar ada, namun belum optimal", color: "#e6a161"},
  {value: 2, label: "Kurang", description: "Implementasi minimal atau baru tahap awal", color: "#ff5459"},
  {value: 1, label: "Sangat Kurang", description: "Hampir tidak ada implementasi atau tidak sesuai", color: "#c01b2f"}
];

        // Application State
        // Global MASTER DATA
const MASTER_SEKTOR = [
  "Tekstil","Plastik","Kertas","Elektronik","Kimia","Minuman","Logam","Otomotif","Lainnya"
];
const MASTER_LOKASI = [
  "Aceh","Sumatera Utara","Sumatera Barat","Riau","Jambi","Sumatera Selatan","Lampung","Bengkulu","Bangka Belitung","Kepulauan Riau",
  "DKI Jakarta","Jawa Barat","Jawa Tengah","D.I. Yogyakarta","Jawa Timur","Banten","Bali","Nusa Tenggara Barat","Nusa Tenggara Timur",
  "Kalimantan Barat","Kalimantan Tengah","Kalimantan Selatan","Kalimantan Timur","Kalimantan Utara",
  "Sulawesi Utara","Sulawesi Tengah","Sulawesi Selatan","Sulawesi Tenggara","Gorontalo","Sulawesi Barat",
  "Maluku","Maluku Utara","Papua","Papua Barat"
];
const MASTER_STATUS = ["Aktif","Audit Ulang","Non-aktif"];
const MASTER_INSPECTION_STATUS = ["Belum Dimulai","On Progress","Selesai","Perlu Tindak Lanjut"];
const MASTER_INSPECTION_TYPE = ["Rutin","Khusus","Follow-up"];
const MASTER_DOC_TYPE = [
  "Berita Acara","Laporan Audit","Foto/Bukti","Checklist Pengawasan","Rekomendasi & CAP","Data Pengawasan"
];

const app = {
            industries: [],
            assessments: [],
            inspections: [],
            documents: [],
            workflows: [],
            currentAssessment: null,
            currentInspectionTab: 'status',
            charts: {},
            
            // Circular Economy Assessments
            ceAssessments: [],
            currentCEAssessment: null,
            ceData: null,
            currentCETab: 'list',

            // OLD Dimensions Configuration (replaced by aspekData global)
            dimensionsOLD: [
                {
                    id: 'd1',
                    name: 'Efisiensi Penggunaan Sumber Daya',
                    weight: 0.20,
                    indicators: [
                        'Intensitas Material per Unit Produk',
                        'Konsumsi Energi per Unit Produksi',
                        'Penggunaan Air per Unit Produksi',
                        'Penggunaan Material Terbarukan/Daur Ulang'
                    ]
                },
                {
                    id: 'd2',
                    name: 'Pengelolaan & Minimalisasi Limbah',
                    weight: 0.20,
                    indicators: [
                        'Jumlah Limbah Dihasilkan per Unit Produksi',
                        'Persentase Limbah Didaur Ulang/Dimanfaatkan',
                        'Tingkat Pengurangan Limbah Berbahaya (B3)',
                        'Implementasi Sistem Zero Waste'
                    ]
                },
                {
                    id: 'd3',
                    name: 'Desain Produk Berkelanjutan',
                    weight: 0.20,
                    indicators: [
                        'Design for Durability',
                        'Design for Recycling',
                        'Minimalisasi Material Beracun',
                        'Penggunaan Material Ramah Lingkungan'
                    ]
                },
                {
                    id: 'd4',
                    name: 'Pemanfaatan Kembali & Daur Ulang',
                    weight: 0.20,
                    indicators: [
                        'Persentase Produk yang Dapat Didaur Ulang',
                        'Tingkat Utilisasi Material Daur Ulang',
                        'Program Take-back Product',
                        'Kerjasama dengan Pihak Ketiga untuk Daur Ulang'
                    ]
                },
                {
                    id: 'd5',
                    name: 'Keterlibatan Rantai Pasok',
                    weight: 0.10,
                    indicators: [
                        'Kriteria Pemilihan Pemasok',
                        'Kolaborasi Supplier',
                        'Transparansi Jejak Material'
                    ]
                },
                {
                    id: 'd6',
                    name: 'Sistem Manajemen & Inovasi',
                    weight: 0.10,
                    indicators: [
                        'Kebijakan Ekonomi Sirkular',
                        'Target dan KPI Ekonomi Sirkular',
                        'R&D dan Inovasi'
                    ]
                }
            ],

            // Initialize App
            init() {
                this.populateMasterDropdowns();
                this.loadSampleData();
                this.loadCEData();
                this.setupNavigation();
                this.setupEventListeners();
                this.renderDashboard();
                this.renderIndustriesTable();
                this.populateAssessmentSelect();
            },

            // Populate Master Dropdowns
            populateMasterDropdowns() {
                const sectorSelects = ['industry-sector', 'filter-sector'];
                const lokasiSelects = ['industry-location'];
                const statusSelects = ['industry-status'];
                
                sectorSelects.forEach(id => {
                    const el = document.getElementById(id);
                    if (el) {
                        const hasEmpty = id.startsWith('filter');
                        el.innerHTML = (hasEmpty ? '<option value="">Semua Sektor</option>' : '<option value="">-- Pilih Sektor --</option>') + 
                            MASTER_SEKTOR.map(s => `<option value="${s}">${s}</option>`).join('');
                    }
                });
                lokasiSelects.forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.innerHTML = '<option value="">-- Pilih Lokasi --</option>' + MASTER_LOKASI.map(l => `<option value="${l}">${l}</option>`).join('');
                });
                statusSelects.forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.innerHTML = '<option value="">-- Pilih Status --</option>' + MASTER_STATUS.map(s => `<option value="${s}">${s}</option>`).join('');
                });
            },

            // Load Sample Data
            loadSampleData() {
                // START WITH EMPTY ARRAY - User will add companies manually
                this.industries = [];

                // Generate sample assessments and recommendations only if industries exist
                this.assessments = [];
                this.recommendations = [];
                
                // OLD: Generate aspek-based assessments with 6 scores
                this.assessments = this.industries.map((ind, idx) => {
                    const tk = 3.0 + Math.random() * 2;
                    const ek = 3.0 + Math.random() * 2;
                    const so = 3.0 + Math.random() * 2;
                    const li = 3.0 + Math.random() * 2;
                    const si = 3.0 + Math.random() * 2;
                    const pe = 3.0 + Math.random() * 2;
                    const totalScore = (tk + ek + so + li + si + pe) / 6;
                    
                    return {
                        id: idx + 1,
                        auditNo: 'AUD' + String(idx + 1).padStart(4, '0'),
                        industryId: ind.id,
                        industryCode: 'IND' + String(ind.id).padStart(3, '0'),
                        industryName: ind.name,
                        sector: ind.sector,
                        date: ind.lastAudit,
                        scoreTeknis: parseFloat(tk.toFixed(1)),
                        scoreEkonomi: parseFloat(ek.toFixed(1)),
                        scoreSosial: parseFloat(so.toFixed(1)),
                        scoreLingkungan: parseFloat(li.toFixed(1)),
                        scoreSirkular: parseFloat(si.toFixed(1)),
                        scorePerizinan: parseFloat(pe.toFixed(1)),
                        score: parseFloat(totalScore.toFixed(1)),
                        category: this.getScoreCategory(totalScore),
                        auditor: 'Tim Pengawas ' + (idx % 3 + 1),
                        findings: 'Temuan penilaian untuk ' + ind.name,
                        recommendations: 'Rekomendasi perbaikan untuk ' + ind.name
                    };
                });

                // Generate recommendations based on assessments
                this.recommendations = [];
                this.assessments.slice(0, 15).forEach((audit, idx) => {
                    const priorities = ['Segera (3 bulan)', 'Mendesak (6 bulan)', 'Jangka Panjang (1 tahun)'];
                    const statuses = ['Open', 'In Progress', 'Completed', 'Overdue'];
                    const today = new Date();
                    const targetDate = new Date(today);
                    targetDate.setMonth(targetDate.getMonth() + ((idx % 3) + 1) * 3);
                    
                    this.recommendations.push({
                        id: idx + 1,
                        auditNo: audit.auditNo,
                        industryName: audit.industryName,
                        recommendation: 'Perbaikan ' + aspekData[idx % 6].name,
                        priority: priorities[idx % 3],
                        targetDate: targetDate.toISOString().split('T')[0],
                        status: statuses[idx % 4],
                        progress: Math.floor(Math.random() * 100) + '%',
                        notes: 'Progress update',
                        lastUpdate: new Date().toISOString().split('T')[0]
                    });
                });
            },

            // Navigation
            // Inspection Tab Navigation
            // Circular Economy Assessment Functions
            loadCEData() {
                // Load CE dimension data from application_data_json
                this.ceData = {
                    dimensions: [
                        {
                            id: 'D1',
                            name: 'Efisiensi Penggunaan Sumber Daya',
                            weight: 20,
                            description: 'Kemampuan industri menggunakan sumber daya (material, energi, air) secara efisien per unit produksi',
                            indicators: [
                                {id: 'D1I1', name: 'Intensitas Material per Unit Produk', weight: 5, description: 'Pengurangan penggunaan material per unit produk dibanding baseline', method: 'Review material accounting, production data, trend analysis', scales: {5: 'Pengurangan >40%, terdokumentasi, berkelanjutan', 4: 'Pengurangan 25-40%, terdokumentasi, konsisten', 3: 'Pengurangan 10-25%, basic monitoring', 2: 'Pengurangan <10%, minimal monitoring', 1: 'Tidak ada pengurangan atau data tidak ada'}},
                                {id: 'D1I2', name: 'Konsumsi Energi per Unit Produksi', weight: 5, description: 'Efisiensi energi terhadap output produksi dengan target berkurang', method: 'Energy audit, smart meter data, production records', scales: {5: 'Efisiensi >30%, energi terbarukan >50%, sertifikasi ISO 50001', 4: 'Efisiensi 20-30%, energi terbarukan 25-50%', 3: 'Efisiensi 10-20%, energi terbarukan <25%', 2: 'Efisiensi <10%, minimal program', 1: 'Tidak ada program efisiensi energi'}},
                                {id: 'D1I3', name: 'Penggunaan Air per Unit Produksi', weight: 4, description: 'Efisiensi penggunaan air dalam proses dengan water recycling', method: 'Water usage logs, recycling system check, production data', scales: {5: 'Water recycling >70%, efisiensi berkurang >40%', 4: 'Water recycling 50-70%, efisiensi berkurang 25-40%', 3: 'Water recycling 25-50%, basic monitoring', 2: 'Water recycling <25%, minimal effort', 1: 'Tidak ada water recycling program'}},
                                {id: 'D1I4', name: 'Material Terbarukan/Daur Ulang', weight: 6, description: 'Persentase penggunaan material terbarukan atau recycled vs total material', method: 'Supplier certificates, material documentation, traceability', scales: {5: 'Penggunaan >60%, dengan sertifikasi, sustainable sourcing', 4: 'Penggunaan 45-60%, terdokumentasi baik', 3: 'Penggunaan 30-45%, basic sourcing', 2: 'Penggunaan 15-30%, mulai program', 1: 'Penggunaan <15% atau tidak ada'}}
                            ]
                        },
                        {
                            id: 'D2',
                            name: 'Pengelolaan & Minimalisasi Limbah',
                            weight: 20,
                            description: 'Kemampuan industri mengelola limbah dan meminimalkan waste generation',
                            indicators: [
                                {id: 'D2I1', name: 'Limbah Dihasilkan per Unit Produksi', weight: 5, description: 'Pengurangan limbah total per unit produksi', method: 'Waste logs, weighing records, trend analysis', scales: {5: 'Pengurangan >50%, comprehensive monitoring, data akurat', 4: 'Pengurangan 30-50%, monitoring teratur', 3: 'Pengurangan 15-30%, basic monitoring', 2: 'Pengurangan <15%, minimal monitoring', 1: 'Tidak ada pengurangan limbah'}},
                                {id: 'D2I2', name: 'Limbah Didaur Ulang/Dimanfaatkan', weight: 6, description: 'Persentase limbah yang direcycle atau dimanfaatkan ulang', method: 'Waste management plan, recycling contracts, records', scales: {5: 'Recovery rate >90%, partnership dengan recycling facilities', 4: 'Recovery rate 75-90%, established partnerships', 3: 'Recovery rate 50-75%, basic recycling program', 2: 'Recovery rate 25-50%, minimal effort', 1: 'Recovery rate <25% atau tidak ada'}},
                                {id: 'D2I3', name: 'Pengurangan Limbah B3', weight: 5, description: 'Pengurangan limbah berbahaya & beracun', method: 'B3 waste logs, PP 101/2014 compliance, substitution records', scales: {5: 'Pengurangan >60%, substitusi bahan kimia sukses', 4: 'Pengurangan 40-60%, program substitusi berjalan', 3: 'Pengurangan 20-40%, partial substitution', 2: 'Pengurangan <20%, minimal effort', 1: 'Tidak ada pengurangan B3'}},
                                {id: 'D2I4', name: 'Program Zero Waste', weight: 5, description: 'Implementasi program zero waste atau waste minimization', method: 'Zero waste program docs, target setting, progress tracking', scales: {5: 'Program maturity tinggi, target 95%+, monitoring ketat', 4: 'Program established dengan target 85-95%', 3: 'Program berjalan, target 70-85%', 2: 'Program awal, target <70%', 1: 'Tidak ada program zero waste'}}
                            ]
                        },
                        {
                            id: 'D3',
                            name: 'Desain Produk Berkelanjutan',
                            weight: 20,
                            description: 'Kemampuan industri mendesain produk dengan prinsip ekonomi sirkular',
                            indicators: [
                                {id: 'D3I1', name: 'Design for Durability', weight: 5, description: 'Desain produk untuk daya tahan lama mengurangi need for replacement', method: 'Product design review, durability testing, customer feedback', scales: {5: 'Durability testing berkala, produk tahan >10 tahun rata-rata', 4: 'Durability testing reguler, produk tahan 7-10 tahun', 3: 'Durability test ada, produk tahan 5-7 tahun', 2: 'Limited durability consideration, 3-5 tahun', 1: 'Tidak ada focus pada durability'}},
                                {id: 'D3I2', name: 'Design for Recycling', weight: 5, description: 'Desain produk untuk mudah di-daur-ulang di akhir umur', method: 'Design review, recycling compatibility assessment, feedback', scales: {5: '100% produk design-for-recycling, sertifikasi eco-design', 4: '80-100% produk design-for-recycling', 3: '60-80% produk design-for-recycling', 2: '40-60% produk design-for-recycling', 1: '<40% atau tidak ada design-for-recycling'}},
                                {id: 'D3I3', name: 'Minimalisasi Material Beracun', weight: 5, description: 'Pengurangan penggunaan material/bahan kimia beracun dalam produk', method: 'Material MSDS review, substitution documentation, compliance', scales: {5: '90%+ material non-toxic, substitusi sukses, compliant', 4: '80-90% material non-toxic, most substitutions done', 3: '60-80% material non-toxic, partial substitution', 2: '40-60% material non-toxic, minimal substitution', 1: '<40% non-toxic atau tidak ada substitution'}},
                                {id: 'D3I4', name: 'Material Ramah Lingkungan', weight: 5, description: 'Penggunaan material dengan eco-label atau sertifikasi lingkungan', method: 'Supplier certs, eco-label verification, sustainability reports', scales: {5: '60%+ material eco-certified, multiple certifications', 4: '45-60% material eco-certified', 3: '30-45% material eco-certified', 2: '15-30% material eco-certified', 1: '<15% atau tidak ada eco-certification'}}
                            ]
                        },
                        {
                            id: 'D4',
                            name: 'Pemanfaatan Kembali & Daur Ulang',
                            weight: 20,
                            description: 'Kemampuan industri memanfaatkan kembali produk lama & mendukung daur ulang',
                            indicators: [
                                {id: 'D4I1', name: 'Produk Dapat Didaur Ulang', weight: 6, description: 'Material produk dapat di-daur-ulang secara teknis & ekonomis', method: 'Material analysis, recycling feasibility study, market check', scales: {5: '>90% produk recyclable, established recycling value chain', 4: '80-90% produk recyclable, developing recycling market', 3: '60-80% produk recyclable, basic recycling available', 2: '40-60% produk recyclable, limited infrastructure', 1: '<40% recyclable atau tidak ada recycling option'}},
                                {id: 'D4I2', name: 'Recycled Content dalam Produk', weight: 6, description: 'Persentase content dari recycled material dalam produk akhir', method: 'Material documentation, supplier certs, production records', scales: {5: '>50% recycled content, certified, sustainable sourcing', 4: '35-50% recycled content, documented', 3: '20-35% recycled content, basic sourcing', 2: '10-20% recycled content, starting program', 1: '<10% recycled content atau tidak ada'}},
                                {id: 'D4I3', name: 'Program Take-back Produk', weight: 5, description: 'Program untuk mengambil kembali produk lama dari customer', method: 'Program documentation, customer uptake data, logistics', scales: {5: 'Take-back rate >60%, efficient logistics, reuse/remanufacture', 4: 'Take-back rate 40-60%, established system', 3: 'Take-back rate 20-40%, developing program', 2: 'Take-back rate 10-20%, pilot program', 1: '<10% take-back rate atau tidak ada program'}},
                                {id: 'D4I4', name: 'Partnership Daur Ulang', weight: 5, description: 'Kerjasama dengan fasilitas daur ulang tersertifikasi', method: 'Partnership contracts, facility certification, audit records', scales: {5: 'Partnerships dengan 5+ certified facilities, long-term contracts', 4: 'Partnerships dengan 3-4 certified facilities', 3: 'Partnerships dengan 1-2 certified facilities', 2: 'Ad-hoc arrangements, minimal partnership', 1: 'Tidak ada partnership atau no certified facilities'}}
                            ]
                        },
                        {
                            id: 'D5',
                            name: 'Keterlibatan Rantai Pasok',
                            weight: 10,
                            description: 'Kemampuan industri melibatkan supply chain dalam circular economy initiatives',
                            indicators: [
                                {id: 'D5I1', name: 'Kriteria Pemilihan Pemasok', weight: 4, description: 'Adanya kriteria sustainability dalam evaluasi & pemilihan supplier', method: 'Supplier policy review, evaluation forms, audit records', scales: {5: 'Comprehensive supplier sustainability criteria, scored evaluation', 4: 'Clear supplier CE criteria, formal evaluation process', 3: 'Basic supplier sustainability requirements', 2: 'Minimal supplier criteria, informal process', 1: 'Tidak ada sustainability criteria'}},
                                {id: 'D5I2', name: 'Kolaborasi Supplier untuk CE', weight: 4, description: 'Program training & support untuk supplier implement CE', method: 'Training programs, audit results, supplier feedback', scales: {5: 'Comprehensive program, 80%+ supplier participation', 4: 'Established program, 60-80% supplier participation', 3: 'Regular training, 40-60% participation', 2: 'Ad-hoc training, 20-40% participation', 1: '<20% participation atau tidak ada program'}},
                                {id: 'D5I3', name: 'Transparansi Jejak Material', weight: 4, description: 'Transparency sistem untuk jejak material dari sourcing hingga production', method: 'Traceability system demo, audit trails, documentation', scales: {5: 'Full traceability system, blockchain or equivalent, verified', 4: 'Comprehensive traceability, well-documented', 3: 'Partial traceability, basic system in place', 2: 'Limited traceability, manual tracking', 1: 'Minimal traceability atau tidak ada'}}
                            ]
                        },
                        {
                            id: 'D6',
                            name: 'Sistem Manajemen & Inovasi',
                            weight: 10,
                            description: 'Kemampuan industri mengelola & berinovasi dalam ekonomi sirkular',
                            indicators: [
                                {id: 'D6I1', name: 'Kebijakan Ekonomi Sirkular', weight: 5, description: 'Adanya formal policy commitment terhadap ekonomi sirkular', method: 'Policy document review, board approval, stakeholder feedback', scales: {5: 'Comprehensive CE policy, board-approved, integrated in strategy', 4: 'Clear CE policy, endorsed by management', 3: 'Basic CE policy, documented but implementation partial', 2: 'Informal CE commitment, no formal policy', 1: 'Tidak ada CE policy atau commitment'}},
                                {id: 'D6I2', name: 'Target & KPI Ekonomi Sirkular', weight: 5, description: 'Setting targets & KPIs untuk CE initiatives dengan monitoring', method: 'Strategic plan review, dashboard, progress reports', scales: {5: 'Comprehensive targets for all CE aspects, monthly monitoring', 4: 'Clear targets set, quarterly review', 3: 'Basic targets, annual review', 2: 'Ad-hoc targets, minimal monitoring', 1: 'Tidak ada targets atau KPI'}},
                                {id: 'D6I3', name: 'R&D & Inovasi Ekonomi Sirkular', weight: 5, description: 'Investment dalam R&D untuk CE innovations', method: 'R&D budget review, project documentation, outputs', scales: {5: '>3% revenue untuk CE R&D, multiple projects, commercialization', 4: '1-3% revenue untuk CE R&D, established projects', 3: '0.5-1% revenue untuk CE R&D, basic projects', 2: '<0.5% revenue untuk CE R&D, minimal effort', 1: 'Tidak ada dedicated CE R&D budget'}},
                                {id: 'D6I4', name: 'Komunikasi & Transparansi CE', weight: 4, description: 'Komunikasi CE initiatives ke stakeholder & transparency reporting', method: 'Sustainability report, website, stakeholder engagement', scales: {5: 'Annual sustainability report, GRI-compliant, stakeholder engagement', 4: 'Regular CE reporting, transparent communication', 3: 'Basic reporting, some transparency', 2: 'Limited communication, minimal transparency', 1: 'Tidak ada CE reporting atau transparency'}}
                            ]
                        }
                    ]
                };
            },

            setupCETabs() {
                const tabs = ['tab-ce-list', 'tab-ce-form', 'tab-ce-guide'];
                const contents = ['ce-list-content', 'ce-form-content', 'ce-guide-content'];
                const names = ['list', 'form', 'guide'];
                
                tabs.forEach((tabId, idx) => {
                    const btn = document.getElementById(tabId);
                    if (!btn) return;
                    btn.addEventListener('click', () => {
                        tabs.forEach(id => {
                            const b = document.getElementById(id);
                            if (b) {
                                b.classList.remove('btn--primary');
                                b.classList.add('btn--secondary');
                                b.style.borderBottom = 'none';
                            }
                        });
                        btn.classList.add('btn--primary');
                        btn.classList.remove('btn--secondary');
                        btn.style.borderBottom = '3px solid var(--color-primary)';
                        
                        contents.forEach((cId, ci) => {
                            const c = document.getElementById(cId);
                            if (c) c.classList.toggle('hidden', ci !== idx);
                        });
                        
                        this.currentCETab = names[idx];
                        this.renderCETab();
                    });
                });
                
                setTimeout(() => {
                    const first = document.getElementById(tabs[0]);
                    if (first) first.click();
                }, 100);
            },

            renderCETab() {
                if (this.currentCETab === 'list') this.renderCEList();
                else if (this.currentCETab === 'form') this.renderCEFormTab();
                else if (this.currentCETab === 'guide') this.renderCEGuide();
            },

            renderCEList() {
                const tbody = document.getElementById('ce-assessments-table');
                if (!tbody) return;
                
                if (this.ceAssessments.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align:center; padding:var(--space-32); color:var(--color-text-secondary); font-size:var(--font-size-lg);">üìã Belum ada penilaian ekonomi sirkular<br><br><span style="font-size:var(--font-size-sm);">Klik tombol "Buat Penilaian Baru" untuk memulai penilaian</span></td></tr>';
                    return;
                }
                
                const search = (document.getElementById('ce-search')||{}).value || '';
                const category = (document.getElementById('ce-filter-category')||{}).value || '';
                const sector = (document.getElementById('ce-filter-sector')||{}).value || '';
                
                let filtered = this.ceAssessments.filter(ce => {
                    const matchSearch = (ce.companyName||'').toLowerCase().includes(search.toLowerCase());
                    const matchCategory = !category || ce.category === category;
                    const matchSector = !sector || ce.sector === sector;
                    return matchSearch && matchCategory && matchSector;
                });
                
                tbody.innerHTML = filtered.map((ce, idx) => {
                    const catColor = ce.scoreTotal >= 4.1 ? '#208f81' : ce.scoreTotal >= 3.1 ? '#32b8c6' : ce.scoreTotal >= 2.1 ? '#e6a161' : ce.scoreTotal >= 1.1 ? '#ff5459' : '#c01b2f';
                    return `<tr>
                        <td>${idx + 1}</td>
                        <td><strong>${ce.companyName}</strong><br><span style="font-size:var(--font-size-xs); color:var(--color-text-secondary);">${ce.sector || 'N/A'}</span></td>
                        <td>${this.formatDate(ce.date)}</td>
                        <td><span class="score-badge" style="background: ${catColor}; color: white;">${ce.scoreTotal.toFixed(1)}</span></td>
                        <td><span class="status" style="background-color: ${catColor}20; color: ${catColor}; border-color: ${catColor};">${ce.category}</span></td>
                        <td>${ce.auditor}</td>
                        <td>
                            <div class="table-actions">
                                <button class="action-btn" onclick="app.viewCEDetail(${ce.id})">üëÅÔ∏è Detail</button>
                                <button class="action-btn" onclick="app.editCEAssessment(${ce.id})">‚úèÔ∏è Edit</button>
                                <button class="action-btn" onclick="app.deleteCEAssessment(${ce.id})">üóëÔ∏è Hapus</button>
                                <button class="action-btn" onclick="app.exportCEPDF(${ce.id})">üìÑ PDF</button>
                            </div>
                        </td>
                    </tr>`;
                }).join('');
            },

            setupInspectionTabs() {
                const tabBtns = ['tab-inspection-status', 'tab-inspection-workflow', 'tab-inspection-docs'];
                const tabContents = ['inspection-status-content', 'inspection-workflow-content', 'inspection-docs-content'];
                const tabNames = ['status', 'workflow', 'docs'];
                
                tabBtns.forEach((btnId, idx) => {
                    const btn = document.getElementById(btnId);
                    if (!btn) return;
                    btn.addEventListener('click', () => {
                        // Clear active
                        tabBtns.forEach(id => {
                            const b = document.getElementById(id);
                            if (b) b.classList.remove('btn--primary'); b.classList.add('btn--secondary');
                        });
                        btn.classList.add('btn--primary');
                        btn.classList.remove('btn--secondary');
                        // Show content
                        tabContents.forEach((cId, ci) => {
                            const c = document.getElementById(cId);
                            if (c) c.classList.toggle('hidden', ci !== idx);
                        });
                        this.currentInspectionTab = tabNames[idx];
                        this.renderInspectionTab();
                    });
                });
                // Auto-click first tab
                setTimeout(() => {
                    const first = document.getElementById(tabBtns[0]);
                    if (first) first.click();
                }, 100);
            },

            renderInspectionTab() {
                if (this.currentInspectionTab === 'status') this.renderInspectionStatus();
                else if (this.currentInspectionTab === 'workflow') this.renderInspectionWorkflow();
                else if (this.currentInspectionTab === 'docs') this.renderInspectionDocs();
            },

            renderInspectionStatus() {
                const container = document.getElementById('inspection-status-content');
                if (!container) return;
                container.innerHTML = `
                    <div class="toolbar">
                        <div class="search-box">
                            <select class="form-control" id="filter-insp-status">
                                <option value="">Semua Status</option>
                                ${MASTER_INSPECTION_STATUS.map(s => `<option value="${s}">${s}</option>`).join('')}
                            </select>
                            <select class="form-control" id="filter-insp-type">
                                <option value="">Semua Jenis</option>
                                ${MASTER_INSPECTION_TYPE.map(t => `<option value="${t}">${t}</option>`).join('')}
                            </select>
                        </div>
                        <button class="btn btn--primary" onclick="app.showCreateInspectionModal()">+ Buat Pengawasan Baru</button>
                    </div>
                    <div class="card mt-24">
                        <div class="card__body">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>No</th><th>Nama Perusahaan</th><th>Tanggal Pengawasan</th><th>Jenis Pengawasan</th><th>Status Pengawasan</th><th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="inspections-table-body"></tbody>
                            </table>
                        </div>
                    </div>
                `;
                this.renderInspectionsTable();
                // Add event listeners
                setTimeout(() => {
                    const filterStatus = document.getElementById('filter-insp-status');
                    const filterType = document.getElementById('filter-insp-type');
                    if (filterStatus) filterStatus.addEventListener('change', () => this.renderInspectionsTable());
                    if (filterType) filterType.addEventListener('change', () => this.renderInspectionsTable());
                }, 100);
            },

            setupCEListFilters() {
                const ceSearch = document.getElementById('ce-search');
                const ceFilterCat = document.getElementById('ce-filter-category');
                const ceFilterSector = document.getElementById('ce-filter-sector');
                if (ceSearch) ceSearch.addEventListener('input', () => this.renderCEList());
                if (ceFilterCat) ceFilterCat.addEventListener('change', () => this.renderCEList());
                if (ceFilterSector) ceFilterSector.addEventListener('change', () => this.renderCEList());
            },

            renderInspectionsTable() {
                const tbody = document.getElementById('inspections-table-body');
                if (!tbody) return;
                if (this.inspections.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align:center; padding:var(--space-32); color:var(--color-text-secondary);">Belum ada data pengawasan. Klik tombol "Buat Pengawasan Baru" untuk memulai.</td></tr>';
                    return;
                }
                const statusFilter = (document.getElementById('filter-insp-status')||{}).value || '';
                const typeFilter = (document.getElementById('filter-insp-type')||{}).value || '';
                let filtered = this.inspections.filter(insp => {
                    const matchStatus = !statusFilter || insp.status === statusFilter;
                    const matchType = !typeFilter || insp.jenis === typeFilter;
                    return matchStatus && matchType;
                });
                tbody.innerHTML = filtered.map((insp, idx) => {
                    const statusColor = insp.status === 'Selesai' ? 'status--success' : insp.status === 'On Progress' ? 'status--warning' : insp.status === 'Perlu Tindak Lanjut' ? 'status--error' : 'status--info';
                    return `<tr>
                        <td>${idx + 1}</td>
                        <td>${insp.companyName}</td>
                        <td>${this.formatDate(insp.date)}</td>
                        <td>${insp.jenis}</td>
                        <td><span class="status ${statusColor}">${insp.status}</span></td>
                        <td>
                            <div class="table-actions">
                                <button class="action-btn" onclick="app.viewInspectionDetail(${insp.id})">üëÅÔ∏è Lihat Detail</button>
                                <button class="action-btn" onclick="app.editInspection(${insp.id})">‚úèÔ∏è Edit</button>
                                <button class="action-btn" onclick="app.deleteInspection(${insp.id})">üóëÔ∏è Delete</button>
                            </div>
                        </td>
                    </tr>`;
                }).join('');
            },

            renderInspectionWorkflow() {
                const container = document.getElementById('inspection-workflow-content');
                if (!container) return;
                const workflowStages = [
                    {stage:1, name:'PERSIAPAN', desc:'Identifikasi objek, review data, penyusunan rencana', dur:'3-5 hari', items:['Identifikasi objek pengawasan','Review data histori & regulasi','Penyusunan rencana pengawasan','Persiapan dokumen & checklist','Briefing tim pengawas']},
                    {stage:2, name:'PELAKSANAAN', desc:'Pengawasan dokumen, lapangan, sampling, pembinaan', dur:'1-2 hari', items:['Pengawasan dokumen (desk review)','Pengawasan lapangan','Observasi visual & wawancara','Sampling/testing (jika perlu)','Pembinaan & penyuluhan']},
                    {stage:3, name:'VERIFIKASI & ANALISIS', desc:'Verifikasi data, analisis kepatuhan, evaluasi temuan', dur:'3-5 hari', items:['Verifikasi data & bukti','Analisis kepatuhan dengan scoring','Evaluasi temuan & root cause','Decision point kepatuhan']},
                    {stage:4, name:'PELAPORAN', desc:'Penyusunan BA, review, pengesahan laporan', dur:'1-2 minggu', items:['Penyusunan Berita Acara (BA)','Review & validasi internal','Pengesahan laporan','Upload dokumen BA']},
                    {stage:5, name:'FOLLOW-UP & MONITORING', desc:'Penyampaian laporan, monitoring tindak lanjut, verifikasi, closure', dur:'6 bulan', items:['Penyampaian laporan ke industri','Monitoring tindak lanjut (30/60/90 hari)','Verifikasi perbaikan','Closure & dokumentasi']}
                ];
                container.innerHTML = `
                    <div class="card mb-16"><div class="card__body">
                        <h3 class="mb-16">Visualisasi 5 Tahap Workflow Pengawasan Industri</h3>
                        <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(180px, 1fr)); gap:var(--space-16);">
                            ${workflowStages.map((stage, idx) => `
                                <div class="stat-card" style="background:var(--color-bg-${idx+1}); cursor:pointer;" onclick="app.toggleWorkflowStage(${stage.stage})">
                                    <div style="font-size:var(--font-size-2xl); font-weight:bold; color:var(--color-primary);">${stage.stage}Ô∏è‚É£</div>
                                    <h4 style="margin:var(--space-8) 0; font-size:var(--font-size-base);">${stage.name}</h4>
                                    <p style="font-size:var(--font-size-xs); color:var(--color-text-secondary); margin:0;">${stage.desc}</p>
                                    <div style="margin-top:var(--space-8); font-size:var(--font-size-xs); color:var(--color-primary);">‚è±Ô∏è ${stage.dur}</div>
                                </div>
                            `).join('')}
                        </div>
                        <div id="workflow-stage-detail" class="mt-24"></div>
                    </div></div>
                `;
            },

            toggleWorkflowStage(stageNum) {
                const container = document.getElementById('workflow-stage-detail');
                if (!container) return;
                const workflowStages = [
                    {stage:1, name:'PERSIAPAN', desc:'Identifikasi objek, review data, penyusunan rencana', dur:'3-5 hari', items:['Identifikasi objek pengawasan','Review data histori & regulasi','Penyusunan rencana pengawasan','Persiapan dokumen & checklist','Briefing tim pengawas']},
                    {stage:2, name:'PELAKSANAAN', desc:'Pengawasan dokumen, lapangan, sampling, pembinaan', dur:'1-2 hari', items:['Pengawasan dokumen (desk review)','Pengawasan lapangan','Observasi visual & wawancara','Sampling/testing (jika perlu)','Pembinaan & penyuluhan']},
                    {stage:3, name:'VERIFIKASI & ANALISIS', desc:'Verifikasi data, analisis kepatuhan, evaluasi temuan', dur:'3-5 hari', items:['Verifikasi data & bukti','Analisis kepatuhan dengan scoring','Evaluasi temuan & root cause','Decision point kepatuhan']},
                    {stage:4, name:'PELAPORAN', desc:'Penyusunan BA, review, pengesahan laporan', dur:'1-2 minggu', items:['Penyusunan Berita Acara (BA)','Review & validasi internal','Pengesahan laporan','Upload dokumen BA']},
                    {stage:5, name:'FOLLOW-UP & MONITORING', desc:'Penyampaian laporan, monitoring tindak lanjut, verifikasi, closure', dur:'6 bulan', items:['Penyampaian laporan ke industri','Monitoring tindak lanjut (30/60/90 hari)','Verifikasi perbaikan','Closure & dokumentasi']}
                ];
                const stage = workflowStages[stageNum - 1];
                if (!stage) return;
                container.innerHTML = `
                    <div class="card" style="border-left:4px solid var(--color-primary);">
                        <div class="card__body">
                            <h4 style="color:var(--color-primary); margin-bottom:var(--space-8);">Tahap ${stage.stage}: ${stage.name}</h4>
                            <p style="color:var(--color-text-secondary); font-size:var(--font-size-sm); margin-bottom:var(--space-16);">${stage.desc}</p>
                            <div style="margin-bottom:var(--space-16);"><strong>Durasi Estimasi:</strong> ${stage.dur}</div>
                            <h5 style="margin-bottom:var(--space-8);">Checklist Aktivitas:</h5>
                            <ul style="padding-left:var(--space-24);">
                                ${stage.items.map(item => `<li style="margin-bottom:var(--space-4);"><input type="checkbox" style="margin-right:var(--space-8);"> ${item}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                `;
            },

            renderInspectionDocs() {
                const container = document.getElementById('inspection-docs-content');
                if (!container) return;
                container.innerHTML = `
                    <div class="toolbar">
                        <div class="search-box">
                            <select class="form-control" id="filter-doc-type">
                                <option value="">Semua Jenis Dokumen</option>
                                ${MASTER_DOC_TYPE.map(t => `<option value="${t}">${t}</option>`).join('')}
                            </select>
                        </div>
                        <button class="btn btn--primary" onclick="app.showUploadDocumentModal()">üì§ Tambah Dokumen</button>
                    </div>
                    <div class="card mt-24">
                        <div class="card__body">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>No</th><th>Nama Perusahaan</th><th>Tanggal Dokumen</th><th>Jenis Dokumen</th><th>File</th><th>Status</th><th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="documents-table-body"></tbody>
                            </table>
                        </div>
                    </div>
                `;
                this.renderDocumentsTable();
                setTimeout(() => {
                    const filterDoc = document.getElementById('filter-doc-type');
                    if (filterDoc) filterDoc.addEventListener('change', () => this.renderDocumentsTable());
                }, 100);
            },

            renderDocumentsTable() {
                const tbody = document.getElementById('documents-table-body');
                if (!tbody) return;
                if (this.documents.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align:center; padding:var(--space-32); color:var(--color-text-secondary);">Belum ada dokumen pengawasan. Klik tombol "Tambah Dokumen" untuk upload.</td></tr>';
                    return;
                }
                const docFilter = (document.getElementById('filter-doc-type')||{}).value || '';
                let filtered = this.documents.filter(doc => !docFilter || doc.jenis === docFilter);
                tbody.innerHTML = filtered.map((doc, idx) => `<tr>
                    <td>${idx + 1}</td>
                    <td>${doc.companyName}</td>
                    <td>${this.formatDate(doc.date)}</td>
                    <td>${doc.jenis}</td>
                    <td>${doc.fileName}</td>
                    <td><span class="status status--success">‚úÖ Uploaded</span></td>
                    <td>
                        <div class="table-actions">
                            <button class="action-btn" onclick="app.previewDocument(${doc.id})">üëÅÔ∏è Preview</button>
                            <button class="action-btn" onclick="app.downloadDocument(${doc.id})">‚¨áÔ∏è Download</button>
                            <button class="action-btn" onclick="app.deleteDocument(${doc.id})">üóëÔ∏è Delete</button>
                        </div>
                    </td>
                </tr>`).join('');
            },

            showCreateInspectionModal() {
                const companies = this.industries.map(ind => `<option value="${ind.id}">${ind.name}</option>`).join('');
                if (!companies) {
                    alert('‚ö†Ô∏è Belum ada perusahaan. Silakan tambah perusahaan terlebih dahulu di menu Daftar Perusahaan.');
                    return;
                }
                const html = `
                    <div style="padding:var(--space-16);">
                        <h3 style="margin-bottom:var(--space-16);">SiPESSI - Buat Pengawasan Baru</h3>
                        <div class="form-group">
                            <label class="form-label">Pilih Perusahaan</label>
                            <select class="form-control" id="new-insp-company"><option value="">-- Pilih --</option>${companies}</select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Tanggal Pengawasan</label>
                            <input type="date" class="form-control" id="new-insp-date" value="${new Date().toISOString().split('T')[0]}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Jenis Pengawasan</label>
                            <select class="form-control" id="new-insp-type">
                                ${MASTER_INSPECTION_TYPE.map(t => `<option value="${t}">${t}</option>`).join('')}
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Status Awal</label>
                            <select class="form-control" id="new-insp-status">
                                ${MASTER_INSPECTION_STATUS.map(s => `<option value="${s}">${s}</option>`).join('')}
                            </select>
                        </div>
                        <button class="btn btn--primary" onclick="app.createInspection()">üíæ Simpan</button>
                        <button class="btn btn--secondary" onclick="this.closest('.modal').remove()">Batal</button>
                    </div>
                `;
                const modal = document.createElement('div');
                modal.className = 'modal active';
                modal.innerHTML = `<div class="modal-content">${html}</div>`;
                document.body.appendChild(modal);
            },

            createInspection() {
                const companyId = (document.getElementById('new-insp-company')||{}).value;
                const date = (document.getElementById('new-insp-date')||{}).value;
                const jenis = (document.getElementById('new-insp-type')||{}).value;
                const status = (document.getElementById('new-insp-status')||{}).value;
                if (!companyId || !date) { alert('‚ö†Ô∏è Lengkapi semua field!'); return; }
                const company = this.industries.find(ind => ind.id == companyId);
                if (!company) return;
                const insp = {
                    id: this.inspections.length + 1,
                    companyId: parseInt(companyId),
                    companyName: company.name,
                    date: date,
                    jenis: jenis,
                    status: status,
                    createdAt: new Date().toISOString()
                };
                this.inspections.push(insp);
                document.querySelector('.modal.active')?.remove();
                this.renderInspectionsTable();
                alert('‚úÖ Pengawasan berhasil dibuat!');
            },

            viewInspectionDetail(id) {
                const insp = this.inspections.find(i => i.id === id);
                if (!insp) return;
                alert(`üìã Detail Pengawasan #${insp.id}\n\nPerusahaan: ${insp.companyName}\nTanggal: ${this.formatDate(insp.date)}\nJenis: ${insp.jenis}\nStatus: ${insp.status}`);
            },

            editInspection(id) {
                const insp = this.inspections.find(i => i.id === id);
                if (!insp) return;
                const newStatus = prompt(`Update Status Pengawasan:\n1. Belum Dimulai\n2. On Progress\n3. Selesai\n4. Perlu Tindak Lanjut\n\nStatus sekarang: ${insp.status}\nMasukkan nomor pilihan:`);
                const num = parseInt(newStatus);
                if (num >= 1 && num <= 4) {
                    insp.status = MASTER_INSPECTION_STATUS[num - 1];
                    this.renderInspectionsTable();
                    alert('‚úÖ Status berhasil diupdate!');
                }
            },

            deleteInspection(id) {
                if (confirm('Yakin ingin menghapus pengawasan ini?')) {
                    this.inspections = this.inspections.filter(i => i.id !== id);
                    this.renderInspectionsTable();
                    alert('‚úÖ Pengawasan berhasil dihapus!');
                }
            },

            showUploadDocumentModal() {
                const companies = this.industries.map(ind => `<option value="${ind.id}">${ind.name}</option>`).join('');
                if (!companies) {
                    alert('‚ö†Ô∏è Belum ada perusahaan.');
                    return;
                }
                const html = `
                    <div style="padding:var(--space-16);">
                        <h3 style="margin-bottom:var(--space-16);">SiPESSI - Upload Dokumen Pengawasan</h3>
                        <div class="form-group">
                            <label class="form-label">Pilih Perusahaan</label>
                            <select class="form-control" id="new-doc-company"><option value="">-- Pilih --</option>${companies}</select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Tanggal Dokumen</label>
                            <input type="date" class="form-control" id="new-doc-date" value="${new Date().toISOString().split('T')[0]}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Jenis Dokumen</label>
                            <select class="form-control" id="new-doc-type">
                                ${MASTER_DOC_TYPE.map(t => `<option value="${t}">${t}</option>`).join('')}
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">File (Mock - Nama File)</label>
                            <input type="text" class="form-control" id="new-doc-filename" placeholder="Contoh: BA_Audit_PT_XYZ.pdf">
                        </div>
                        <button class="btn btn--primary" onclick="app.uploadDocument()">üì§ Upload</button>
                        <button class="btn btn--secondary" onclick="this.closest('.modal').remove()">Batal</button>
                    </div>
                `;
                const modal = document.createElement('div');
                modal.className = 'modal active';
                modal.innerHTML = `<div class="modal-content">${html}</div>`;
                document.body.appendChild(modal);
            },

            uploadDocument() {
                const companyId = (document.getElementById('new-doc-company')||{}).value;
                const date = (document.getElementById('new-doc-date')||{}).value;
                const jenis = (document.getElementById('new-doc-type')||{}).value;
                const fileName = (document.getElementById('new-doc-filename')||{}).value;
                if (!companyId || !date || !fileName) { alert('‚ö†Ô∏è Lengkapi semua field!'); return; }
                const company = this.industries.find(ind => ind.id == companyId);
                if (!company) return;
                const doc = {
                    id: this.documents.length + 1,
                    companyId: parseInt(companyId),
                    companyName: company.name,
                    date: date,
                    jenis: jenis,
                    fileName: fileName,
                    uploadedAt: new Date().toISOString()
                };
                this.documents.push(doc);
                document.querySelector('.modal.active')?.remove();
                this.renderDocumentsTable();
                alert('‚úÖ Dokumen berhasil diupload!');
            },

            previewDocument(id) {
                const doc = this.documents.find(d => d.id === id);
                if (!doc) return;
                alert(`üëÅÔ∏è Preview Dokumen (Mock)\n\nFile: ${doc.fileName}\nJenis: ${doc.jenis}\nPerusahaan: ${doc.companyName}\nTanggal: ${this.formatDate(doc.date)}\n\n[Dalam aplikasi nyata, ini akan membuka preview PDF/Image]`);
            },

            downloadDocument(id) {
                const doc = this.documents.find(d => d.id === id);
                if (!doc) return;
                alert(`‚¨áÔ∏è Download dimulai (Mock)\n\nFile: ${doc.fileName}\n\n[Dalam aplikasi nyata, file akan didownload]`);
            },

            deleteDocument(id) {
                if (confirm('Yakin ingin menghapus dokumen ini?')) {
                    this.documents = this.documents.filter(d => d.id !== id);
                    this.renderDocumentsTable();
                    alert('‚úÖ Dokumen berhasil dihapus!');
                }
            },

            setupNavigation() {
                // SPECIAL NAV: Matrix page aspect count
                // Wait DOM, then update stat cards count (12/8/...)
                setTimeout(() => {
                    const teknis = document.getElementById('stat-teknis-count');
                    const ekonomi = document.getElementById('stat-ekonomi-count');
                    const sosial = document.getElementById('stat-sosial-count');
                    const lingkungan = document.getElementById('stat-lingkungan-count');
                    const sirkular = document.getElementById('stat-sirkular-count');
                    const perizinan = document.getElementById('stat-perizinan-count');
                    
                    if (teknis) teknis.textContent = aspekData[0].indicators.length;
                    if (ekonomi) ekonomi.textContent = aspekData[1].indicators.length;
                    if (sosial) sosial.textContent = aspekData[2].indicators.length;
                    if (lingkungan) lingkungan.textContent = aspekData[3].indicators.length;
                    if (sirkular) sirkular.textContent = aspekData[4].indicators.length;
                    if (perizinan) perizinan.textContent = aspekData[5].indicators.length;
                }, 200);

                const navLinks = document.querySelectorAll('.nav-link');
                navLinks.forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const page = link.getAttribute('data-page');
                        this.navigateTo(page);
                    });
                });
            },

            navigateTo(page) {
                // Hide all pages
                document.querySelectorAll('.page-content').forEach(p => p.classList.add('hidden'));
                
                // Show selected page
                const pageElement = document.getElementById(`page-${page}`);
                if (pageElement) {
                    pageElement.classList.remove('hidden');
                } else {
                    console.error('Page not found:', page);
                    return;
                }
                
                // Update active nav
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                const navLink = document.querySelector(`[data-page="${page}"]`);
                if (navLink) navLink.classList.add('active');

                // Render page specific content
                try {
                    if (page === 'dashboard') this.renderDashboard();
                    else if (page === 'workflow') { /* already static image */ }
                    else if (page === 'matrix') this.renderMatrix();
                    else if (page === 'industries') this.renderIndustriesTable();
else if (page === 'inspection') {
    this.setupInspectionTabs();
}
else if (page === 'assessment') this.populateAssessmentSelect();
else if (page === 'results') this.renderAuditsTable();
                    else if (page === 'recommendations') this.renderRecommendations();
                    else if (page === 'template') this.renderTemplate();
                    else if (page === 'reports') this.renderReports();
                    else if (page === 'circular-economy') this.setupCETabs();
                } catch (error) {
                    console.error('Error rendering page:', error);
                    alert('Terjadi kesalahan saat memuat halaman. Silakan refresh browser.');
                }
            },

            // Event Listeners
            setupEventListeners() {
                // Inspection tab navigation
                this.setupInspectionTabs();
                // CE list filters
                setTimeout(() => this.setupCEListFilters(), 500);
                // Matrix search/filter
                const matrixSearchInput = document.getElementById('matrix-search');
                if (matrixSearchInput) matrixSearchInput.addEventListener('input', () => this.renderMatrix());
                const matrixAspectSelect = document.getElementById('matrix-filter-aspect');
                if (matrixAspectSelect) matrixAspectSelect.addEventListener('change', () => this.renderMatrix());

                // CE Search and filter
                const ceSearch = document.getElementById('ce-search');
                const ceFilterCat = document.getElementById('ce-filter-category');
                const ceFilterDate = document.getElementById('ce-filter-date');
                if (ceSearch) ceSearch.addEventListener('input', () => this.renderCEList());
                if (ceFilterCat) ceFilterCat.addEventListener('change', () => this.renderCEList());
                if (ceFilterDate) ceFilterDate.addEventListener('change', () => this.renderCEList());

                // Search and filter - industries
                const searchIndustry = document.getElementById('search-industry');
                const filterSector = document.getElementById('filter-sector');
                if (searchIndustry) searchIndustry.addEventListener('input', () => this.renderIndustriesTable());
                if (filterSector) filterSector.addEventListener('change', () => this.renderIndustriesTable());

                // Search and filter - audits
                const searchAudit = document.getElementById('search-audit');
                const filterAuditSector = document.getElementById('filter-audit-sector');
                const filterAuditCategory = document.getElementById('filter-audit-category');
                if (searchAudit) searchAudit.addEventListener('input', () => this.renderAuditsTable());
                if (filterAuditSector) filterAuditSector.addEventListener('change', () => this.renderAuditsTable());
                if (filterAuditCategory) filterAuditCategory.addEventListener('change', () => this.renderAuditsTable());

                // Filter - recommendations
                const filterRecStatus = document.getElementById('filter-recommendation-status');
                const filterRecPriority = document.getElementById('filter-recommendation-priority');
                if (filterRecStatus) filterRecStatus.addEventListener('change', () => this.renderRecommendations());
                if (filterRecPriority) filterRecPriority.addEventListener('change', () => this.renderRecommendations());

                // Add industry form
                const addIndustryForm = document.getElementById('add-industry-form');
                if (addIndustryForm) {
                    addIndustryForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.addIndustry();
                    });
                }

                // Assessment selection
                const assessmentIndustry = document.getElementById('assessment-industry');
                const assessmentAspect = document.getElementById('assessment-aspect');
                if (assessmentIndustry) {
                    assessmentIndustry.addEventListener('change', (e) => {
                        if (e.target.value) {
                            this.startAssessment(parseInt(e.target.value));
                        } else {
                            const formContainer = document.getElementById('assessment-form-container');
                            if (formContainer) formContainer.classList.add('hidden');
                        }
                    });
                }
                if (assessmentAspect) {
                    assessmentAspect.addEventListener('change', () => {
                        const industrySelect = document.getElementById('assessment-industry');
                        if (industrySelect && industrySelect.value) {
                            this.renderAssessmentForm();
                        }
                    });
                }

                // Assessment form
                const assessmentForm = document.getElementById('assessment-form');
                if (assessmentForm) {
                    assessmentForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.saveAssessment();
                    });
                }
            },

            // Dashboard Rendering
            renderDashboard() {
                this.renderDashboardStats();
                this.renderRadarChart();
                this.renderSectorBarChart();
                this.renderSectorTabs();
                this.renderTrendLineChart();
                this.renderHeatmap();
                this.renderInsights();
            },

            refreshDashboard() {
                this.renderDashboard();
                alert('‚úÖ Dashboard berhasil direfresh!');
            },

            renderDashboardStats() {
                // Load sector data from application_data_json
                const sectorData = [
                    {name: 'Tekstil', companies: 5, avgScore: 3.4},
                    {name: 'Plastik', companies: 4, avgScore: 3.1},
                    {name: 'Kertas', companies: 3, avgScore: 3.5},
                    {name: 'Elektronik', companies: 6, avgScore: 3.2},
                    {name: 'Kimia', companies: 4, avgScore: 2.9},
                    {name: 'Minuman', companies: 3, avgScore: 3.6},
                    {name: 'Logam', companies: 5, avgScore: 3.0},
                    {name: 'Otomotif', companies: 4, avgScore: 3.3}
                ];

                const dimensionScores = [
                    {id: 'D1', name: 'Efisiensi Sumber Daya', score: 3.8},
                    {id: 'D2', name: 'Minimalisasi Limbah', score: 3.6},
                    {id: 'D3', name: 'Desain Berkelanjutan', score: 3.3},
                    {id: 'D4', name: 'Daur Ulang', score: 3.1},
                    {id: 'D5', name: 'Rantai Pasok', score: 2.9},
                    {id: 'D6', name: 'Manajemen & Inovasi', score: 2.8}
                ];

                const totalAssessments = 34;
                const avgScore = 3.3;
                const bestDim = dimensionScores[0];
                const weakDim = dimensionScores[5];
                const bestSector = sectorData.reduce((a,b) => a.avgScore > b.avgScore ? a : b);

                document.getElementById('dash-total-assessments').textContent = totalAssessments;
                document.getElementById('dash-avg-score').textContent = avgScore.toFixed(1);
                document.getElementById('dash-best-dim').textContent = bestDim.id;
                document.getElementById('dash-best-score').textContent = 'Skor: ' + bestDim.score.toFixed(1);
                document.getElementById('dash-weak-dim').textContent = weakDim.id;
                document.getElementById('dash-weak-score').textContent = 'Skor: ' + weakDim.score.toFixed(1);
                document.getElementById('dash-best-sector').textContent = bestSector.name;
                document.getElementById('dash-best-sector-score').textContent = bestSector.avgScore.toFixed(1);

                // Best company from CE assessments
                if (this.ceAssessments.length > 0) {
                    const bestCompany = this.ceAssessments.reduce((a,b) => a.scoreTotal > b.scoreTotal ? a : b);
                    document.getElementById('dash-best-company').textContent = bestCompany.companyName.substring(0,15) + (bestCompany.companyName.length > 15 ? '...' : '');
                    document.getElementById('dash-best-company-score').textContent = bestCompany.scoreTotal.toFixed(1);
                } else {
                    document.getElementById('dash-best-company').textContent = '-';
                    document.getElementById('dash-best-company-score').textContent = 'Belum ada data';
                }

                // Populate sector filter
                const sectorFilter = document.getElementById('dashboard-filter-sector');
                if (sectorFilter && sectorFilter.options.length <= 1) {
                    sectorData.forEach(s => {
                        const opt = document.createElement('option');
                        opt.value = s.name;
                        opt.textContent = s.name;
                        sectorFilter.appendChild(opt);
                    });
                }
            },

            renderRadarChart() {
                const canvas = document.getElementById('radarChart');
                if (!canvas) return;

                const dimensionScores = [3.8, 3.6, 3.3, 3.1, 2.9, 2.8];
                const dimensionLabels = ['D1: Efisiensi Sumber Daya', 'D2: Minimalisasi Limbah', 'D3: Desain Berkelanjutan', 'D4: Daur Ulang', 'D5: Rantai Pasok', 'D6: Manajemen & Inovasi'];
                const dimensionColors = ['#2563eb', '#16a34a', '#d97706', '#dc2626', '#7c3aed', '#0891b2'];

                if (this.charts.radar) this.charts.radar.destroy();

                this.charts.radar = new Chart(canvas, {
                    type: 'radar',
                    data: {
                        labels: dimensionLabels,
                        datasets: [{
                            label: 'Skor Rata-rata',
                            data: dimensionScores,
                            backgroundColor: 'rgba(37, 99, 235, 0.2)',
                            borderColor: '#2563eb',
                            borderWidth: 2,
                            pointBackgroundColor: dimensionColors,
                            pointBorderColor: '#fff',
                            pointRadius: 6,
                            pointHoverRadius: 8
                        }, {
                            label: 'Target Excellence (4.0)',
                            data: [4.0, 4.0, 4.0, 4.0, 4.0, 4.0],
                            backgroundColor: 'rgba(132, 204, 22, 0.05)',
                            borderColor: '#84cc16',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            pointRadius: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        scales: {
                            r: {
                                beginAtZero: true,
                                max: 5,
                                ticks: { stepSize: 1 }
                            }
                        },
                        plugins: {
                            legend: { position: 'bottom' }
                        }
                    }
                });
            },

            renderSectorBarChart() {
                const canvas = document.getElementById('sectorBarChart');
                if (!canvas) return;

                const sectors = ['Tekstil', 'Plastik', 'Kertas', 'Elektronik', 'Kimia', 'Minuman', 'Logam', 'Otomotif'];
                const d1 = [4.1, 3.8, 3.9, 3.6, 3.4, 3.7, 3.5, 3.8];
                const d2 = [3.8, 3.5, 4.0, 3.4, 3.2, 3.8, 3.3, 3.6];
                const d3 = [3.5, 3.2, 3.6, 3.3, 3.0, 3.5, 3.1, 3.4];
                const d4 = [3.2, 3.0, 3.3, 3.1, 2.8, 3.4, 2.9, 3.2];
                const d5 = [3.0, 2.8, 3.1, 2.9, 2.6, 3.2, 2.7, 3.0];
                const d6 = [2.8, 2.5, 3.2, 2.8, 2.5, 3.0, 2.6, 2.9];

                if (this.charts.sectorBar) this.charts.sectorBar.destroy();

                this.charts.sectorBar = new Chart(canvas, {
                    type: 'bar',
                    data: {
                        labels: sectors,
                        datasets: [
                            {label: 'D1: Efisiensi', data: d1, backgroundColor: '#2563eb'},
                            {label: 'D2: Limbah', data: d2, backgroundColor: '#16a34a'},
                            {label: 'D3: Desain', data: d3, backgroundColor: '#d97706'},
                            {label: 'D4: Daur Ulang', data: d4, backgroundColor: '#dc2626'},
                            {label: 'D5: Rantai Pasok', data: d5, backgroundColor: '#7c3aed'},
                            {label: 'D6: Manajemen', data: d6, backgroundColor: '#0891b2'}
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        scales: {
                            x: { stacked: true },
                            y: { stacked: true, beginAtZero: true, max: 25 }
                        },
                        plugins: {
                            legend: { position: 'bottom' }
                        }
                    }
                });
            },

            renderSectorTabs() {
                const tabsContainer = document.getElementById('sector-tabs');
                const detailContainer = document.getElementById('sector-detail-container');
                if (!tabsContainer || !detailContainer) return;

                const sectors = ['Tekstil', 'Plastik', 'Kertas', 'Elektronik', 'Kimia', 'Minuman', 'Logam', 'Otomotif'];
                const sectorData = [
                    {name: 'Tekstil', companies: 5, avgScore: 3.4, d1: 4.1, d2: 3.8, d3: 3.5, d4: 3.2, d5: 3.0, d6: 2.8},
                    {name: 'Plastik', companies: 4, avgScore: 3.1, d1: 3.8, d2: 3.5, d3: 3.2, d4: 3.0, d5: 2.8, d6: 2.5},
                    {name: 'Kertas', companies: 3, avgScore: 3.5, d1: 3.9, d2: 4.0, d3: 3.6, d4: 3.3, d5: 3.1, d6: 3.2},
                    {name: 'Elektronik', companies: 6, avgScore: 3.2, d1: 3.6, d2: 3.4, d3: 3.3, d4: 3.1, d5: 2.9, d6: 2.8},
                    {name: 'Kimia', companies: 4, avgScore: 2.9, d1: 3.4, d2: 3.2, d3: 3.0, d4: 2.8, d5: 2.6, d6: 2.5},
                    {name: 'Minuman', companies: 3, avgScore: 3.6, d1: 3.7, d2: 3.8, d3: 3.5, d4: 3.4, d5: 3.2, d6: 3.0},
                    {name: 'Logam', companies: 5, avgScore: 3.0, d1: 3.5, d2: 3.3, d3: 3.1, d4: 2.9, d5: 2.7, d6: 2.6},
                    {name: 'Otomotif', companies: 4, avgScore: 3.3, d1: 3.8, d2: 3.6, d3: 3.4, d4: 3.2, d5: 3.0, d6: 2.9}
                ];

                tabsContainer.innerHTML = sectors.map((s, i) => `<button class="btn btn--sm ${i === 0 ? 'btn--primary' : 'btn--secondary'}" onclick="app.showSectorDetail('${s}')">${s}</button>`).join('');

                window.currentSector = sectorData[0];
                this.renderSectorDetail(sectorData[0]);
            },

            showSectorDetail(sectorName) {
                const sectorData = [
                    {name: 'Tekstil', companies: 5, avgScore: 3.4, d1: 4.1, d2: 3.8, d3: 3.5, d4: 3.2, d5: 3.0, d6: 2.8},
                    {name: 'Plastik', companies: 4, avgScore: 3.1, d1: 3.8, d2: 3.5, d3: 3.2, d4: 3.0, d5: 2.8, d6: 2.5},
                    {name: 'Kertas', companies: 3, avgScore: 3.5, d1: 3.9, d2: 4.0, d3: 3.6, d4: 3.3, d5: 3.1, d6: 3.2},
                    {name: 'Elektronik', companies: 6, avgScore: 3.2, d1: 3.6, d2: 3.4, d3: 3.3, d4: 3.1, d5: 2.9, d6: 2.8},
                    {name: 'Kimia', companies: 4, avgScore: 2.9, d1: 3.4, d2: 3.2, d3: 3.0, d4: 2.8, d5: 2.6, d6: 2.5},
                    {name: 'Minuman', companies: 3, avgScore: 3.6, d1: 3.7, d2: 3.8, d3: 3.5, d4: 3.4, d5: 3.2, d6: 3.0},
                    {name: 'Logam', companies: 5, avgScore: 3.0, d1: 3.5, d2: 3.3, d3: 3.1, d4: 2.9, d5: 2.7, d6: 2.6},
                    {name: 'Otomotif', companies: 4, avgScore: 3.3, d1: 3.8, d2: 3.6, d3: 3.4, d4: 3.2, d5: 3.0, d6: 2.9}
                ];
                const sector = sectorData.find(s => s.name === sectorName);
                if (sector) {
                    document.querySelectorAll('#sector-tabs button').forEach(btn => {
                        if (btn.textContent === sectorName) {
                            btn.classList.add('btn--primary');
                            btn.classList.remove('btn--secondary');
                        } else {
                            btn.classList.remove('btn--primary');
                            btn.classList.add('btn--secondary');
                        }
                    });
                    this.renderSectorDetail(sector);
                }
            },

            renderSectorDetail(sector) {
                const container = document.getElementById('sector-detail-container');
                if (!container) return;

                const catClass = sector.avgScore >= 4.0 ? 'excellent' : sector.avgScore >= 3.0 ? 'good' : 'fair';
                const catName = sector.avgScore >= 4.0 ? 'SANGAT BAIK' : sector.avgScore >= 3.0 ? 'BAIK' : 'CUKUP';

                const dims = [
                    {id: 'D1', name: 'Efisiensi Sumber Daya', score: sector.d1},
                    {id: 'D2', name: 'Minimalisasi Limbah', score: sector.d2},
                    {id: 'D3', name: 'Desain Berkelanjutan', score: sector.d3},
                    {id: 'D4', name: 'Daur Ulang', score: sector.d4},
                    {id: 'D5', name: 'Rantai Pasok', score: sector.d5},
                    {id: 'D6', name: 'Manajemen & Inovasi', score: sector.d6}
                ];

                container.innerHTML = `
                    <div style="background: var(--color-bg-1); padding: var(--space-20); border-radius: var(--radius-lg); margin-bottom: var(--space-16);">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h3 style="margin-bottom: var(--space-8);">Sektor ${sector.name}</h3>
                                <div style="color: var(--color-text-secondary);">Total Perusahaan: <strong>${sector.companies}</strong></div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: var(--font-size-3xl); font-weight: bold; color: var(--color-primary);">${sector.avgScore.toFixed(1)}</div>
                                <span class="score-badge ${catClass}">${catName}</span>
                            </div>
                        </div>
                    </div>

                    <h4 style="margin-bottom: var(--space-16);">Skor 6 Dimensi</h4>
                    <div style="display: grid; gap: var(--space-8); margin-bottom: var(--space-24);">
                        ${dims.map((d, idx) => {
                            const pct = (d.score / 5) * 100;
                            const colors = ['#2563eb', '#16a34a', '#d97706', '#dc2626', '#7c3aed', '#0891b2'];
                            const color = colors[idx];
                            return `<div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: var(--space-4); font-size: var(--font-size-sm);">
                                    <span>${d.id}: ${d.name}</span>
                                    <strong style="color: ${color};">${d.score.toFixed(1)}</strong>
                                </div>
                                <div style="background: ${color}15; height: 12px; border-radius: 6px; overflow: hidden; border: 1px solid ${color}40;">
                                    <div style="background: ${color}; height: 100%; width: ${pct}%; transition: width 0.3s; box-shadow: inset 0 0 8px rgba(0,0,0,0.1);"></div>
                                </div>
                            </div>`;
                        }).join('')}
                    </div>

                    <h4 style="margin-bottom: var(--space-16);">Perusahaan dalam Sektor (Sample)</h4>
                    <table class="data-table" style="font-size: var(--font-size-sm);">
                        <thead>
                            <tr>
                                <th>No</th><th>Nama Perusahaan</th><th>Skor Total</th><th>D1</th><th>D2</th><th>D3</th><th>D4</th><th>D5</th><th>D6</th><th>Tanggal</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td><td>PT ${sector.name} A</td><td><span class="score-badge good">${(sector.avgScore + 0.4).toFixed(1)}</span></td>
                                <td>${(sector.d1 + 0.2).toFixed(1)}</td><td>${(sector.d2 + 0.1).toFixed(1)}</td><td>${(sector.d3 + 0.3).toFixed(1)}</td>
                                <td>${(sector.d4 + 0.2).toFixed(1)}</td><td>${(sector.d5 + 0.1).toFixed(1)}</td><td>${(sector.d6 + 0.2).toFixed(1)}</td>
                                <td>28/11/2025</td>
                            </tr>
                            <tr>
                                <td>2</td><td>PT ${sector.name} B</td><td><span class="score-badge fair">${(sector.avgScore - 0.2).toFixed(1)}</span></td>
                                <td>${(sector.d1 - 0.3).toFixed(1)}</td><td>${(sector.d2 - 0.2).toFixed(1)}</td><td>${(sector.d3 - 0.1).toFixed(1)}</td>
                                <td>${(sector.d4 - 0.2).toFixed(1)}</td><td>${(sector.d5 - 0.3).toFixed(1)}</td><td>${(sector.d6 - 0.2).toFixed(1)}</td>
                                <td>27/11/2025</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="alert alert-success" style="margin-top: var(--space-16);">
                        <strong>üí° Rekomendasi Sektor ${sector.name}:</strong><br>
                        ${this.getSectorRecommendation(sector)}
                    </div>
                `;
            },

            getSectorRecommendation(sector) {
                const dims = [{id: 'D1', score: sector.d1}, {id: 'D2', score: sector.d2}, {id: 'D3', score: sector.d3}, {id: 'D4', score: sector.d4}, {id: 'D5', score: sector.d5}, {id: 'D6', score: sector.d6}];
                const best = dims.reduce((a,b) => a.score > b.score ? a : b);
                const weak = dims.reduce((a,b) => a.score < b.score ? a : b);
                return `Sektor menunjukkan performa baik pada ${best.id} (${best.score.toFixed(1)}), namun perlu fokus improvement pada ${weak.id} (${weak.score.toFixed(1)}). Rekomendasi: Develop comprehensive action plan untuk meningkatkan dimensi terlemah.`;
            },

            renderTrendLineChart() {
                const canvas = document.getElementById('trendLineChart');
                if (!canvas) return;

                const months = ['Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov'];
                
                // Sector-specific colors from application_data_json
                const sectorColors = {
                    'Tekstil': '#8b5cf6',      // Purple
                    'Plastik': '#f59e0b',      // Amber
                    'Kertas': '#10b981',       // Green
                    'Elektronik': '#0ea5e9',   // Sky Blue
                    'Kimia': '#ef4444',        // Red
                    'Minuman': '#06b6d4',      // Cyan
                    'Logam': '#6366f1',        // Indigo
                    'Otomotif': '#f97316'      // Orange
                };
                
                // Trend data from application_data_json
                const trendData = {
                    'Tekstil': [3.0, 3.2, 3.3, 3.4, 3.3, 3.4],
                    'Plastik': [2.8, 2.9, 3.0, 3.1, 3.2, 3.1],
                    'Kertas': [3.3, 3.4, 3.5, 3.6, 3.5, 3.5],
                    'Elektronik': [3.0, 3.1, 3.2, 3.2, 3.3, 3.2],
                    'Kimia': [2.6, 2.7, 2.8, 2.9, 2.9, 2.9],
                    'Minuman': [3.4, 3.5, 3.6, 3.7, 3.6, 3.6],
                    'Logam': [2.8, 2.9, 2.9, 3.0, 3.0, 3.0],
                    'Otomotif': [3.1, 3.2, 3.2, 3.3, 3.4, 3.3]
                };

                const sectors = Object.keys(sectorColors);
                
                const datasets = sectors.map(sector => {
                    const color = sectorColors[sector];
                    return {
                        label: sector,
                        data: trendData[sector],
                        borderColor: color,
                        backgroundColor: color + '20',
                        borderWidth: 2.5,
                        tension: 0.4,
                        pointRadius: 4,
                        pointBackgroundColor: color,
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointHoverRadius: 6
                    };
                });
                
                // Add Target line
                datasets.push({
                    label: 'Target: 4.0',
                    data: [4.0, 4.0, 4.0, 4.0, 4.0, 4.0],
                    borderColor: '#84cc16',  // Lime Green
                    backgroundColor: 'rgba(132, 204, 22, 0.05)',
                    borderDash: [5, 5],
                    borderWidth: 2,
                    fill: false,
                    pointRadius: 0,
                    tension: 0
                });

                if (this.charts.trendLine) this.charts.trendLine.destroy();

                this.charts.trendLine = new Chart(canvas, {
                    type: 'line',
                    data: { labels: months, datasets: datasets },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        scales: {
                            y: { 
                                min: 2.0,
                                max: 5.0,
                                ticks: { stepSize: 0.5 },
                                grid: { color: '#e5e7eb' }
                            },
                            x: {
                                grid: { display: false }
                            }
                        },
                        plugins: {
                            legend: { 
                                position: 'bottom',
                                labels: {
                                    boxWidth: 12,
                                    padding: 15,
                                    font: { size: 12 },
                                    usePointStyle: true
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#fff',
                                bodyColor: '#fff',
                                padding: 12,
                                displayColors: true,
                                callbacks: {
                                    label: function(context) {
                                        return context.dataset.label + ': ' + context.parsed.y.toFixed(2);
                                    }
                                }
                            }
                        },
                        interaction: {
                            mode: 'index',
                            intersect: false
                        }
                    }
                });
            },

            renderHeatmap() {
                const container = document.getElementById('heatmap-container');
                if (!container) return;

                const sectors = ['Tekstil', 'Plastik', 'Kertas', 'Elektronik', 'Kimia', 'Minuman', 'Logam', 'Otomotif'];
                const data = [
                    {sector: 'Tekstil', d1: 4.1, d2: 3.8, d3: 3.5, d4: 3.2, d5: 3.0, d6: 2.8, avg: 3.4},
                    {sector: 'Plastik', d1: 3.8, d2: 3.5, d3: 3.2, d4: 3.0, d5: 2.8, d6: 2.5, avg: 3.1},
                    {sector: 'Kertas', d1: 3.9, d2: 4.0, d3: 3.6, d4: 3.3, d5: 3.1, d6: 3.2, avg: 3.5},
                    {sector: 'Elektronik', d1: 3.6, d2: 3.4, d3: 3.3, d4: 3.1, d5: 2.9, d6: 2.8, avg: 3.2},
                    {sector: 'Kimia', d1: 3.4, d2: 3.2, d3: 3.0, d4: 2.8, d5: 2.6, d6: 2.5, avg: 2.9},
                    {sector: 'Minuman', d1: 3.7, d2: 3.8, d3: 3.5, d4: 3.4, d5: 3.2, d6: 3.0, avg: 3.6},
                    {sector: 'Logam', d1: 3.5, d2: 3.3, d3: 3.1, d4: 2.9, d5: 2.7, d6: 2.6, avg: 3.0},
                    {sector: 'Otomotif', d1: 3.8, d2: 3.6, d3: 3.4, d4: 3.2, d5: 3.0, d6: 2.9, avg: 3.3}
                ];

                const getColor = (score, dimIdx) => {
                    const baseColors = ['#2563eb', '#16a34a', '#d97706', '#dc2626', '#7c3aed', '#0891b2'];
                    const intensity = score >= 4.0 ? '' : score >= 3.0 ? '80' : '50';
                    return baseColors[dimIdx] + intensity;
                };

                container.innerHTML = `
                    <div style="overflow-x: auto;">
                        <table class="data-table" style="min-width: 800px;">
                            <thead>
                                <tr>
                                    <th>Sektor</th>
                                    <th style="background: #2563eb20; color: #2563eb;">D1</th>
                                    <th style="background: #16a34a20; color: #16a34a;">D2</th>
                                    <th style="background: #d9770620; color: #d97706;">D3</th>
                                    <th style="background: #dc262620; color: #dc2626;">D4</th>
                                    <th style="background: #7c3aed20; color: #7c3aed;">D5</th>
                                    <th style="background: #0891b220; color: #0891b2;">D6</th>
                                    <th>Rata-rata</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.map(row => `<tr>
                                    <td><strong>${row.sector}</strong></td>
                                    <td style="background: ${getColor(row.d1, 0)}30; color: #2563eb; font-weight: bold; text-align: center;">${row.d1.toFixed(1)}</td>
                                    <td style="background: ${getColor(row.d2, 1)}30; color: #16a34a; font-weight: bold; text-align: center;">${row.d2.toFixed(1)}</td>
                                    <td style="background: ${getColor(row.d3, 2)}30; color: #d97706; font-weight: bold; text-align: center;">${row.d3.toFixed(1)}</td>
                                    <td style="background: ${getColor(row.d4, 3)}30; color: #dc2626; font-weight: bold; text-align: center;">${row.d4.toFixed(1)}</td>
                                    <td style="background: ${getColor(row.d5, 4)}30; color: #7c3aed; font-weight: bold; text-align: center;">${row.d5.toFixed(1)}</td>
                                    <td style="background: ${getColor(row.d6, 5)}30; color: #0891b2; font-weight: bold; text-align: center;">${row.d6.toFixed(1)}</td>
                                    <td style="background: var(--color-primary)20; font-weight: bold; text-align: center;">${row.avg.toFixed(1)}</td>
                                </tr>`).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            },

            renderInsights() {
                const container = document.getElementById('insights-container');
                if (!container) return;

                container.innerHTML = `
                    <div style="display: grid; gap: var(--space-16);">
                        <div class="alert alert-success">
                            <strong style="color: var(--color-primary-green);">üü¢ GOOD PERFORMANCE:</strong><br>
                            Sektor Minuman menunjukkan skor tertinggi (3.6) dengan D1 & D2 mencapai level excellence. Pertahankan momentum dan jadikan best practice untuk sektor lain!
                        </div>
                        <div class="alert" style="background-color: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); color: var(--color-warning);">
                            <strong style="color: #f59e0b;">üü° NEEDS ATTENTION:</strong><br>
                            Dimensi D6 (Sistem Manajemen & Inovasi) consistently low across all sectors dengan rata-rata 2.8. Recommend industry-wide training program dan development framework.
                        </div>
                        <div class="alert alert-error">
                            <strong style="color: #f97316;">üî¥ CRITICAL:</strong><br>
                            Sektor Kimia menunjukkan performa paling rendah (2.9). Immediate intervention required dengan comprehensive improvement roadmap 6-12 bulan.
                        </div>
                    </div>
                `;
            },

            renderOldDashboard() {



            },



            // Industries Page
            renderIndustriesTable() {
                const tbody = document.getElementById('industries-table-body');
                if (!tbody) return;
                
                const searchEl = document.getElementById('search-industry');
                const sectorEl = document.getElementById('filter-sector');
                const search = searchEl ? searchEl.value.toLowerCase() : '';
                const sector = sectorEl ? sectorEl.value : '';
                
                // Show empty state if no industries
                if (this.industries.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="8" style="text-align:center; padding:var(--space-32); color:var(--color-text-secondary); font-size:var(--font-size-lg);">üìã Belum ada data perusahaan<br><br><span style="font-size:var(--font-size-sm);">Klik tombol "+ Tambah Industri" untuk menambahkan perusahaan baru</span></td></tr>';
                    return;
                }

                let filtered = this.industries.filter(ind => {
                    const matchSearch = ind.name.toLowerCase().includes(search) || 
                                       ind.location.toLowerCase().includes(search);
                    const matchSector = !sector || ind.sector === sector;
                    return matchSearch && matchSector;
                });

                if (filtered.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="8" style="text-align:center; padding:var(--space-32); color:var(--color-text-secondary); font-size:var(--font-size-lg);">üìã Belum ada data perusahaan<br><br><span style="font-size:var(--font-size-sm);">Klik tombol "+ Tambah Industri" untuk menambahkan perusahaan baru</span></td></tr>';
                    return;
                }
                
                tbody.innerHTML = filtered.map((ind, idx) => `
                    <tr>
                        <td>${idx + 1}</td>
                        <td>${ind.name}</td>
                        <td>${ind.sector}</td>
                        <td>${ind.location}</td>
                        <td><span class="status ${ind.status === 'Aktif' ? 'status--success' : 'status--warning'}">${ind.status}</span></td>
                        <td><span class="score-badge ${this.getScoreBadgeClass(ind.lastScore)}">${ind.lastScore.toFixed(1)}</span></td>
                        <td>${this.formatDate(ind.lastAudit)}</td>
                        <td>
                            <div class="table-actions">
                                <button class="action-btn" onclick="app.viewIndustry(${ind.id})">üëÅÔ∏è Lihat</button>
                                <button class="action-btn" onclick="app.deleteIndustry(${ind.id})">üóëÔ∏è Hapus</button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            },

            // Assessment
            populateAssessmentSelect() {
                const select = document.getElementById('assessment-industry');
                if (!select) return;
                
                if (this.industries.length === 0) {
                    select.innerHTML = '<option value="">-- Belum ada perusahaan (Tambahkan di halaman Data Industri) --</option>';
                } else {
                    select.innerHTML = '<option value="">-- Pilih Industri --</option>' + 
                        this.industries.map(ind => `<option value="${ind.id}">${ind.name}</option>`).join('');
                }
            },

            startAssessment(industryId) {
                const industry = this.industries.find(i => i.id === industryId);
                if (!industry) return;

                this.currentAssessment = {
                    industryId: industry.id,
                    industryName: industry.name,
                    date: new Date().toISOString().split('T')[0],
                    scores: {}
                };

                const formContainer = document.getElementById('assessment-form-container');
                if (formContainer) formContainer.classList.remove('hidden');
                this.renderAssessmentForm();
            },

            renderAssessmentForm() {
                const container = document.getElementById('aspects-container');
                if (!container) return;

                const aspectFilter = (document.getElementById('assessment-aspect')||{}).value||'';
                let filteredAspects = aspekData;
                if (aspectFilter) filteredAspects = aspekData.filter(a => a.code === aspectFilter);

                container.innerHTML = filteredAspects.map(aspek => {
                    return `
                    <div class="dimension-section" style="border-left: 4px solid ${aspek.color};">
                        <div class="dimension-header">
                            <div>
                                <h3 class="dimension-title">${aspek.name}</h3>
                                <span class="dimension-weight">Indikator: ${aspek.indicators.length}</span>
                            </div>
                            <div class="dimension-score" id="aspek-score-${aspek.code}">0.0</div>
                        </div>
                        ${aspek.indicators.map((indi, iidx) => `
                            <div class="indicator-item">
                                <label class="indicator-label">${iidx+1}. ${indi.name}</label>
                                <div style="font-size:var(--font-size-xs); color:var(--color-text-secondary); margin-bottom:8px;">${indi.description}</div>
                                <div class="rating-scale">
                                    ${[1,2,3,4,5].map(val => `
                                        <div class="rating-option">
                                            <input type="radio" name="${aspek.code}-${indi.id}" value="${val}" id="${aspek.code}-${indi.id}-${val}" onchange="app.updateAssessmentScores()">
                                            <label for="${aspek.code}-${indi.id}-${val}" style="font-size:var(--font-size-sm);">${val}</label>
                                        </div>
                                    `).join('')}
                                </div>
                                <div style="margin-top:8px;"><textarea class="form-control" placeholder="Catatan/evidence..." id="note-${aspek.code}-${indi.id}" rows="1" style="font-size:12px;"></textarea></div>
                            </div>
                        `).join('')}
                    </div>
                    `;
                }).join('') || '<tr><td colspan="5" style="text-align:center; padding:var(--space-24); color:var(--color-text-secondary);">Belum ada data perusahaan. Silakan tambah perusahaan baru menggunakan form di halaman Data Industri.</td></tr>';
            },

            updateAssessmentScores() {
                // Calculate per aspek
                const scores = {};
                aspekData.forEach(aspek => {
                    let sum = 0;
                    let count = 0;
                    aspek.indicators.forEach(indi => {
                        const sel = document.querySelector(`input[name="${aspek.code}-${indi.id}"]:checked`);
                        if (sel) {
                            sum += parseInt(sel.value);
                            count++;
                        }
                    });
                    const avg = count > 0 ? (sum/count) : 0;
                    scores[aspek.code] = avg;
                    const domScore = document.getElementById(`aspek-score-${aspek.code}`);
                    if (domScore) domScore.textContent = avg.toFixed(1);
                    const summaryScore = document.getElementById(`score-${aspek.code.toLowerCase()}`);
                    if (summaryScore) summaryScore.textContent = avg.toFixed(1);
                });

                // Total score (all average for simplicity or weighted)
                // Using simple average of 6 aspects
                const totalScore = (scores.TEKNIS + scores.EKONOMI + scores.SOSIAL + scores.LINGKUNGAN + scores.SIRKULAR + scores.PERIZINAN) / 6;
                document.getElementById('total-score-value').textContent = totalScore.toFixed(1);
                const category = this.getScoreCategory(totalScore);
                document.getElementById('total-score-category').textContent = category.label + ' ' + category.name;
            },

            // Render assessment form - removed OLD code
            renderAssessmentFormOLD() {
                const container = document.getElementById('dimensions-container');
                
                container.innerHTML = this.dimensions.map((dim, dimIdx) => `
                    <div class="dimension-section">
                        <div class="dimension-header">
                            <div>
                                <h3 class="dimension-title">${dim.name}</h3>
                                <span class="dimension-weight">Bobot: ${(dim.weight * 100)}%</span>
                            </div>
                            <div class="dimension-score" id="dim-score-${dim.id}">0.0</div>
                        </div>
                        ${dim.indicators.map((indicator, indIdx) => `
                            <div class="indicator-item">
                                <label class="indicator-label">${indicator}</label>
                                <div class="rating-scale">
                                    ${[1, 2, 3, 4, 5].map(score => `
                                        <div class="rating-option">
                                            <input type="radio" 
                                                   name="${dim.id}-${indIdx}" 
                                                   value="${score}" 
                                                   id="${dim.id}-${indIdx}-${score}"
                                                   onchange="app.updateScores()">
                                            <label for="${dim.id}-${indIdx}-${score}">${score}</label>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `).join('');
            },

            updateScores() {
                // This function is replaced by updateAssessmentScores()
                // Kept for backward compatibility but redirects to new function
                this.updateAssessmentScores();
            },

            saveAssessment() {
                if (!this.currentAssessment) {
                    alert('‚ö†Ô∏è Silakan pilih industri terlebih dahulu!');
                    return;
                }

                const totalScoreEl = document.getElementById('total-score-value');
                const findingsEl = document.getElementById('assessment-findings');
                const recommendationsEl = document.getElementById('assessment-recommendations');
                
                const totalScore = totalScoreEl ? parseFloat(totalScoreEl.textContent) || 0 : 0;
                const findings = findingsEl ? findingsEl.value || '' : '';
                const recommendations = recommendationsEl ? recommendationsEl.value || '' : '';

                // Collect per-aspek scores
                const aspekScores = {};
                aspekData.forEach(aspek => {
                    const el = document.getElementById(`aspek-score-${aspek.code}`);
                    aspekScores[aspek.code] = el ? parseFloat(el.textContent) : 0;
                });

                // Update industry score
                const industry = this.industries.find(i => i.id === this.currentAssessment.industryId);
                if (industry) {
                    industry.lastScore = totalScore;
                    industry.lastAudit = this.currentAssessment.date;
                }

                // Save assessment (NEW structure)
                const assessment = {
                    id: this.assessments.length + 1,
                    auditNo: 'AUD' + String(this.assessments.length + 1).padStart(4,'0'),
                    industryId: this.currentAssessment.industryId,
                    industryCode: 'IND' + String(this.currentAssessment.industryId).padStart(3,'0'),
                    industryName: this.currentAssessment.industryName,
                    sector: industry ? industry.sector : 'Unknown',
                    date: this.currentAssessment.date,
                    scoreTeknis: aspekScores.TEKNIS || 0,
                    scoreEkonomi: aspekScores.EKONOMI || 0,
                    scoreSosial: aspekScores.SOSIAL || 0,
                    scoreLingkungan: aspekScores.LINGKUNGAN || 0,
                    scoreSirkular: aspekScores.SIRKULAR || 0,
                    scorePerizinan: aspekScores.PERIZINAN || 0,
                    score: totalScore,
                    category: this.getScoreCategory(totalScore),
                    findings: findings,
                    recommendations: recommendations,
                    auditor: 'Tim Pengawas'
                };

                this.assessments.push(assessment);

                // Show success message
                alert('‚úÖ Penilaian berhasil disimpan!');

                // Reset form
                const form = document.getElementById('assessment-form');
                const industrySelect = document.getElementById('assessment-industry');
                const aspectSelect = document.getElementById('assessment-aspect');
                const formContainer = document.getElementById('assessment-form-container');
                
                if (form) form.reset();
                if (industrySelect) industrySelect.value = '';
                if (aspectSelect) aspectSelect.value = '';
                if (formContainer) formContainer.classList.add('hidden');
                
                // Refresh dashboard
                this.renderDashboard();
            },

            // Audits Table
            renderAuditsTable() {
                const tbody = document.getElementById('audits-table-body');
                if (!tbody) return;
                
                // Show empty state if no assessments
                if (this.assessments.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="14" style="text-align:center; padding:var(--space-32); color:var(--color-text-secondary); font-size:var(--font-size-lg);">üìä Belum ada hasil penilaian<br><br><span style="font-size:var(--font-size-sm);">Lakukan penilaian industri di halaman "Penilaian Industri" terlebih dahulu</span></td></tr>';
                    return;
                }
                
                const searchEl = document.getElementById('search-audit');
                const sectorEl = document.getElementById('filter-audit-sector');
                const categoryEl = document.getElementById('filter-audit-category');
                
                const search = searchEl ? searchEl.value || '' : '';
                const sector = sectorEl ? sectorEl.value || '' : '';
                const category = categoryEl ? categoryEl.value || '' : '';

                let filtered = this.assessments.filter(audit => {
                    const matchSearch = (audit.industryName||'').toLowerCase().includes(search.toLowerCase()) ||
                                       (audit.auditNo||'').toLowerCase().includes(search.toLowerCase());
                    const matchSector = !sector || audit.sector === sector;
                    const matchCategory = !category || ((audit.category||{}).name === category);
                    return matchSearch && matchSector && matchCategory;
                });

                tbody.innerHTML = filtered.map(audit => `
                    <tr>
                        <td>${audit.auditNo || '-'}</td>
                        <td>${audit.industryCode || '-'}</td>
                        <td>${audit.industryName || '-'}</td>
                        <td>${this.formatDate(audit.date)}</td>
                        <td>${audit.auditor || '-'}</td>
                        <td>${(audit.scoreTeknis || audit.d1 || 0).toFixed(1)}</td>
                        <td>${(audit.scoreEkonomi || audit.d2 || 0).toFixed(1)}</td>
                        <td>${(audit.scoreSosial || audit.d3 || 0).toFixed(1)}</td>
                        <td>${(audit.scoreLingkungan || audit.d4 || 0).toFixed(1)}</td>
                        <td>${(audit.scoreSirkular || audit.d5 || 0).toFixed(1)}</td>
                        <td>${(audit.scorePerizinan || audit.d6 || 0).toFixed(1)}</td>
                        <td><span class="score-badge ${this.getScoreBadgeClass(audit.score || 0)}">${(audit.score || 0).toFixed(1)}</span></td>
                        <td><span class="status status--${(audit.score||0) >= 3.5 ? 'success' : 'warning'}">${(audit.category||{}).name||'N/A'}</span></td>
                        <td>
                            <div class="table-actions">
                                <button class="action-btn" onclick="app.viewAuditDetail(${audit.id})">üëÅÔ∏è Detail</button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            },

            viewAuditDetail(id) {
                const audit = this.assessments.find(a => a.id === id);
                if (!audit) {
                    alert('‚ö†Ô∏è Data audit tidak ditemukan!');
                    return;
                }
                const tk = (audit.scoreTeknis || audit.d1 || 0).toFixed(1);
                    const ek = (audit.scoreEkonomi || audit.d2 || 0).toFixed(1);
                    const so = (audit.scoreSosial || audit.d3 || 0).toFixed(1);
                    const li = (audit.scoreLingkungan || audit.d4 || 0).toFixed(1);
                    const si = (audit.scoreSirkular || audit.d5 || 0).toFixed(1);
                    const pe = (audit.scorePerizinan || audit.d6 || 0).toFixed(1);
                alert('üìã Detail Penilaian ' + (audit.auditNo || '-') + '\n\nIndustri: ' + audit.industryName + '\nTanggal: ' + this.formatDate(audit.date) + '\nPengawas: ' + (audit.auditor || '-') + '\n\nSkor per Aspek:\nTeknis: ' + tk + '\nEkonomi: ' + ek + '\nSosial: ' + so + '\nLingkungan: ' + li + '\nSirkular: ' + si + '\nPerizinan: ' + pe + '\n\nSkor Total: ' + (audit.score||0).toFixed(1) + '\nKategori: ' + ((audit.category||{}).name||'-') + '\n\nTemuan: ' + (audit.findings||'-') + '\nRekomendasi: ' + (audit.recommendations||'-'));
            },

            // Statistics
            renderStatistics() {
                this.renderDescriptiveStats();
                this.renderStatsSectorChart();
                this.renderStatsAuditorChart();
                this.renderStatsQuarterlyChart();
            },

            renderDescriptiveStats() {
                const tbody = document.getElementById('stats-descriptive-body');
                if (!tbody) return;
                const stats = [];

                // NEW: use aspekData codes
                const aspekCodes = ['scoreTeknis', 'scoreEkonomi', 'scoreSosial', 'scoreLingkungan', 'scoreSirkular', 'scorePerizinan'];
                const aspekNames = ['Teknis', 'Ekonomi', 'Sosial', 'Lingkungan', 'Sirkular', 'Perizinan'];
                aspekCodes.forEach((code, idx) => {
                    const values = this.assessments.map(a => a[code] || 0).filter(v => v > 0);
                    if (values.length === 0) return;
                    const mean = values.reduce((sum, v) => sum + v, 0) / values.length;
                    const sorted = [...values].sort((a, b) => a - b);
                    const median = sorted[Math.floor(sorted.length / 2)];
                    const variance = values.reduce((sum, v) => sum + Math.pow(v - mean, 2), 0) / values.length;
                    const stdDev = Math.sqrt(variance);
                    const min = Math.min(...values);
                    const max = Math.max(...values);

                    stats.push({
                        dimension: aspekNames[idx],
                        mean: mean.toFixed(2),
                        median: median.toFixed(2),
                        stdDev: stdDev.toFixed(2),
                        min: min.toFixed(1),
                        max: max.toFixed(1)
                    });
                });

                tbody.innerHTML = stats.map(stat => `
                    <tr>
                        <td>${stat.dimension}</td>
                        <td>${stat.mean}</td>
                        <td>${stat.median}</td>
                        <td>${stat.stdDev}</td>
                        <td>${stat.min}</td>
                        <td>${stat.max}</td>
                    </tr>
                `).join('');
            },

            renderStatsSectorChart() {
                const canvas = document.getElementById('statsSectorChart');
                if (!canvas) return;
                const ctx = canvas.getContext('2d');
                if (!ctx) return;

                const sectorData = {};
                this.assessments.forEach(audit => {
                    if (!sectorData[audit.sector]) {
                        sectorData[audit.sector] = { total: 0, count: 0 };
                    }
                    sectorData[audit.sector].total += audit.score;
                    sectorData[audit.sector].count++;
                });

                const sectors = Object.keys(sectorData);
                const avgScores = sectors.map(s => (sectorData[s].total / sectorData[s].count).toFixed(2));

                if (this.charts.statsSector) this.charts.statsSector.destroy();

                this.charts.statsSector = new Chart(canvas, {
                    type: 'bar',
                    data: {
                        labels: sectors,
                        datasets: [{
                            label: 'Rata-rata Skor',
                            data: avgScores,
                            backgroundColor: '#208f81'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        scales: {
                            y: { beginAtZero: true, max: 5 }
                        }
                    }
                });
            },

            renderStatsAuditorChart() {
                const canvas = document.getElementById('statsAuditorChart');
                if (!canvas) return;
                const ctx = canvas.getContext('2d');
                if (!ctx) return;

                const auditorData = {};
                this.assessments.forEach(audit => {
                    if (!auditorData[audit.auditor]) {
                        auditorData[audit.auditor] = { total: 0, count: 0 };
                    }
                    auditorData[audit.auditor].total += audit.score;
                    auditorData[audit.auditor].count++;
                });

                const auditors = Object.keys(auditorData);
                const avgScores = auditors.map(a => (auditorData[a].total / auditorData[a].count).toFixed(2));

                if (this.charts.statsAuditor) this.charts.statsAuditor.destroy();

                this.charts.statsAuditor = new Chart(canvas, {
                    type: 'bar',
                    data: {
                        labels: auditors,
                        datasets: [{
                            label: 'Rata-rata Skor',
                            data: avgScores,
                            backgroundColor: '#32b8c6'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        scales: {
                            y: { beginAtZero: true, max: 5 }
                        }
                    }
                });
            },

            renderStatsQuarterlyChart() {
                const canvas = document.getElementById('statsQuarterlyChart');
                if (!canvas) return;
                const ctx = canvas.getContext('2d');
                if (!ctx) return;

                const quarters = ['Q1 2025', 'Q2 2025', 'Q3 2025', 'Q4 2025'];
                const avgScores = [3.2, 3.4, 3.6, 3.8];

                if (this.charts.statsQuarterly) this.charts.statsQuarterly.destroy();

                this.charts.statsQuarterly = new Chart(canvas, {
                    type: 'line',
                    data: {
                        labels: quarters,
                        datasets: [{
                            label: 'Skor Rata-rata',
                            data: avgScores,
                            borderColor: '#208f81',
                            backgroundColor: 'rgba(32, 143, 129, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        scales: {
                            y: { beginAtZero: true, max: 5 }
                        }
                    }
                });
            },

            // Recommendations
            renderRecommendations() {
                const tbody = document.getElementById('recommendations-table-body');
                if (!tbody) return;
                
                const statusEl = document.getElementById('filter-recommendation-status');
                const priorityEl = document.getElementById('filter-recommendation-priority');
                
                const status = statusEl ? statusEl.value : '';
                const priority = priorityEl ? priorityEl.value : '';

                let filtered = this.recommendations.filter(rec => {
                    const matchStatus = !status || rec.status === status;
                    const matchPriority = !priority || rec.priority === priority;
                    return matchStatus && matchPriority;
                });

                tbody.innerHTML = filtered.map(rec => `
                    <tr>
                        <td>${rec.id}</td>
                        <td>${rec.auditNo}</td>
                        <td>${rec.industryName}</td>
                        <td>${rec.recommendation}</td>
                        <td><span class="status ${this.getPriorityClass(rec.priority)}">${rec.priority}</span></td>
                        <td>${this.formatDate(rec.targetDate)}</td>
                        <td><span class="status ${this.getStatusClass(rec.status)}">${rec.status}</span></td>
                        <td>${rec.progress}</td>
                        <td>
                            <div class="table-actions">
                                <button class="action-btn" onclick="app.updateRecommendation(${rec.id})">‚úèÔ∏è Update</button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            },

            getPriorityClass(priority) {
                if (priority.includes('Segera')) return 'status--error';
                if (priority.includes('Mendesak')) return 'status--warning';
                return 'status--success';
            },

            getStatusClass(status) {
                if (status === 'Completed') return 'status--success';
                if (status === 'Overdue') return 'status--error';
                if (status === 'In Progress') return 'status--warning';
                return 'status--info';
            },

            showAddRecommendationModal() {
                alert('üîî Modal Tambah Rekomendasi\n\nFitur ini akan menambahkan rekomendasi baru untuk industri yang telah diaudit.');
            },

            updateRecommendation(id) {
                const rec = this.recommendations.find(r => r.id === id);
                if (!rec) {
                    alert('‚ö†Ô∏è Rekomendasi tidak ditemukan!');
                    return;
                }
                
                const newStatus = prompt('Update Status:\n1. Open\n2. In Progress\n3. Completed\n4. Overdue\n\nMasukkan nomor pilihan:', '2');
                const statuses = ['Open', 'In Progress', 'Completed', 'Overdue'];
                const statusNum = parseInt(newStatus);
                
                if (newStatus && statusNum >= 1 && statusNum <= 4) {
                    rec.status = statuses[statusNum - 1];
                    rec.lastUpdate = new Date().toISOString().split('T')[0];
                    this.renderRecommendations();
                    alert('‚úÖ Status rekomendasi berhasil diupdate!');
                } else if (newStatus) {
                    alert('‚ö†Ô∏è Pilihan tidak valid!');
                }
            },

            // Matrix MATRICS TABLE
            renderMatrix() {
                const container = document.getElementById('matrix-content');
                if (!container) return;

                // Filter/search
                const search = (document.getElementById('matrix-search')||{}).value||'';
                const aspect = (document.getElementById('matrix-filter-aspect')||{}).value||'';
                let html = '';
                aspekData.forEach(aspek => {
                    if (aspect && aspek.code !== aspect) return;
                    // Head per aspek
                    html += `<div class="card mb-16"><div class="card__body">
                    <div style="display:flex; align-items:baseline; justify-content:space-between;">
                        <span style="font-size:var(--font-size-xl); font-weight:600; color:${aspek.color}">${aspek.name}</span>
                        <span style="font-size:var(--font-size-sm); color:var(--color-text-secondary);">Total: ${aspek.indicators.length} indikator</span>
                    </div>`;
                    html += `<table class="data-table" style="margin-top:var(--space-12); font-size:var(--font-size-sm)"><thead><tr>
                    <th>No</th><th>Indikator</th><th>Deskripsi</th><th>Metode Penilaian</th><th>Bobot (%)</th><th>Skala</th><th>Checklist</th></tr></thead><tbody>`;
                    aspek.indicators.forEach((indi, idx) => {
                        // Search filter
                        if (search && !(
                            (indi.name||'').toLowerCase().includes(search.toLowerCase()) ||
                            (indi.description||'').toLowerCase().includes(search.toLowerCase()) )
                        ) return;
                        html += `<tr>
                        <td>${idx+1}</td>
                        <td><span style="font-weight:600;">${indi.name}</span>${indi.evidence?'<br><span style=\'color:var(--color-primary);font-size:12px;\'>(Evidence: '+indi.evidence.join(', ')+')</span>':''}</td>
                        <td><span class='expand-txt' style='cursor:pointer;text-decoration:underline' title='Tampilkan detail' onclick='app.toggleMatrixDetail(this)'>${indi.description.length>48?indi.description.slice(0,48)+'...':indi.description}</span><div class="hidden matrix-detail" style="padding-top:6px; color:var(--color-text-secondary)">${indi.description}</div></td>
                        <td>${indi.method||'-'}</td>
                        <td style="text-align:center;">${indi.weight||'-'}</td>
                        <td style="text-align:center;">
                            <span style='white-space:nowrap;'>
                            ${scaleData.map(s=>`<span style='background:${s.color};color:#fff;border-radius:7px;padding:2px 8px; margin-right:3px; font-size:11px;'>${s.value}</span>`).join('')}</span>
                        </td>
                        <td style="text-align:center;">
                            <input type="checkbox" title="Checklist evidence" style='transform:scale(1.1);'>
                        </td>
                        </tr>`;
                    });
                    html += '</tbody></table></div></div>';
                });
                if (!html) html='<div class="alert alert-error">Tidak ditemukan indikator sesuai filter.</div>';
                container.innerHTML = html;
            },

            toggleMatrixDetail(el) {
                const div = el.nextElementSibling;
                if (div) div.classList.toggle('hidden');
            },

            exportMatrix() {
                let csv = 'Aspek,No,Indikator,Deskripsi,Metode,Bobot (%),Evidence\n';
                aspekData.forEach(aspek => {
                  aspek.indicators.forEach((indi,idx) => {
                    csv+=`"${aspek.name}",${idx+1},"${indi.name}","${indi.description}","${indi.method||''}",${indi.weight||''},"${(indi.evidence||[]).join(';')}"\n`;
                  });
                });
                const blob = new Blob([csv],{type:'text/csv'});
                const url = window.URL.createObjectURL(blob);
                const a=document.createElement('a');
                a.href=url; a.download='SiPESSI_Matriks_Indikator.csv'; a.click();
            },

            // Template 
            renderTemplate() {
                // Render scales
                const scalesContainer = document.getElementById('template-scales-container');
                if (scalesContainer) {
                    scalesContainer.innerHTML = scaleData.map(sc => `
                        <div class="stat-card" style="background-color: ${sc.color}; color: white;">
                            <div style="font-size: var(--font-size-3xl); font-weight: bold;">${sc.value}</div>
                            <div style="font-size: var(--font-size-base); margin: 8px 0;">${sc.label}</div>
                            <p style="font-size: var(--font-size-xs); margin: 0; opacity: 0.9;">${sc.description}</p>
                        </div>
                    `).join('');
                }
                // Render aspects
                const aspectsContainer = document.getElementById('template-aspects-container');
                if (aspectsContainer) {
                    aspectsContainer.innerHTML = aspekData.map(aspek => `
                        <div class="card mb-16">
                            <div class="card__body">
                                <h3 style="color: ${aspek.color}; margin-bottom: var(--space-16);">${aspek.name} (${aspek.indicators.length} Indikator)</h3>
                                <ol style="padding-left: var(--space-24);">
                                    ${aspek.indicators.map(indi => `<li style="margin-bottom: var(--space-8);">${indi.name}</li>`).join('')}
                                </ol>
                            </div>
                        </div>
                    `).join('');
                }
            },

            // Reports
            renderReports() {
                const tbody = document.getElementById('reports-table-body');
                if (!tbody) return;
                
                tbody.innerHTML = this.assessments.map((assessment, idx) => `
                    <tr>
                        <td>${idx + 1}</td>
                        <td>${assessment.industryName || '-'}</td>
                        <td>${this.formatDate(assessment.date)}</td>
                        <td><span class="score-badge ${this.getScoreBadgeClass(assessment.score || 0)}">${(assessment.score || 0).toFixed(1)}</span></td>
                        <td>${(assessment.category || {}).name || '-'}</td>
                        <td>${assessment.auditor || '-'}</td>
                    </tr>
                `).join('');

                this.renderSectorComparisonChart();
            },

            renderSectorComparisonChart() {
                const canvas = document.getElementById('sectorComparisonChart');
                if (!canvas) return;
                const ctx = canvas.getContext('2d');
                if (!ctx) return;

                // Calculate average score by sector
                const sectorScores = {};
                this.industries.forEach(ind => {
                    if (!sectorScores[ind.sector]) {
                        sectorScores[ind.sector] = { total: 0, count: 0 };
                    }
                    sectorScores[ind.sector].total += ind.lastScore;
                    sectorScores[ind.sector].count++;
                });

                const sectors = Object.keys(sectorScores);
                const avgScores = sectors.map(sector => 
                    sectorScores[sector].total / sectorScores[sector].count
                );

                if (this.charts.sectorComparison) {
                    this.charts.sectorComparison.destroy();
                }

                this.charts.sectorComparison = new Chart(canvas, {
                    type: 'bar',
                    data: {
                        labels: sectors,
                        datasets: [{
                            label: 'Skor Rata-rata',
                            data: avgScores,
                            backgroundColor: '#208f81'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 5
                            }
                        }
                    }
                });
            },

            // Modal Management
            showAddIndustryModal() {
                const modal = document.getElementById('modal-add-industry');
                if (modal) modal.classList.add('active');
            },

            closeModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) modal.classList.remove('active');
            },

            // Industry Management
            addIndustry() {
                const nameEl = document.getElementById('industry-name');
                const sectorEl = document.getElementById('industry-sector');
                const locationEl = document.getElementById('industry-location');
                const statusEl = document.getElementById('industry-status');
                
                if (!nameEl || !sectorEl || !locationEl || !statusEl) {
                    alert('‚ö†Ô∏è Form tidak lengkap!');
                    return;
                }
                
                const name = nameEl.value;
                const sector = sectorEl.value;
                const location = locationEl.value;
                const status = statusEl.value;
                
                if (!name || !sector || !location) {
                    alert('‚ö†Ô∏è Silakan lengkapi semua field!');
                    return;
                }

                const newIndustry = {
                    id: this.industries.length + 1,
                    name: name,
                    sector: sector,
                    location: location,
                    status: status,
                    lastScore: 0,
                    lastAudit: new Date().toISOString().split('T')[0]
                };

                this.industries.push(newIndustry);
                this.closeModal('modal-add-industry');
                const form = document.getElementById('add-industry-form');
                if (form) form.reset();
                this.renderIndustriesTable();
                this.populateAssessmentSelect();
                
                alert('‚úÖ Industri berhasil ditambahkan!');
            },

            viewIndustry(id) {
                const industry = this.industries.find(i => i.id === id);
                if (!industry) {
                    alert('‚ö†Ô∏è Data industri tidak ditemukan!');
                    return;
                }
                const category = this.getScoreCategory(industry.lastScore);
                alert('üìã Detail Industri\n\nNama: ' + industry.name + '\nSektor: ' + industry.sector + '\nLokasi: ' + industry.location + '\nStatus: ' + industry.status + '\nSkor Terakhir: ' + industry.lastScore.toFixed(1) + ' (' + category.name + ')\nTanggal Audit: ' + this.formatDate(industry.lastAudit));
            },

            deleteIndustry(id) {
                const industry = this.industries.find(i => i.id === id);
                if (!industry) {
                    alert('‚ö†Ô∏è Data industri tidak ditemukan!');
                    return;
                }
                
                if (confirm('Yakin ingin menghapus industri "' + industry.name + '"?')) {
                    this.industries = this.industries.filter(i => i.id !== id);
                    this.renderIndustriesTable();
                    this.populateAssessmentSelect();
                    alert('‚úÖ Industri berhasil dihapus!');
                }
            },

            // Export Functions
            exportToExcel() {
                alert('üìä Fitur export Excel sedang diproses...\n\nData akan diunduh dalam format CSV yang dapat dibuka di Excel.');
                
                // Generate CSV content
                let csv = 'No,Nama Industri,Sektor,Lokasi,Status,Skor Terakhir,Tanggal Audit\n';
                this.industries.forEach((ind, idx) => {
                    csv += `${idx + 1},${ind.name},${ind.sector},${ind.location},${ind.status},${ind.lastScore},${ind.lastAudit}\n`;
                });

                // Create download link
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'SiPESSI_Data_Industri_' + new Date().toISOString().split('T')[0] + '.csv';
                a.click();
            },

            generatePDF() {
                alert('üìÑ SiPESSI - Export PDF\n\nLaporan Penilaian Ekonomi Sirkular akan dibuat dalam format PDF.');
            },

            // Utility Functions
            getScoreCategory(score) {
                if (score >= 4.1) return { name: 'Sangat Baik', label: '‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê', color: '#208f81' };
                if (score >= 3.1) return { name: 'Baik', label: '‚≠ê‚≠ê‚≠ê‚≠ê', color: '#32b8c6' };
                if (score >= 2.1) return { name: 'Cukup', label: '‚≠ê‚≠ê‚≠ê', color: '#e6a161' };
                if (score >= 1.1) return { name: 'Kurang', label: '‚≠ê‚≠ê', color: '#ff5459' };
                return { name: 'Sangat Kurang', label: '‚≠ê', color: '#c01b2f' };
            },

            getScoreBadgeClass(score) {
                if (score >= 4.1) return 'excellent';
                if (score >= 3.1) return 'good';
                if (score >= 2.1) return 'fair';
                if (score >= 1.1) return 'poor';
                return 'very-poor';
            },

            showCreateCEAssessmentModal() {
                // Show modal with company name input (manual or autocomplete) and sector
                const existingCompanies = this.industries.map(ind => ind.name);
                const companiesDatalist = existingCompanies.map(name => `<option value="${name}"></option>`).join('');
                
                const html = `
                    <div style="padding:var(--space-24); max-width: 600px;">
                        <h3 style="margin-bottom:var(--space-16);">SiPESSI - Buat Penilaian Baru</h3>
                        <p style="color:var(--color-text-secondary); font-size:var(--font-size-sm); margin-bottom:var(--space-24);">Isi data perusahaan dan sektor industri untuk memulai penilaian komprehensif 6 dimensi ekonomi sirkular</p>
                        
                        <div class="form-group">
                            <label class="form-label">Nama Perusahaan <span style="color:var(--color-error);">*</span></label>
                            <input type="text" list="companies-list" class="form-control" id="new-ce-company-name" placeholder="Ketik atau pilih nama perusahaan..." required>
                            <datalist id="companies-list">${companiesDatalist}</datalist>
                            <small style="color:var(--color-text-secondary); font-size:var(--font-size-xs);">üí° Ketik nama baru atau pilih dari perusahaan yang ada</small>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Sektor Industri <span style="color:var(--color-error);">*</span></label>
                            <select class="form-control" id="new-ce-sector" required>
                                <option value="">-- Pilih Sektor --</option>
                                ${MASTER_SEKTOR.map(s => `<option value="${s}">${s}</option>`).join('')}
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Tanggal Penilaian <span style="color:var(--color-error);">*</span></label>
                            <input type="date" class="form-control" id="new-ce-date" value="${new Date().toISOString().split('T')[0]}" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Nama Pengawas/Penilai <span style="color:var(--color-error);">*</span></label>
                            <input type="text" class="form-control" id="new-ce-auditor" placeholder="Nama pengawas..." value="Tim Pengawas" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Catatan Umum (Opsional)</label>
                            <textarea class="form-control" id="new-ce-notes-initial" rows="2" placeholder="Catatan khusus tentang penilaian ini..."></textarea>
                        </div>
                        
                        <div style="margin-top:var(--space-24); display:flex; gap:var(--space-12);">
                            <button class="btn btn--primary" onclick="app.startCEAssessment()" style="flex:1;">üöÄ Lanjut ke Penilaian 6 Dimensi</button>
                            <button class="btn btn--secondary" onclick="this.closest('.modal').remove()">Batal</button>
                        </div>
                    </div>
                `;
                const modal = document.createElement('div');
                modal.className = 'modal active';
                modal.innerHTML = `<div class="modal-content">${html}</div>`;
                document.body.appendChild(modal);
            },

            startCEAssessment() {
                const companyName = (document.getElementById('new-ce-company-name')||{}).value?.trim();
                const sector = (document.getElementById('new-ce-sector')||{}).value;
                const date = (document.getElementById('new-ce-date')||{}).value;
                const auditor = (document.getElementById('new-ce-auditor')||{}).value?.trim();
                const notes = (document.getElementById('new-ce-notes-initial')||{}).value;
                
                if (!companyName || !sector || !date || !auditor) {
                    alert('‚ö†Ô∏è Harap lengkapi semua field yang wajib diisi (*)!');
                    return;
                }
                
                // Check if company exists or create new
                let company = this.industries.find(ind => ind.name.toLowerCase() === companyName.toLowerCase());
                let companyId = company ? company.id : null;
                
                // If new company, optionally add to industries list
                if (!company) {
                    const addToList = confirm(`Perusahaan "${companyName}" belum terdaftar.\n\nApakah ingin menambahkan ke daftar perusahaan?\n(Klik OK untuk tambah, Cancel untuk hanya penilaian saja)`);
                    
                    if (addToList) {
                        const newCompany = {
                            id: this.industries.length + 1,
                            name: companyName,
                            sector: sector,
                            location: 'Belum diisi',
                            status: 'Aktif',
                            lastScore: 0,
                            lastAudit: date
                        };
                        this.industries.push(newCompany);
                        companyId = newCompany.id;
                    }
                }
                
                this.currentCEAssessment = {
                    id: this.ceAssessments.length + 1,
                    companyId: companyId,
                    companyName: companyName,
                    sector: sector,
                    date: date,
                    auditor: auditor,
                    notes: notes,
                    scores: {},
                    evidences: {},
                    dimensionScores: {D1: 0, D2: 0, D3: 0, D4: 0, D5: 0, D6: 0},
                    scoreTotal: 0,
                    category: 'Belum Dinilai'
                };
                
                document.querySelector('.modal.active')?.remove();
                
                const formTab = document.getElementById('tab-ce-form');
                if (formTab) formTab.click();
                
                this.renderCEFormTab();
                
                alert(`‚úÖ Form penilaian berhasil dibuat!\n\nPerusahaan: ${companyName}\nSektor: ${sector}\n\nSilakan isi penilaian untuk 6 dimensi ekonomi sirkular.`);
            },

            renderCEFormTab() {
                const emptyEl = document.getElementById('ce-form-empty');
                const containerEl = document.getElementById('ce-form-container');
                
                if (!this.currentCEAssessment) {
                    if (emptyEl) emptyEl.classList.remove('hidden');
                    if (containerEl) containerEl.classList.add('hidden');
                    return;
                }
                
                if (emptyEl) emptyEl.classList.add('hidden');
                if (containerEl) containerEl.classList.remove('hidden');
                
                const companyEl = document.getElementById('ce-current-company');
                const dateEl = document.getElementById('ce-current-date');
                const auditorEl = document.getElementById('ce-current-auditor');
                
                if (companyEl) companyEl.textContent = this.currentCEAssessment.companyName + ' (' + this.currentCEAssessment.sector + ')';
                if (dateEl) dateEl.textContent = this.formatDate(this.currentCEAssessment.date);
                if (auditorEl) auditorEl.textContent = this.currentCEAssessment.auditor;
                
                this.renderCEDimensionsForms();
                this.updateCEScores();
            },

            renderCEDimensionsForms() {
                const container = document.getElementById('ce-dimensions-container');
                if (!container || !this.ceData) return;
                
                const bgColors = ['var(--color-bg-1)', 'var(--color-bg-2)', 'var(--color-bg-3)', 'var(--color-bg-4)', 'var(--color-bg-5)', 'var(--color-bg-6)'];
                
                container.innerHTML = this.ceData.dimensions.map((dim, dimIdx) => `
                    <div class="card mb-16" id="ce-dim-${dim.id}" style="border-left: 4px solid var(--color-primary);">
                        <div class="card__body" style="background: ${bgColors[dimIdx]};">
                            <div style="display: flex; justify-content: space-between; align-items: baseline; margin-bottom: var(--space-16);">
                                <div>
                                    <h3 style="color: var(--color-primary); margin-bottom: var(--space-4);">${dim.id}. ${dim.name}</h3>
                                    <p style="font-size: var(--font-size-sm); color: var(--color-text-secondary); margin: 0;">${dim.description}</p>
                                    <span style="font-size: var(--font-size-xs); color: var(--color-text-secondary);">Bobot: ${dim.weight}% | ${dim.indicators.length} Indikator</span>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-size: var(--font-size-xs); color: var(--color-text-secondary);">Skor Dimensi</div>
                                    <div style="font-size: var(--font-size-3xl); font-weight: bold; color: var(--color-primary);" id="ce-dim-score-${dim.id}">0.0</div>
                                </div>
                            </div>
                            
                            ${dim.indicators.map((ind, indIdx) => `
                                <div class="card" style="margin-bottom: var(--space-12); background: var(--color-surface);">
                                    <div class="card__body">
                                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--space-8);">
                                            <div style="flex: 1;">
                                                <h4 style="margin-bottom: var(--space-4); font-size: var(--font-size-base);">${indIdx + 1}. ${ind.name}</h4>
                                                <details style="margin-bottom: var(--space-8);">
                                                    <summary style="cursor: pointer; font-size: var(--font-size-sm); color: var(--color-primary);">üìñ Lihat Detail</summary>
                                                    <div style="margin-top: var(--space-8); padding: var(--space-12); background: var(--color-bg-1); border-radius: var(--radius-base); font-size: var(--font-size-sm);">
                                                        <p style="margin: 0 0 var(--space-8) 0;"><strong>Deskripsi:</strong> ${ind.description}</p>
                                                        <p style="margin: 0 0 var(--space-8) 0;"><strong>Metode:</strong> ${ind.method}</p>
                                                        <p style="margin: 0;"><strong>Bobot:</strong> ${ind.weight}%</p>
                                                    </div>
                                                </details>
                                            </div>
                                        </div>
                                        
                                        <div style="margin-bottom: var(--space-8);">
                                            <label style="font-size: var(--font-size-sm); font-weight: 600; margin-bottom: var(--space-4); display: block;">Pilih Skor (1-5):</label>
                                            <div class="rating-scale">
                                                ${[1,2,3,4,5].map(score => `
                                                    <label class="rating-option" style="flex: 1; cursor: pointer; text-align: center;">
                                                        <input type="radio" name="${ind.id}" value="${score}" onchange="app.updateCEScores()" style="display: none;">
                                                        <div class="rating-label" style="padding: var(--space-8); border: 2px solid var(--color-border); border-radius: var(--radius-base); font-weight: bold; transition: all 0.2s;">
                                                            ${score}
                                                        </div>
                                                    </label>
                                                `).join('')}
                                            </div>
                                            <details style="margin-top: var(--space-8);">
                                                <summary style="cursor: pointer; font-size: var(--font-size-xs); color: var(--color-text-secondary);">üìã Panduan Skala</summary>
                                                <div style="margin-top: var(--space-8); font-size: var(--font-size-xs);">
                                                    ${Object.entries(ind.scales).map(([s, desc]) => `<div style="padding: var(--space-4); margin-bottom: var(--space-4); background: var(--color-bg-1); border-radius: var(--radius-sm);"><strong>${s}:</strong> ${desc}</div>`).join('')}
                                                </div>
                                            </details>
                                        </div>
                                        
                                        <div>
                                            <label style="font-size: var(--font-size-sm); font-weight: 600; margin-bottom: var(--space-4); display: block;">Catatan/Evidence:</label>
                                            <textarea class="form-control" id="ce-evidence-${ind.id}" rows="2" placeholder="Dokumentasi, bukti, catatan verifikasi..." style="font-size: var(--font-size-sm);"></textarea>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `).join('');
                
                // Add styling for selected rating
                setTimeout(() => {
                    document.querySelectorAll('.rating-option').forEach(opt => {
                        opt.addEventListener('click', function() {
                            const radio = this.querySelector('input[type="radio"]');
                            radio.checked = true;
                            const allInGroup = document.querySelectorAll(`input[name="${radio.name}"]`);
                            allInGroup.forEach(r => {
                                const label = r.closest('.rating-option').querySelector('.rating-label');
                                if (r.checked) {
                                    label.style.background = 'var(--color-primary)';
                                    label.style.color = 'var(--color-btn-primary-text)';
                                    label.style.borderColor = 'var(--color-primary)';
                                } else {
                                    label.style.background = 'transparent';
                                    label.style.color = 'var(--color-text)';
                                    label.style.borderColor = 'var(--color-border)';
                                }
                            });
                            radio.dispatchEvent(new Event('change'));
                        });
                    });
                }, 100);
            },

            updateCEScores() {
                if (!this.currentCEAssessment || !this.ceData) return;
                
                let totalWeightedScore = 0;
                let filledCount = {D1: 0, D2: 0, D3: 0, D4: 0, D5: 0, D6: 0};
                
                this.ceData.dimensions.forEach(dim => {
                    let dimSum = 0;
                    let dimCount = 0;
                    
                    dim.indicators.forEach(ind => {
                        const radio = document.querySelector(`input[name="${ind.id}"]:checked`);
                        if (radio) {
                            dimSum += parseInt(radio.value);
                            dimCount++;
                            filledCount[dim.id]++;
                        }
                    });
                    
                    const dimAvg = dimCount > 0 ? dimSum / dimCount : 0;
                    this.currentCEAssessment.dimensionScores[dim.id] = dimAvg;
                    
                    const dimScoreEl = document.getElementById(`ce-dim-score-${dim.id}`);
                    if (dimScoreEl) dimScoreEl.textContent = dimAvg.toFixed(1);
                    
                    const summaryScoreEl = document.getElementById(`ce-score-${dim.id.toLowerCase()}`);
                    if (summaryScoreEl) summaryScoreEl.textContent = dimAvg.toFixed(1);
                    
                    totalWeightedScore += dimAvg * (dim.weight / 100);
                    
                    const progressEl = document.getElementById(`ce-progress-${dim.id.toLowerCase()}`);
                    if (progressEl) progressEl.textContent = `${dimCount}/${dim.indicators.length}`;
                });
                
                this.currentCEAssessment.scoreTotal = totalWeightedScore;
                
                const totalScoreEl = document.getElementById('ce-total-score');
                if (totalScoreEl) totalScoreEl.textContent = totalWeightedScore.toFixed(1);
                
                const currentScoreEl = document.getElementById('ce-current-score');
                if (currentScoreEl) currentScoreEl.textContent = totalWeightedScore.toFixed(1);
                
                const category = this.getCECategory(totalWeightedScore);
                this.currentCEAssessment.category = category.name;
                
                const categoryEl = document.getElementById('ce-total-category');
                if (categoryEl) {
                    categoryEl.textContent = category.emoji + ' ' + category.name;
                    categoryEl.style.color = 'white';
                }
            },

            getCECategory(score) {
                if (score >= 4.1) return {name: 'Sangat Baik', emoji: '‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê', color: '#208f81', recommendation: 'Maintain current performance dan share best practices'};
                if (score >= 3.1) return {name: 'Baik', emoji: '‚≠ê‚≠ê‚≠ê‚≠ê', color: '#32b8c6', recommendation: 'Perbaiki gap minor dan target level excellence'};
                if (score >= 2.1) return {name: 'Cukup', emoji: '‚≠ê‚≠ê‚≠ê', color: '#e6a161', recommendation: 'Develop improvement plan signifikan untuk 6-12 bulan'};
                if (score >= 1.1) return {name: 'Kurang', emoji: '‚≠ê‚≠ê', color: '#ff5459', recommendation: 'Immediate action required - develop detailed roadmap'};
                return {name: 'Sangat Kurang', emoji: '‚≠ê', color: '#c01b2f', recommendation: 'Critical - executive attention & comprehensive intervention'};
            },

            jumpToCEDimension(dimId) {
                const el = document.getElementById(`ce-dim-${dimId}`);
                if (el) el.scrollIntoView({behavior: 'smooth', block: 'start'});
            },

            saveCEAssessment() {
                if (!this.currentCEAssessment) {
                    alert('‚ö†Ô∏è Tidak ada penilaian aktif!');
                    return;
                }
                
                // Collect evidence
                this.ceData.dimensions.forEach(dim => {
                    dim.indicators.forEach(ind => {
                        const evidenceEl = document.getElementById(`ce-evidence-${ind.id}`);
                        if (evidenceEl) {
                            this.currentCEAssessment.evidences[ind.id] = evidenceEl.value;
                        }
                        const radio = document.querySelector(`input[name="${ind.id}"]:checked`);
                        if (radio) {
                            this.currentCEAssessment.scores[ind.id] = parseInt(radio.value);
                        }
                    });
                });
                
                const notesEl = document.getElementById('ce-notes');
                const recsEl = document.getElementById('ce-recommendations');
                if (notesEl) this.currentCEAssessment.notes = notesEl.value;
                if (recsEl) this.currentCEAssessment.recommendations = recsEl.value;
                
                this.ceAssessments.push({...this.currentCEAssessment});
                
                alert('‚úÖ SiPESSI - Penilaian Berhasil Disimpan!\n\nPerusahaan: ' + this.currentCEAssessment.companyName + '\nSkor Total: ' + this.currentCEAssessment.scoreTotal.toFixed(1) + '\nKategori: ' + this.currentCEAssessment.category + '\n\nData telah tersimpan di sistem SiPESSI.');
                
                this.currentCEAssessment = null;
                
                const listTab = document.getElementById('tab-ce-list');
                if (listTab) listTab.click();
            },

            resetCEForm() {
                if (confirm('Yakin ingin mereset form? Semua data yang belum disimpan akan hilang.')) {
                    this.renderCEFormTab();
                }
            },

            exportCEReport() {
                if (!this.currentCEAssessment) {
                    alert('‚ö†Ô∏è Tidak ada penilaian aktif untuk di-export!');
                    return;
                }
                alert('üìÑ SiPESSI - Laporan Penilaian Ekonomi Sirkular\n\nFile: SiPESSI_Report_' + this.currentCEAssessment.companyName.replace(/\s+/g, '_') + '_' + new Date().toISOString().split('T')[0] + '.pdf\n\n[Dalam aplikasi nyata, file PDF akan diunduh]');
            },

            viewCEDetail(id) {
                const ce = this.ceAssessments.find(c => c.id === id);
                if (!ce) return;
                
                const dimScores = Object.entries(ce.dimensionScores).map(([k,v]) => `${k}: ${v.toFixed(1)}`).join('\n');
                alert(`üìã Detail Penilaian Ekonomi Sirkular #${ce.id}\n\nPerusahaan: ${ce.companyName}\nTanggal: ${this.formatDate(ce.date)}\nPengawas: ${ce.auditor}\n\nSkor per Dimensi:\n${dimScores}\n\nSkor Total: ${ce.scoreTotal.toFixed(1)}\nKategori: ${ce.category}\n\nCatatan: ${ce.notes || '-'}\nRekomendasi: ${ce.recommendations || '-'}`);
            },

            editCEAssessment(id) {
                const ce = this.ceAssessments.find(c => c.id === id);
                if (!ce) return;
                
                this.currentCEAssessment = {...ce};
                
                const formTab = document.getElementById('tab-ce-form');
                if (formTab) formTab.click();
                
                setTimeout(() => {
                    this.renderCEFormTab();
                    
                    Object.entries(ce.scores).forEach(([indId, score]) => {
                        const radio = document.querySelector(`input[name="${indId}"][value="${score}"]`);
                        if (radio) {
                            radio.checked = true;
                            radio.closest('.rating-option')?.click();
                        }
                    });
                    
                    Object.entries(ce.evidences).forEach(([indId, evidence]) => {
                        const evidenceEl = document.getElementById(`ce-evidence-${indId}`);
                        if (evidenceEl) evidenceEl.value = evidence;
                    });
                    
                    const notesEl = document.getElementById('ce-notes');
                    const recsEl = document.getElementById('ce-recommendations');
                    if (notesEl) notesEl.value = ce.notes || '';
                    if (recsEl) recsEl.value = ce.recommendations || '';
                    
                    this.updateCEScores();
                }, 200);
            },

            deleteCEAssessment(id) {
                if (confirm('Yakin ingin menghapus penilaian ini?')) {
                    this.ceAssessments = this.ceAssessments.filter(c => c.id !== id);
                    this.renderCEList();
                    alert('‚úÖ Penilaian berhasil dihapus!');
                }
            },

            exportCEPDF(id) {
                const ce = this.ceAssessments.find(c => c.id === id);
                if (!ce) return;
                alert('üìÑ SiPESSI - Laporan Penilaian Ekonomi Sirkular\n\nFile: SiPESSI_Report_' + ce.companyName.replace(/\s+/g, '_') + '_' + ce.date + '.pdf\n\n[Dalam aplikasi nyata, file PDF akan diundah]');
            },

            renderCEGuide() {
                const scaleContainer = document.getElementById('ce-scale-guide');
                if (scaleContainer) {
                    scaleContainer.innerHTML = `
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: var(--space-12);">
                            ${[5,4,3,2,1].map(score => {
                                const colors = {5: '#208f81', 4: '#32b8c6', 3: '#e6a161', 2: '#ff5459', 1: '#c01b2f'};
                                const labels = {5: 'Sangat Baik', 4: 'Baik', 3: 'Cukup', 2: 'Kurang', 1: 'Sangat Kurang'};
                                const descs = {
                                    5: 'Full implementation dengan dokumentasi lengkap, monitoring berkelanjutan & terukur, exceeds regulasi/standar (best practice)',
                                    4: 'Implementation bagus dengan minor gaps, monitoring sebagian besar coverage, meets regulasi/standar',
                                    3: 'Implementation dasar ada tapi belum optimal, monitoring partial coverage, partially meets regulasi',
                                    2: 'Implementation minimal atau awal tahap, monitoring limited, below regulasi/standar',
                                    1: 'Hampir tidak ada implementation, tidak ada monitoring, not compliant dengan regulasi'
                                };
                                return `
                                    <div class="card" style="background: ${colors[score]}; color: white;">
                                        <div class="card__body">
                                            <div style="font-size: var(--font-size-4xl); font-weight: bold; margin-bottom: var(--space-8);">${score}</div>
                                            <div style="font-size: var(--font-size-lg); font-weight: bold; margin-bottom: var(--space-8);">${labels[score]}</div>
                                            <p style="font-size: var(--font-size-xs); margin: 0; opacity: 0.95;">${descs[score]}</p>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    `;
                }
                
                const dimContainer = document.getElementById('ce-dimension-guide');
                if (dimContainer && this.ceData) {
                    dimContainer.innerHTML = this.ceData.dimensions.map((dim, idx) => `
                        <div class="card mb-16">
                            <div class="card__body">
                                <h3 style="color: var(--color-primary); margin-bottom: var(--space-12);">${dim.id}. ${dim.name} (Bobot: ${dim.weight}%)</h3>
                                <p style="color: var(--color-text-secondary); margin-bottom: var(--space-16);">${dim.description}</p>
                                
                                ${dim.indicators.map((ind, indIdx) => `
                                    <details style="margin-bottom: var(--space-12); border: 1px solid var(--color-border); border-radius: var(--radius-base); padding: var(--space-12);">
                                        <summary style="cursor: pointer; font-weight: 600; font-size: var(--font-size-base); color: var(--color-primary);">
                                            ${indIdx + 1}. ${ind.name} (Bobot: ${ind.weight}%)
                                        </summary>
                                        <div style="margin-top: var(--space-12); padding-top: var(--space-12); border-top: 1px solid var(--color-border);">
                                            <p style="margin-bottom: var(--space-8);"><strong>üìù Deskripsi:</strong><br>${ind.description}</p>
                                            <p style="margin-bottom: var(--space-8);"><strong>üîç Metode Verifikasi:</strong><br>${ind.method}</p>
                                            <p style="margin-bottom: var(--space-4);"><strong>üìä Skala Penilaian:</strong></p>
                                            <div style="display: grid; gap: var(--space-6);">
                                                ${Object.entries(ind.scales).reverse().map(([s, desc]) => {
                                                    const scolors = {5: '#208f81', 4: '#32b8c6', 3: '#e6a161', 2: '#ff5459', 1: '#c01b2f'};
                                                    return `<div style="padding: var(--space-8); background: ${scolors[s]}20; border-left: 4px solid ${scolors[s]}; border-radius: var(--radius-sm); font-size: var(--font-size-sm);"><strong>Level ${s}:</strong> ${desc}</div>`;
                                                }).join('')}
                                            </div>
                                        </div>
                                    </details>
                                `).join('')}
                            </div>
                        </div>
                    `).join('');
                }
            },

            formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString('id-ID', { year: 'numeric', month: 'short', day: 'numeric' });
            }
        };

        // Initialize app when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            app.init();
        });
    </script>
</body>
</html>
